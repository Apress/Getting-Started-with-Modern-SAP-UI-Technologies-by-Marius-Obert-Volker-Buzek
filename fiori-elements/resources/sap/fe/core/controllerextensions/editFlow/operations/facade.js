/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/ActionRuntime","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/BusyLocker","sap/fe/core/controllerextensions/messageHandler/messageHandling","sap/fe/core/helpers/FPMHelper","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/library","sap/m/Button","sap/m/Dialog","sap/m/MessageBox","sap/ui/core/Core","sap/ui/core/Fragment","sap/ui/core/library","sap/ui/core/message/Message","sap/ui/core/util/XMLPreprocessor","sap/ui/core/XMLTemplateProcessor","sap/ui/model/json/JSONModel","../../../operationsHelper","./_internal"],function(e,t,n,s,a,i,o,r,l,c,d,u,g,f,m,p,h,M,E,P,C){"use strict";var x=C._validateProperties;var b=C._addMessageForActionParameter;var v=m.MessageType;var A=r.generate;var O=o.getResourceModel;const S=l.Constants,$=l.InvocationGrouping;const y=u.Action;function T(e,t,n,s,a,i){if(!i){i={is412Executed:false,strictHandlingTransitionFails:[],strictHandlingPromises:[],strictHandlingWarningMessages:[],delaySuccessMessages:[],processedMessageIds:[]}}if(!t||t.length===0){return Promise.reject("Bound actions always requires at least one context")}const o=Array.isArray(t);a.aContexts=o?t:[t];const r=n.getMetaModel(),l=`${r.getMetaPath(a.aContexts[0].getPath())}/${e}`,c=r.createBindingContext(`${l}/@$ui5.overload/0`);a.isCriticalAction=L(r,l,a.aContexts,c);const d=function(e){if(e[0].status==="fulfilled"){return e[0].value}else{throw e[0].reason||e}};return B(e,n,c,s,a,i).then(e=>{if(o){return e}else{return d(e)}},e=>{if(o){throw e}else{return d(e)}})}function _(e,t,n,s,a){if(!t){return Promise.reject("Action expects a model/context for execution")}const i=t.getMetaModel(),o=t.bindContext(`/${e}`).getPath(),r=i.createBindingContext(`/${i.createBindingContext(o).getObject("$Action")}/0`);s.isCriticalAction=L(i,`${o}/@$ui5.overload`);return B(e,t,r,n,s,a)}function N(e,t,n){if(!t){return Promise.reject("Bound functions always requires a context")}const s=n.getMetaModel(),a=`${s.getMetaPath(t.getPath())}/${e}`,i=s.createBindingContext(a);return I(e,n,i,t)}function w(e,t){if(!e){return Promise.resolve()}const n=t.getMetaModel(),s=t.bindContext(`/${e}`).getPath(),a=n.createBindingContext(`/${n.createBindingContext(s).getObject("$Function")}/0`);return I(e,t,a)}function I(e,t,n,s){let a;if(!n||!n.getObject()){return Promise.reject(new Error(`Function ${e} not found`))}if(s){n=t.bindContext(`${s.getPath()}/${e}(...)`);a="functionGroup"}else{n=t.bindContext(`/${e}(...)`);a="functionImport"}const i=n.execute(a);t.submitBatch(a);return i.then(function(){return n.getBoundContext()})}function B(e,t,n,s,a,i){if(!i){i={is412Executed:false,strictHandlingTransitionFails:[],strictHandlingPromises:[],strictHandlingWarningMessages:[],delaySuccessMessages:[],processedMessageIds:[]}}a.bGrouped=a.invocationGrouping===$.ChangeSet;return new Promise(async function(o,r){let l={};let c;let d;const u=a.label;const f=a.skipParameterDialog;const m=a.aContexts;const p=a.bIsCreateAction;const h=a.isCriticalAction;let M;let E;let P;let C;let x;let b;let v;const A=n.getObject();if(!n||!n.getObject()){return r(new Error(`Action ${e} not found`))}const O=F(n);const S=O.length>0&&!(O.length===1&&O[0].$Name==="ResultIsActiveEntity");const y=a.parameterValues;const T=s.getComponentData();const _=T&&T.startupParameters||{};if(S&&f){v=K(p,O,y,_)}c=null;if(S){if(!(f&&v)){c=G}}else if(h){c=D}l={fnOnSubmitted:a.onSubmitted,fnOnResponse:a.onResponse,actionName:e,model:t,aActionParameters:O,bGetBoundContext:a.bGetBoundContext,defaultValuesExtensionFunction:a.defaultValuesExtensionFunction,label:a.label,selectedItems:a.selectedItems};if(n.getObject("$IsBound")){if(a.additionalSideEffect&&a.additionalSideEffect.pathExpressions){M=t.getMetaModel();E=M.getMetaPath(m[0].getPath());P=M.getObject(`${E}/@com.sap.vocabularies.Common.v1.Messages/$Path`);if(P){C=a.additionalSideEffect.pathExpressions.findIndex(function(e){return typeof e==="string"&&e===P});b=n.getObject("$ReturnType");x=b&&!b.$isCollection&&n.getModel().getObject(E).$Type===b.$Type;if(C>-1||x){a.mBindingParameters=a.mBindingParameters||{};if(n.getObject(`$ReturnType/$Type/${P}`)&&(!a.mBindingParameters.$select||a.mBindingParameters.$select.split(",").indexOf(P)===-1)){a.mBindingParameters.$select=a.mBindingParameters.$select?`${a.mBindingParameters.$select},${P}`:P;if(C===-1){a.additionalSideEffect.pathExpressions.push("*")}if(a.additionalSideEffect.triggerActions.length===0&&C>-1){a.additionalSideEffect.pathExpressions.splice(C,1)}}}}}l.aContexts=m;l.mBindingParameters=a.mBindingParameters;l.additionalSideEffect=a.additionalSideEffect;l.bGrouped=a.invocationGrouping===$.ChangeSet;l.internalModelContext=a.internalModelContext;l.operationAvailableMap=a.operationAvailableMap;l.isCreateAction=p;l.bObjectPage=a.bObjectPage;if(a.controlId){l.control=a.parentControl.byId(a.controlId);a.control=l.control}else{l.control=a.parentControl;a.control=a.parentControl}}if(p){l.bIsCreateAction=p}const N=(A.$Parameter||[]).some(e=>(A.$EntitySetPath&&A.$EntitySetPath===e.$Name||A.$IsBound)&&e.$isCollection);l.isStatic=N;if(c){d=c(e,s,u,l,O,y,n,a.parentControl,a.entitySetName,a.messageHandler,i);return d.then(function(e){H(a,l,A);o(e)}).catch(function(e){r(e)})}else{if(y){for(const e in l.aActionParameters){var w;l.aActionParameters[e].value=y===null||y===void 0?void 0:(w=y.find(t=>t.name===l.aActionParameters[e].$Name))===null||w===void 0?void 0:w.value}}else{for(const e in l.aActionParameters){var I;l.aActionParameters[e].value=(I=_[l.aActionParameters[e].$Name])===null||I===void 0?void 0:I[0]}}let e;try{e=await U(s,l,a.parentControl,a.messageHandler,i);const t=g.getMessageManager().getMessageModel().getData();if(i&&i.is412Executed&&i.strictHandlingTransitionFails.length){i.delaySuccessMessages=i.delaySuccessMessages.concat(t)}H(a,l,A);o(e)}catch{r(e)}finally{var B,R;if(i&&i.is412Executed&&i.strictHandlingTransitionFails.length){try{const e=i.strictHandlingTransitionFails;const t=[];e.forEach(function(e){t.push(e.oAction.getContext())});l.aContexts=t;const n=await U(s,l,a.parentControl,a.messageHandler,i);i.strictHandlingTransitionFails=[];g.getMessageManager().addMessages(i.delaySuccessMessages);H(a,l,A);o(n)}catch(e){r(e)}}let e=false;if(a.bGrouped&&i&&i.strictHandlingPromises.length||q(a.bGrouped)!==-1){e=true}a===null||a===void 0?void 0:(B=a.messageHandler)===null||B===void 0?void 0:B.showMessageDialog({control:(R=l)===null||R===void 0?void 0:R.control,onBeforeShowMessage:function(t,n){return j(a,m,undefined,t,n,e)},aSelectedContexts:a.aContexts,sActionName:u});if(i){i={is412Executed:false,strictHandlingTransitionFails:[],strictHandlingPromises:[],strictHandlingWarningMessages:[],delaySuccessMessages:[],processedMessageIds:[]}}}}})}function D(e,t,n,s,a,i,o,r,l,c){return new Promise((n,a)=>{let i=e?e:null;i=i.indexOf(".")>=0?i.split(".")[i.split(".").length-1]:i;const o=i&&l?`${l}|${i}`:"";const d=O(r);const g=d.getText("C_OPERATIONS_ACTION_CONFIRM_MESSAGE",undefined,o);u.confirm(g,{onClose:async function(e){if(e===y.OK){try{const e=await U(t,s,r,c);n(e)}catch(e){try{await c.showMessageDialog();a(e)}catch(t){a(e)}}}else{n()}}})})}async function R(e,t,n,s,a,i,o,r){var l;const c=await U(e,t,n,s,r);if((l=t.aContexts)!==null&&l!==void 0&&l.length){if(c!==null&&c!==void 0&&c.some(e=>e.status==="rejected")){throw c}}const d=g.getMessageManager().getMessageModel().getData();if(r&&r.is412Executed&&r.strictHandlingTransitionFails.length){if(!o){r.delaySuccessMessages=r.delaySuccessMessages.concat(d)}else{g.getMessageManager().addMessages(r.delaySuccessMessages);let e=false;if(t.bGrouped&&r.strictHandlingPromises.length||q(t.bGrouped)!==-1){e=true}if(d.length){i.attachEventOnce("afterClose",function(){s.showMessageDialog({onBeforeShowMessage:function(n,s){return j(t,a,i,n,s,e)},control:t.control,aSelectedContexts:t.aContexts,sActionName:t.label})})}}}else if(d.length){let e=false;if(t.bGrouped&&r&&r.strictHandlingPromises.length||q(t.bGrouped)!==-1){e=true}i.attachEventOnce("afterClose",function(){s.showMessageDialog({isActionParameterDialogOpen:t===null||t===void 0?void 0:t.oDialog.isOpen(),onBeforeShowMessage:function(n,s){return j(t,a,i,n,s,e)},control:t.control,aSelectedContexts:t.aContexts,sActionName:t.label})})}return c}function H(e,n,s){if(n.internalModelContext&&n.operationAvailableMap&&n.aContexts&&n.aContexts.length&&s.$IsBound){const s=n.isStatic;if(!s){t.setActionEnablement(n.internalModelContext,JSON.parse(n.operationAvailableMap),e.selectedItems,"table")}else if(n.control){const e=n.control;if(e.isA("sap.ui.mdc.Table")){const s=e.getSelectedContexts();t.setActionEnablement(n.internalModelContext,JSON.parse(n.operationAvailableMap),s,"table")}}}}function j(e,t,n,s,i,o){let r=i.showMessageBox,l=i.showMessageDialog;const c=e.control;const d=g.getLibraryResourceBundle("sap.fe.core");const u=s.filter(function(e){return e.getTarget()===""});const f=s.filter(function(t){var n;return t.getTarget&&t.getTarget().indexOf(e.actionName)!==-1&&(e===null||e===void 0?void 0:(n=e.aActionParameters)===null||n===void 0?void 0:n.some(function(e){return t.getTarget().indexOf(e.$Name)!==-1}))});f===null||f===void 0?void 0:f.forEach(function(e){e.isAPDTarget=true});const m=f.length?true:false;let h=false;if(o&&!m){h=true;let e=d.getText("C_COMMON_DIALOG_CANCEL_ERROR_MESSAGES_TEXT");let t=d.getText("C_COMMON_DIALOG_CANCEL_ERROR_MESSAGES_DETAIL_TEXT");const n=g.getMessageManager().getMessageModel();const i=n.getData();const o=a.getMessages(true);let u;const f=c&&c.getModel("ui").getProperty("/isEditable");const m=s.findIndex(function(e){return e.getType()==="Error"||e.getType()==="Warning"});const M=i.findIndex(function(e){return e.getType()==="Error"||e.getType()==="Warning"});if(m!==1&&M!==-1){if(i.length===1&&o.length===1){if(f===false){i[0].setMessage(d.getText("C_COMMON_DIALOG_CANCEL_SINGLE_ERROR_MESSAGE_TEXT")+"\n\n"+i[0].getMessage())}else{e=f?d.getText("C_COMMON_DIALOG_CANCEL_SINGLE_ERROR_MESSAGE_TEXT_EDIT"):d.getText("C_COMMON_DIALOG_CANCEL_SINGLE_ERROR_MESSAGE_TEXT");t="";u=new p({message:e,type:v.Error,target:"",persistent:true,description:t,code:"FE_CUSTOM_MESSAGE_CHANGESET_ALL_FAILED"});s.unshift(u);if(s.length===1){r=true;l=false}else{l=true;r=false}}}else{u=new p({message:e,type:v.Error,target:"",persistent:true,description:t,code:"FE_CUSTOM_MESSAGE_CHANGESET_ALL_FAILED"});s.unshift(u);if(s.length===1){r=true;l=false}else{l=true;r=false}}}}if(n&&n.isOpen()&&t.length!==0&&!e.isStatic){if(!e.bGrouped){if(t.length>1||!m){n.close();n.destroy()}}else if(!m){n.close();n.destroy()}}let M=[];const E=n&&n.isOpen();if(!h){if(s.length===1&&s[0].getTarget&&s[0].getTarget()!==undefined&&s[0].getTarget()!==""){if(c&&c.getModel("ui").getProperty("/isEditable")===false||!c){r=!m;l=false}else if(c&&c.getModel("ui").getProperty("/isEditable")===true){r=false;l=false}}else if(c){if(c.getModel("ui").getProperty("/isEditable")===false){if(E&&m){l=false}}else if(c.getModel("ui").getProperty("/isEditable")===true){if(!E&&m){l=true;M=u.concat(f)}else if(!E&&u.length===0){l=false}}}}return{showMessageBox:r,showMessageDialog:l,filteredMessages:M.length?M:s,fnGetMessageSubtitle:c&&c.isA("sap.ui.mdc.Table")&&a.setMessageSubtitle.bind({},c,t),showChangeSetErrorDialog:e.bGrouped}}function G(t,a,o,r,l,m,p,P,C,v,$){const y=X(p,t),T=p.getModel().oModel.getMetaModel(),_=T.createBindingContext(y),w=p.getObject("$IsBound")?p.getPath().split("/@$ui5.overload/0")[0]:p.getPath().split("/0")[0],I=T.createBindingContext(w),B=r.isCreateAction,D="sap/fe/core/controls/ActionParameterDialog";return new Promise(async function(y,T){let w;const H=g.getMessageManager();const G=e=>{const t=H.getMessageModel().getData();const n=A(["APD_",e.$Name]);const s=t.filter(e=>e.getControlIds().some(e=>n.split("-").includes(e)));H.removeMessages(s)};const F={handleChange:async function(e){const t=e.getSource();const n=w.find(e=>e.field===t);G(n.parameter);n.validationPromise=e.getParameter("promise");try{n.value=await n.validationPromise;n.hasError=false}catch(e){delete n.value;n.hasError=true;b(H,[{actionParameterInfo:n,message:e.message}])}}};const L=M.loadTemplate(D,"fragment");const k=new E({$displayMode:{}});try{const M=await h.process(L,{name:D},{bindingContexts:{action:p,actionName:I,entitySet:_},models:{action:p.getModel(),actionName:I.getModel(),entitySet:_.getModel(),metaModel:_.getModel()}});const b=r.aContexts||[];const J=[];let z;await n.setUserDefaults(a,l,k,true);const Y=await f.load({definition:M,controller:F});w=l.map(e=>{const t=g.byId(A(["APD_",e.$Name]));const n=t.isA("sap.ui.mdc.MultiValueField");return{parameter:e,field:t,isMultiValue:n}});const Q=O(P);let Z={dialogCancelled:true,result:undefined};const ee=new d(A(["fe","APD_",t]),{title:o||Q.getText("C_OPERATIONS_ACTION_PARAMETER_DIALOG_TITLE"),content:[Y],escapeHandler:function(){ee.close()},beginButton:new c(A(["fe","APD_",t,"Action","Ok"]),{text:B?Q.getText("C_TRANSACTION_HELPER_SAPFE_ACTION_CREATE_BUTTON"):V(Q,o,t,C),type:"Emphasized",press:async function(){try{if(!await x(H,w,Q)){return}s.lock(ee);try{v.removeTransitionMessages();let e;const t=z&&z.getParameterContext();for(const n in l){if(l[n].$isCollection){const t=ee.getModel("mvfview").getProperty(`/${l[n].$Name}`),s=[];for(const e in t){s.push(t[e].Key)}e=s}else{e=t.getProperty(l[n].$Name)}l[n].value=e;e=undefined}r.label=o;try{const e=await R(a,r,P,v,b,ee,false,$);Z={dialogCancelled:false,result:e};ee.close()}catch(e){const t=sap.ui.getCore().getMessageManager().getMessageModel().getData();if($&&$.is412Executed&&$.strictHandlingTransitionFails.length){$.delaySuccessMessages=$.delaySuccessMessages.concat(t)}throw e}finally{if($&&$.is412Executed&&$.strictHandlingTransitionFails.length){try{const e=$.strictHandlingTransitionFails;const t=[];e.forEach(function(e){t.push(e.oAction.getContext())});r.aContexts=t;const n=await R(a,r,P,v,b,ee,true,$);$.strictHandlingTransitionFails=[];Z={dialogCancelled:false,result:n}}catch{if($.is412Executed&&$.strictHandlingTransitionFails.length){g.getMessageManager().addMessages($.delaySuccessMessages)}let e=false;if(r.bGrouped&&$.strictHandlingPromises.length||q(r.bGrouped)!==-1){e=true}await v.showMessageDialog({isActionParameterDialogOpen:ee.isOpen(),onBeforeShowMessage:function(t,n){return j(r,b,ee,t,n,e)},aSelectedContexts:r.aContexts,sActionName:o})}}if(s.isLocked(ee)){s.unlock(ee)}}}catch(e){let t=true;let n=false;if(r.bGrouped&&$&&$.strictHandlingPromises.length||q(r.bGrouped)!==-1){n=true}await v.showMessages({context:r.aContexts[0],isActionParameterDialogOpen:ee.isOpen(),messagePageNavigationCallback:function(){ee.close()},onBeforeShowMessage:function(e,s){const a=j(r,b,ee,e,s,n);t=a.showMessageDialog;return a},aSelectedContexts:r.aContexts,sActionName:o,control:r.control});if(t){if(ee.isOpen()){}else{T(e)}}}}finally{if($){$={is412Executed:false,strictHandlingTransitionFails:[],strictHandlingPromises:[],strictHandlingWarningMessages:[],delaySuccessMessages:[],processedMessageIds:[]}}if(s.isLocked(ee)){s.unlock(ee)}}}}),endButton:new c(A(["fe","APD_",t,"Action","Cancel"]),{text:Q.getText("C_COMMON_ACTION_PARAMETER_DIALOG_CANCEL"),press:function(){ee.close()}}),beforeOpen:async function(t){const s=Object.assign({},t);v.removeTransitionMessages();const a=function(){const e=ee.getModel().getMetaModel(),t=p.sPath&&p.sPath.split("/@")[0],n=e.getObject(`${t}@com.sap.vocabularies.Common.v1.DefaultValuesFunction`);return n};const o=async function(t){const o=a();const c=async function(s,a){if(a!==undefined){if(b.length>0&&a.$Path){try{let e=await n.requestSingletonProperty(a.$Path,z.getModel());if(e===null){e=await z.getParameterContext().requestProperty(a.$Path)}if(b.length>1){let n=a.$Path;if(n.indexOf(`${t}/`)===0){n=n.replace(`${t}/`,"")}for(let t=1;t<b.length;t++){if(b[t].getProperty(n)!==e){return{paramName:s,value:undefined,bNoPossibleValue:true}}}}return{paramName:s,value:e}}catch(t){e.error("Error while reading default action parameter",s,r.actionName);return{paramName:s,value:undefined,bLatePropertyError:true}}}else{return{paramName:s,value:a}}}else if(k&&k.oData[s]){return{paramName:s,value:k.oData[s]}}else{return{paramName:s,value:undefined}}};const d=function(e){const t=ee.getModel().getMetaModel(),s=n.getParameterPath(p.getPath(),e)+"@",a=t.getObject(s),i=a&&a["@com.sap.vocabularies.UI.v1.ParameterDefaultValue"];return i};const g=[];let f,h;for(const e in l){f=l[e].$Name;h=d(f);g.push(c(f,h))}if(p.getObject("$IsBound")&&b.length>0){if(o&&o.length>0&&typeof o==="string"){for(const e in b){J.push(N(o,b[e],r.model))}}}const M=Promise.all(g);let E=Promise.resolve([]);let P;if(J&&J.length>0){E=Promise.all(J)}if(r.defaultValuesExtensionFunction){const e=r.defaultValuesExtensionFunction.substring(0,r.defaultValuesExtensionFunction.lastIndexOf(".")||-1).replace(/\./gi,"/"),t=r.defaultValuesExtensionFunction.substring(r.defaultValuesExtensionFunction.lastIndexOf(".")+1,r.defaultValuesExtensionFunction.length);P=i.actionWrapper(s,e,t,{contexts:b})}try{const e=await Promise.all([M,E,P]);const t=e[0];const n=e[1];const s=e[2];let a;for(const e in l){var C;a=l[e].$Name;const i=m===null||m===void 0?void 0:(C=m.find(t=>t.name===l[e].$Name))===null||C===void 0?void 0:C.value;if(i){z.setParameter(l[e].$Name,i)}else if(s&&s.hasOwnProperty(a)){z.setParameter(l[e].$Name,s[a])}else if(t[e]&&t[e].value!==undefined){z.setParameter(l[e].$Name,t[e].value)}else if(o&&!t[e].bNoPossibleValue){if(b.length>1){let t=0;while(t<b.length-1){if(n[t]&&n[t+1]&&n[t].getObject(a)===n[t+1].getObject(a)){t++}else{break}}if(t===b.length-1){z.setParameter(l[e].$Name,n[t].getObject(a))}}else if(n[0]&&n[0].getObject(a)){z.setParameter(l[e].$Name,n[0].getObject(a))}}}const i=t.some(function(e){if(e.bLatePropertyError){return e.bLatePropertyError}});if(i){const e=Q.getText("C_APP_COMPONENT_SAPFE_ETAG_LATE_PROPERTY");u.warning(e,{contentWidth:"25em"})}}catch(t){e.error("Error while retrieving the parameter",t)}};const c=async function(){if(p.getObject("$IsBound")&&b.length>0){const t=p.getObject("$Parameter");const n=t[0]&&t[0].$Name;try{const e=await b[0].requestObject();if(e){z.setParameter(n,e)}await o(n)}catch(t){e.error("Error while retrieving the parameter",t)}}else{await o()}};await c();for(const e of w){const t=e.isMultiValue?e.field.getItems():e.field.getValue();e.value=t;e.validationPromise=Promise.resolve(t)}},afterClose:function(){l.forEach(G);ee.destroy();if(Z.dialogCancelled){T(S.CancelActionDialog)}else{y(Z.result)}}});r.oDialog=ee;ee.setModel(p.getModel().oModel);ee.setModel(k,"paramsModel");ee.bindElement({path:"/",model:"paramsModel"});const te=new E({});ee.setModel(te,"mvfview");for(const e of w){if(e.isMultiValue){var W,U;e===null||e===void 0?void 0:(W=e.field)===null||W===void 0?void 0:(U=W.getBinding("items"))===null||U===void 0?void 0:U.attachChange(()=>{G(e.parameter)})}else{var X,K;e===null||e===void 0?void 0:(X=e.field)===null||X===void 0?void 0:(K=X.getBinding("value"))===null||K===void 0?void 0:K.attachChange(()=>{G(e.parameter)})}}let ne=`${t}(...)`;if(!b.length){ne=`/${ne}`}ee.bindElement({path:ne});if(P){P.addDependent(ee)}if(b.length>0){ee.setBindingContext(b[0])}z=ee.getObjectBinding();ee.open()}catch(e){T(e)}})}function F(e){const t=e.getObject("$Parameter")||[];if(t&&t.length){if(e.getObject("$IsBound")){return t.slice(1,t.length)||[]}}return t}function L(e,t,n,s){const a=e.getObject(`${t}@com.sap.vocabularies.Common.v1.IsActionCritical`);let i=a&&a.$Path;if(!i){return!!a}const o=s&&s.getObject("$Parameter"),r=i&&i.split("/"),l=o&&o.length&&typeof o==="object"&&i&&n&&n.length;if(l){o.filter(function(e){const t=r&&r.indexOf(e.$Name);if(t>-1){r.splice(t,1)}});i=r.join("/");return n[0].getObject(i)}else if(i){return n[0].getObject(i)}}function V(e,t,n,s){let a=n?n:null;const i=a.split(".");a=a.indexOf(".")>=0?i[i.length-1]:a;const o=a&&s?`${s}|${a}`:"";const r="ACTION_PARAMETER_DIALOG_ACTION_NAME";const l=e.checkIfResourceKeyExists(`${r}|${o}`);if(t){if(l){return e.getText(r,undefined,o)}else if(e.checkIfResourceKeyExists(`${r}|${s}`)){return e.getText(r,undefined,`${s}`)}else if(e.checkIfResourceKeyExists(`${r}`)){return e.getText(r)}else{return t}}else{return e.getText("C_COMMON_DIALOG_OK")}}function k(e,t,n,s,a,i,o,r,l,c,d){let u,g=true;if(t){t.internalOperationsPromiseResolve=l}if(n){var f;const t=e.getBoundContext().getPath();const n=e.getModel().getMetaModel().getMetaPath(t);const s=e.getModel().getMetaModel().getObject(n);if(s&&((f=s[0])===null||f===void 0?void 0:f.$kind)!=="Action"){g=false}}if(!g){u=e.execute(s).then(function(){l(e.getBoundContext());return e.getBoundContext()})}else{u=n?e.execute(s,undefined,P.fnOnStrictHandlingFailed.bind(z,s,t,a,r,e.getContext(),o,i,d)).then(function(){l(e.getBoundContext());return e.getBoundContext()}).catch(function(){c();return Promise.reject()}):e.execute(s,undefined,P.fnOnStrictHandlingFailed.bind(z,s,t,a,r,e.getContext(),o,i,d)).then(function(e){l(e);return e}).catch(function(){c();return Promise.reject()})}return u.catch(()=>{throw S.ActionExecutionFailed})}function W(){let e=null,t=null;const n=new Promise(function(n,s){e=n;t=s});return{oLocalActionPromise:n,internalOperationsPromiseResolve:e,internalOperationsPromiseReject:t}}function q(e){if(e){const e=g.getMessageManager().getMessageModel().getData();return e.findIndex(function(e){return e.getType()==="Error"||e.getType()==="Warning"})}return-1}function U(t,n,s,a,i){const o=n.aContexts||[];const r=n.model;const l=n.aActionParameters||[];const c=n.actionName;const d=n.fnOnSubmitted;const u=n.fnOnResponse;const f=O(s);let m;function p(){if(l&&l.length){for(let e=0;e<l.length;e++){if(!l[e].value){switch(l[e].$Type){case"Edm.String":l[e].value="";break;case"Edm.Boolean":l[e].value=false;break;case"Edm.Byte":case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":l[e].value=0;break;default:break}}m.setParameter(l[e].$Name,l[e].value)}}}if(o.length){return new Promise(function(s){const l=n.mBindingParameters;const u=n.bGrouped;const h=n.bGetBoundContext;const M=[];let E;let C;let x;const b=W();const v=function(e,s,o,r){p();const l=[];x=!u?`$auto.${s}`:e.getUpdateGroupId();n.requestSideEffects=J.bind(z,t,o,n,x,l);E=k(e,n,h,x,f,a,r,s,b.internalOperationsPromiseResolve,b.internalOperationsPromiseReject,i);M.push(E);l.push(b.oLocalActionPromise);J(t,o,n,x,l);return Promise.allSettled(l)};const A=function(e,s,o,l){const c=[];p();x=`apiMode${s}`;n.requestSideEffects=J.bind(z,t,o,n,x,c);E=k(e,n,h,x,f,a,l,s,b.internalOperationsPromiseResolve,b.internalOperationsPromiseReject,i);M.push(E);c.push(b.oLocalActionPromise);J(t,o,n,x,c);r.submitBatch(x);return Promise.allSettled(c)};async function O(){const t=[];for(C=0;C<o.length;C++){m=r.bindContext(`${c}(...)`,o[C],l);t.push(v(m,o.length<=1?null:C,{context:o[C],pathExpressions:n.additionalSideEffect&&n.additionalSideEffect.pathExpressions,triggerActions:n.additionalSideEffect&&n.additionalSideEffect.triggerActions},o.length))}(d||function e(){})(M);await Promise.allSettled(t);if(i&&i.strictHandlingPromises.length){try{const e=q(true);if(e===-1){await P.renderMessageView(n,f,a,i.strictHandlingWarningMessages,i,o.length>1)}else{i.strictHandlingPromises.forEach(function(e){e.resolve(false)});const e=g.getMessageManager().getMessageModel();const t=e.getData();e.setData(t.concat(i.strictHandlingWarningMessages))}}catch{e.error("Retriggering of strict handling actions failed")}}$()}async function S(e){(d||function e(){})(M);function t(e,t,s){m=r.bindContext(`${c}(...)`,e,l);return A(m,t,{context:e,pathExpressions:n.additionalSideEffect&&n.additionalSideEffect.pathExpressions,triggerActions:n.additionalSideEffect&&n.additionalSideEffect.triggerActions},s)}await e.reduce(async(e,n,s)=>{await e;await t(n,s+1,o.length)},Promise.resolve());if(i&&i.strictHandlingPromises.length){await P.renderMessageView(n,f,a,i.strictHandlingWarningMessages,i,o.length>1)}$()}if(!u){S(o)}else{O()}function $(){return Promise.allSettled(M).then(s)}}).finally(function(){(u||function e(){})()})}else{m=r.bindContext(`/${c}(...)`);p();const t="actionImport";const s=m.execute(t,undefined,P.fnOnStrictHandlingFailed.bind(z,t,{label:n.label,model:r},f,null,null,null,a,i));r.submitBatch(t);(d||function e(){})(s);return s.then(function(e){if(e){return e}else{var t,n,s;return(t=(n=m).getBoundContext)===null||t===void 0?void 0:(s=t.call(n))===null||s===void 0?void 0:s.getObject()}}).catch(function(t){e.error("Error while executing action "+c,t);throw t}).finally(function(){(u||function e(){})()})}}function X(e,t){let n=e.getPath();n=e.getObject("$IsBound")?n.split("@$ui5.overload")[0]:n.split("/0")[0];return n.split(`/${t}`)[0]}function K(e,t,n,s){if(n){for(const e of t){if(e.$Name!=="ResultIsActiveEntity"&&!(n!==null&&n!==void 0&&n.find(t=>t.name===e.$Name))){return false}}}else if(e&&s){for(const e of t){if(!s[e.$Name]){return false}}}return true}function J(n,s,a,i,o){const r=n.getSideEffectsService();let l;if(s&&s.triggerActions&&s.triggerActions.length){s.triggerActions.forEach(function(e){if(e){l=r.executeAction(e,s.context,i);if(o){o.push(l)}}})}if(s&&s.pathExpressions&&s.pathExpressions.length>0){l=r.requestSideEffects(s.pathExpressions,s.context,i);if(o){o.push(l)}l.then(function(){if(a.operationAvailableMap&&a.internalModelContext){t.setActionEnablement(a.internalModelContext,JSON.parse(a.operationAvailableMap),a.selectedItems,"table")}}).catch(function(t){e.error("Error while requesting side effects",t)})}}const z={callBoundAction:T,callActionImport:_,callBoundFunction:N,callFunctionImport:w,executeDependingOnSelectedContexts:k,valuesProvidedForAllParameters:K,getActionParameterActionName:V,actionParameterShowMessageCallback:j,afterActionResolution:H};return z},false);