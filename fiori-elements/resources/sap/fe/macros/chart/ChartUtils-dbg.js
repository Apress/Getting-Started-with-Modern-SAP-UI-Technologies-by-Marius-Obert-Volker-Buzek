/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/macros/filter/FilterUtils","sap/ui/model/Filter","sap/ui/model/FilterOperator","../CommonHelper","../table/Utils"],function(t,e,i,n,r,s){"use strict";let l=[];const o={getChartSelectionsExist:function(t,e){const i=e||t;if(t){try{const e=t.getControlDelegate()._getChart(t);if(e){const n=this.getDimensionsFromDrillStack(e);const r=n.length>l.length;const s=n.length<l.length;const o=n.toString()===l.toString();let a;if(s&&n.length===1){a=this.getChartSelections(t,true)}else{a=this.getChartSelections(t)}if(r||s){l=n;return a.length>0}else if(o&&i.isA("sap.ui.mdc.Table")){return a.length>0}}}catch(t){return false}}return false},getChartSelections:function(t,e){if(e){this.getChartModel(t,"",{})}const i=this.getChartModel(t,"filters");return i||[]},getChartFilters:function(t){const e=this.getChartSelections(t)||[];return new i(e)},setChartFilters:function(t){const e=this.getChartModel(t,"drillStack")||{};const r=t.getControlDelegate()._getChart(t);const s=[];let l;function o(t){for(const e in t){const r=[];for(const s in l){const o=l[s];const a=t[e].data[o];if(a!==undefined){r.push(new i({path:o,operator:n.EQ,value1:a}))}}if(r.length>0){s.push(new i(r,true))}}}if(r){const i=this.getVizSelection(r);l=r.getVisibleDimensions();const n=this.getDimensionsFromDrillStack(r);if(n.length>0){this.getChartModel(t,"drillStack",{});e[n.toString()]=i;this.getChartModel(t,"drillStack",e)}if(i.length>0){o(i)}else{const t=Object.keys(e)||[];const i=e[t[t.length-2]]||[];o(i)}this.getChartModel(t,"filters",s)}},getFilterBarFilterInfo:function(t){return e.getFilterInfo(t.getFilter(),{targetControl:t})},getAllFilterInfo:function(e){const i=this.getFilterBarFilterInfo(e);const n=this.getChartFilters(e);const l=s.getP13nFilters(e);const o=r.parseCustomData(e.data("selectionPresentationVariantPath"))?r.parseCustomData(e.data("selectionPresentationVariantPath")).data:"";const a=o?t.getFiltersInfoForSV(e,o,true):null;if(n&&n.aFilters&&n.aFilters.length){i.filters.push(n)}if(l.length>0){l.forEach(t=>{if(t.aFilters&&t.aFilters.length>0){t.aFilters.forEach(t=>{i.filters.push(t)})}else{i.filters.push(t)}})}if(a&&a.filters.length>0){a.filters.forEach(t=>{i.filters.push(t.aFilters[0])})}return i},getChartSelectedData:function(t){let e=[];switch(t.getSelectionBehavior()){case"DATAPOINT":e=t.getSelectedDataPoints().dataPoints;break;case"CATEGORY":e=t.getSelectedCategories().categories;break;case"SERIES":e=t.getSelectedSeries().series;break}return e},getChartModel:function(t,e,i){const n=t.getBindingContext("internal");if(!n){return false}if(i){n.setProperty(e,i)}return n&&n.getObject(e)},getDimensionsFromDrillStack:function(t){const e=t.getDrillStack()||[];const i=e.pop()||{};return i.dimension||[]},getVizSelection:function(t){return t&&t._getVizFrame()&&t._getVizFrame().vizSelection()||[]}};return o},false);