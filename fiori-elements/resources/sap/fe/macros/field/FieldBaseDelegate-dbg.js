/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/type/TypeUtil","sap/ui/mdc/field/FieldBaseDelegate","sap/ui/model/Filter"],function(e,t,n,o,i){"use strict";return Object.assign({},o,{initializeTypeFromBinding:function(e,t,n){const o={};if(t&&t.isA(["sap.ui.model.odata.type.Unit","sap.ui.model.odata.type.Currency"])&&Array.isArray(n)&&n.length>2&&n[2]!==undefined){t.formatValue(n,"string");o.bTypeInitialized=true;o.mCustomUnits=n[2]}return o},initializeInternalUnitType:function(e,t,n){if((n===null||n===void 0?void 0:n.mCustomUnits)!==undefined){t.formatValue([null,null,n.mCustomUnits],"string")}},enhanceValueForUnit:function(e,t,n){if((n===null||n===void 0?void 0:n.bTypeInitialized)===true&&t.length===2){t.push(n.mCustomUnits);return t}return undefined},getDefaultValueHelpDelegate:function(e){return{name:"sap/ui/mdc/odata/v4/ValueHelpDelegate",payload:{}}},getTypeUtil:function(e){return n},_getValueListParameter:function(e,t){return e.Parameters.filter(function(e){if(e.LocalDataProperty){return e.LocalDataProperty.$PropertyPath===t}else{return false}})},_getFilter:function(e,t,n,o,r,a){const l=[];const u=e.Parameters.filter(function(e){var o;return e.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterIn"||e.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterInOut"||((o=e.LocalDataProperty)===null||o===void 0?void 0:o.$PropertyPath)===t&&e.ValueListProperty===n});for(const e of u){var s;let n;if(((s=e.LocalDataProperty)===null||s===void 0?void 0:s.$PropertyPath)===t){n=o}else if((r===null||r===void 0?void 0:r.isActionParameterDialog)===true){var d;const t=`APD_::${(d=e.LocalDataProperty)===null||d===void 0?void 0:d.$PropertyPath}`;const o=sap.ui.getCore().byId(t);n=o===null||o===void 0?void 0:o.getValue()}else if(a!==undefined){var c;const t=(c=e.LocalDataProperty)===null||c===void 0?void 0:c.$PropertyPath;const o=a===null||a===void 0?void 0:a[0];n=t&&(o===null||o===void 0?void 0:o[t])}if(n!==null&&n!==undefined){l.push(new i({path:e.ValueListProperty,operator:"EQ",value1:n}))}}return l},getItemForValue:function(e,t,n){if(n.value!==""){return o.getItemForValue(e,t,n)}return undefined},getDescription:async function(n,o,i,r,a,l,u,s,d,c,f){var p,v;if(!n&&c!==null&&c!==void 0&&c.getDisplay().includes("Description")){n={retrieveTextFromValueList:true}}if(((p=n)===null||p===void 0?void 0:p.retrieveTextFromValueList)===true||((v=n)===null||v===void 0?void 0:v.isFilterField)===true){const n=o.getModel();const r=n?n.getMetaModel():t.getAppComponent(o).getModel().getMetaModel();const a=o.getPayload();const u=d===null||d===void 0?void 0:d[a.valueHelpQualifier];const s=a===null||a===void 0?void 0:a.propertyPath;let c;try{var m;const t=await r.requestValueListInfo(s,true,l);const n=r.getObject(`${s}@sapui.name`);const o=t[Object.keys(t)[0]];const d=this._getValueListParameter(o,n);const f=d===null||d===void 0?void 0:(m=d[0])===null||m===void 0?void 0:m.ValueListProperty;if(!f){throw Error(`Inconsistent value help annotation for ${n}`)}const p=o.$model;const v=p.getMetaModel().getObject(`/${o.CollectionPath}/${f}@com.sap.vocabularies.Common.v1.Text`);if(v&&v.$Path){c=v.$Path;const e=this._getFilter(o,n,f,i,a,u);const t=p.bindList(`/${o.CollectionPath}`,undefined,undefined,e,{$select:c});const r=await t.requestContexts(0,2);return r.length?r[0].getObject(c):undefined}else{const t=`Text Annotation for ${f} is not defined`;e.error(t);return undefined}}catch(t){const n=t?t.status:undefined;const o=t instanceof Error?t.message:String(t);const i=n===404?`Metadata not found (${n}) for value help of property ${s}`:o;e.error(i)}}return undefined}})},false);