/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/buildingBlocks/BuildingBlockSupport","sap/fe/core/buildingBlocks/RuntimeBuildingBlock","sap/fe/core/CommonUtils","sap/fe/core/controls/CommandExecution","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ClassSupport","sap/m/Menu","sap/m/MenuButton","sap/m/MenuItem","sap/suite/ui/commons/collaboration/CollaborationHelper","sap/suite/ui/commons/collaboration/ServiceContainer","sap/ui/core/CustomData","sap/ui/performance/trace/FESRHelper","sap/ushell/ui/footerbar/AddBookmarkButton","./ShareAPI","sap/fe/core/jsx-runtime/jsx"],function(e,t,i,n,r,o,a,s,l,u,c,d,p,m,v,f,b){"use strict";var h,g,S,y,M,_,w,I,B,A,O,T,z;var E={};var C=a.defineReference;var P=o.constant;var x=t.defineBuildingBlock;var k=t.blockAttribute;function N(e,t,i,n){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function D(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function j(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;R(e,t)}function R(e,t){R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return R(e,t)}function F(e,t,i,n,r){var o={};Object.keys(n).forEach(function(e){o[e]=n[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},o);if(r&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(r):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function H(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let L=(h=x({name:"Share",namespace:"sap.fe.macros.internal",publicNamespace:"sap.fe.macros"}),g=k({type:"string",required:true,isPublic:true}),S=k({type:"boolean",isPublic:true,bindable:true}),y=C(),M=C(),_=C(),h(w=(I=function(t){j(i,t);function i(){var e;for(var i=arguments.length,n=new Array(i),r=0;r<i;r++){n[r]=arguments[r]}e=t.call(this,...n)||this;N(e,"id",B,D(e));N(e,"visible",A,D(e));N(e,"menuButton",O,D(e));N(e,"menu",T,D(e));N(e,"saveAsTileMenuItem",z,D(e));return e}E=i;var o=i.prototype;o._initializeMenuItems=async function e(t,i){const n=await c.isTeamsModeActive();if(n){var r,o;(r=this.menuButton.current)===null||r===void 0?void 0:r.unbindProperty("visible",true);(o=this.menuButton.current)===null||o===void 0?void 0:o.setVisible(false);return}const a=t.getController();const s=i.getShellServices();const l=await s.waitForPluginsLoad();if(!l){var d;const e=(d=this.menuButton.current)===null||d===void 0?void 0:d.getAggregation("_control");e===null||e===void 0?void 0:e.attachEventOnce("press",{},()=>this._initializeMenuItems,this)}if(this.menu.current){this.menu.current.addItem(b(u,{text:this.getTranslatedText("T_SEMANTIC_CONTROL_SEND_EMAIL"),icon:"sap-icon://email",press:()=>a.share._triggerEmail()}));this._addShellBasedMenuItems(a,s)}};o._addShellBasedMenuItems=async function e(t,i){var n,r;const o=i.hasUShell();const a=!!((n=(r=i.getUser()).isJamActive)!==null&&n!==void 0&&n.call(r));const s=await d.getServiceAsync();const l=s.getOptions();if(o){if(a){var c,f;this===null||this===void 0?void 0:(c=this.menu)===null||c===void 0?void 0:(f=c.current)===null||f===void 0?void 0:f.addItem(b(u,{text:this.getTranslatedText("T_COMMON_SAPFE_SHARE_JAM"),icon:"sap-icon://share-2",press:()=>t.share._triggerShareToJam()}))}for(const e of l){var h,g,S;const t={text:e.text,icon:e.icon,items:[]};if(e!==null&&e!==void 0&&e.subOptions&&(e===null||e===void 0?void 0:(h=e.subOptions)===null||h===void 0?void 0:h.length)>0){t.items=[];e.subOptions.forEach(e=>{const i=new u({text:e.text,icon:e.icon,press:this.collaborationMenuItemPress,customData:new p({key:"collaborationData",value:e})});if(e.fesrStepName){m.setSemanticStepname(i,"press",e.fesrStepName)}t.items.push(i)})}else{t.press=this.collaborationMenuItemPress;t["customData"]=new p({key:"collaborationData",value:e})}const i=new u(t);if(t.press&&e.fesrStepName){m.setSemanticStepname(i,"press",e.fesrStepName)}this===null||this===void 0?void 0:(g=this.menu)===null||g===void 0?void 0:(S=g.current)===null||S===void 0?void 0:S.addItem(i)}const e=new v;if(e.getEnabled()){var y,M;this===null||this===void 0?void 0:(y=this.menu)===null||y===void 0?void 0:(M=y.current)===null||M===void 0?void 0:M.addItem(b(u,{ref:this.saveAsTileMenuItem,text:e.getText(),icon:e.getIcon(),press:()=>t.share._saveAsTile(this.saveAsTileMenuItem.current),children:{dependents:[e]}}))}else{e.destroy()}}};o.collaborationMenuItemPress=async function e(t){const i=t.getSource();const r=await d.getServiceAsync();const o=n.getTargetView(i);const a=o.getController();await a.share._adaptShareMetadata();const s=o.getModel("collaborationInfo").getData();r.share(i.data("collaborationData"),s)};o.getContent=function t(i,n){const o=b(f,{id:this.id,children:b(l,{ref:this.menuButton,icon:"sap-icon://action",visible:this.visible,tooltip:"{sap.fe.i18n>M_COMMON_SAPFE_ACTION_SHARE} (Ctrl+Shift+S)",children:b(s,{ref:this.menu})})});i.addDependent(b(r,{visible:this.visible,enabled:this.visible,command:"Share",execute:()=>{var e;return(e=this.menuButton.current)===null||e===void 0?void 0:e.getMenu().openBy(this.menuButton.current,true)}}));this.isInitialized=this._initializeMenuItems(i,n).catch(t=>{e.error(t)});return o};return i}(i),B=F(I.prototype,"id",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),A=F(I.prototype,"visible",[S],{configurable:true,enumerable:true,writable:true,initializer:function(){return P(true)}}),O=F(I.prototype,"menuButton",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),T=F(I.prototype,"menu",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),z=F(I.prototype,"saveAsTileMenuItem",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),I))||w);E=L;return E},false);