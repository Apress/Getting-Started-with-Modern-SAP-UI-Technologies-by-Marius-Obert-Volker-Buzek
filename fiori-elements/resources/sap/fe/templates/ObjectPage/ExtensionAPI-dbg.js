/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/converters/helpers/ID","sap/fe/core/ExtensionAPI","sap/fe/core/helpers/ClassSupport","sap/ui/core/InvisibleMessage","sap/ui/core/library","sap/ui/core/message/Message"],function(e,t,s,n,i,r,o,a){"use strict";var g,c;var p=o.MessageType;var u=o.InvisibleMessageMode;var l=i.defineUI5Class;var d=s.getSideContentLayoutID;function f(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;y(e,t)}function y(e,t){y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,s){t.__proto__=s;return t};return y(e,t)}let h=(g=l("sap.fe.templates.ObjectPage.ExtensionAPI"),g(c=function(s){f(n,s);function n(){return s.apply(this,arguments)||this}var i=n.prototype;i.refresh=function e(s){const n=this._view.getBindingContext();if(!n){return Promise.resolve()}const i=t.getAppComponent(this._view),r=i.getSideEffectsService(),o=n.getModel().getMetaModel(),a={targetProperties:[],targetEntities:[]};let g,c,p,u;if(s===undefined||s===null){a.targetEntities.push({$NavigationPropertyPath:""})}else{g=Array.isArray(s)?s:[s];p=this._controller.getOwnerComponent().getEntitySet();for(let e=0;e<g.length;e++){c=g[e];if(c===""){a.targetProperties.push("*")}else{u=o.getObject(`/${p}/${c}/$kind`);if(u==="NavigationProperty"){a.targetEntities.push({$NavigationPropertyPath:c})}else if(u){a.targetProperties.push(c)}else{return Promise.reject(`${c} is not a valid path to be refreshed`)}}}}return r.requestSideEffects([...a.targetEntities,...a.targetProperties],n)};i.getSelectedContexts=function e(t){let s=this._view.byId(t);if(s&&s.isA("sap.fe.macros.table.TableAPI")){s=s.getContent()}return s&&s.isA("sap.ui.mdc.Table")&&s.getSelectedContexts()||[]};i.showSideContent=function e(t,s){const n=d(t),i=this._view.byId(n),r=s===undefined?!i.getShowSideContent():s;i.setShowSideContent(r,false)};i.getBindingContext=function e(){return this._view.getBindingContext()};i._buildOPMessage=async function e(t){const s=this._view;const n=await s.getModel("sap.fe.i18n").getResourceBundle();let i=null;switch(t.length){case 0:break;case 1:i=t[0];break;default:const e={Error:{id:2,count:0},Warning:{id:1,count:0},Information:{id:0,count:0}};i=t.reduce((t,s)=>{const n=s.getType();t.setType(e[n].id>e[t.getType()].id?n:t.getType());e[n].count++;return t},new a({type:p.Information}));if(e.Error.count===0&&e.Warning.count===0&&e.Information.count>0){i.setMessage(n.getText("OBJECTPAGESTATE_INFORMATION"))}else if(e.Error.count>0&&e.Warning.count>0||e.Information.count>0){i.setMessage(n.getText("OBJECTPAGESTATE_ISSUE"))}else{i.setMessage(n.getText(i.getType()===p.Error?"OBJECTPAGESTATE_ERROR":"OBJECTPAGESTATE_WARNING"))}}return i};i.showMessages=async function t(s){const n=this._view;const i=n.getBindingContext("internal");try{const e=await this._buildOPMessage(s);if(e){i===null||i===void 0?void 0:i.setProperty("OPMessageStripVisibility",true);i===null||i===void 0?void 0:i.setProperty("OPMessageStripText",e.getMessage());i===null||i===void 0?void 0:i.setProperty("OPMessageStripType",e.getType());r.getInstance().announce(e.getMessage(),u.Assertive)}else{this.hideMessage()}}catch(t){e.error("Cannot display ObjectPage message")}};i.hideMessage=function e(){const t=this._view;const s=t.getBindingContext("internal");s===null||s===void 0?void 0:s.setProperty("OPMessageStripVisibility",false)};return n}(n))||c);return h},false);