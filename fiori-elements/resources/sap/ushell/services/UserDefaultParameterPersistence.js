// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/deepExtend","sap/base/util/ObjectPath","sap/ui/thirdparty/jquery"],function(e,t,r,n){"use strict";var i=["value","extendedValue","noEdit","alwaysAskPlugin","_shellData","pluginData"];function s(e){this._oAdapter=e;this._oData={}}s.prototype._cleanseValue=function(e){var r=t({},e);for(var n in r){if(r.hasOwnProperty(n)&&i.indexOf(n)<0){delete r[n]}}return r};s.prototype._getSystemContextPromise=function(t){if(!t){e.warning("UserDefaultParameterPersistence: The systemContext was not provided, using defaultSystemContext as fallback");return sap.ushell.Container.getServiceAsync("ClientSideTargetResolution").then(function(e){return e.getSystemContext()})}return Promise.resolve(t)};s.prototype.loadParameterValue=function(t,i){var s=new n.Deferred;this._getSystemContextPromise(i).then(function(n){var i=r.get([n.id,t],this._oData);if(i!==undefined){s.resolve(i)}else{this._oAdapter.loadParameterValue(t,n).done(function(i){var a=this._cleanseValue(i);r.set([n.id,t],a,this._oData);e.debug('[UserDefaults] Fetched "'+t+'" for SystemContext='+n.id+" from Persistence",JSON.stringify(a,null,2));s.resolve(a)}.bind(this)).fail(s.reject.bind(this))}}.bind(this));return s.promise()};s.prototype.saveParameterValue=function(t,i,s){var a=new n.Deferred;var o;this._getSystemContextPromise(s).then(function(n){if(!i){return this.deleteParameter(t,n).done(a.resolve).fail(a.reject)}o=this._cleanseValue(i);if(i&&i.noStore===true){e.debug('[UserDefaults] Skipped Save "'+t+'" for SystemContext='+n.id,"noStore=true");return a.resolve()}e.debug('[UserDefaults] Saving "'+t+'" for SystemContext='+n.id+" to Persistence",JSON.stringify(o,null,2));r.set([n.id,t],o,this._oData);return this._oAdapter.saveParameterValue(t,o,n).done(a.resolve).fail(a.reject)}.bind(this));return a.promise()};s.prototype.deleteParameter=function(t,r){var i=new n.Deferred;this._getSystemContextPromise(r).then(function(r){if(this._oData[r.id]){e.debug('[UserDefaults] Deleting "'+t+'" for SystemContext='+r.id+" from Persistence");delete this._oData[r.id][t]}return this._oAdapter.deleteParameter(t,r).done(i.resolve).fail(i.reject)}.bind(this));return i.promise()};s.prototype.getStoredParameterNames=function(e){var t=new n.Deferred;this._getSystemContextPromise(e).then(function(e){this._oAdapter.getStoredParameterNames(e).done(function(e){e.sort();t.resolve(e)}).fail(t.reject.bind(t))}.bind(this));return t.promise()};s.hasNoAdapter=false;return s},true);