// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["./History","sap/base/Log","sap/base/util/extend","sap/base/util/isPlainObject","sap/m/InstanceManager","sap/ui/core/Component","sap/ui/core/Configuration","sap/ui/core/Core","sap/ui/core/library","sap/ui/core/mvc/Controller","sap/ui/core/routing/HashChanger","sap/ui/core/routing/History","sap/ui/Device","sap/ui/performance/Measurement","sap/ui/thirdparty/hasher","sap/ui/thirdparty/jquery","sap/ui/util/Storage","sap/ushell/ApplicationType","sap/ushell/bootstrap/SchedulingAgent","sap/ushell/components/_HeaderManager/ControlManager","sap/ushell/components/applicationIntegration/AppLifeCycle","sap/ushell/components/applicationIntegration/relatedServices/RelatedServices","sap/ushell/components/HeaderManager","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/library","sap/ushell/performance/FesrEnhancer","sap/ushell/renderers/fiori2/LogonFrameProvider","sap/ushell/resources","sap/ushell/services/AppConfiguration","sap/ushell/UserActivityLog","sap/ushell/utils","sap/ushell/utils/WindowUtils"],function(e,t,i,n,a,o,s,r,l,h,c,p,d,g,u,f,v,m,C,y,w,S,b,A,_,P,D,H,F,U,I,N,k){"use strict";var E=l.routing.HistoryDirection;var T=P.AppType;var R=true;var L=false;var M;var B=w.getElementsModel();var x;var W={embedded:0,newWindowThenEmbedded:1,newWindow:1,replace:0};var O={embedded:"embedded",newWindowThenEmbedded:"newWindowThenEmbedded",newWindow:"newWindow",replace:"replace"};var V={};D.init();return h.extend("sap.ushell.renderers.fiori2.Shell",{_aDoables:[],onComponentTargetDisplay:function(e){var t=e.getParameters();var i=t.control;var n=t.object;if(this.bRestorePreviousHash){this.bRestorePreviousHash=false}i.navTo("centerViewPort",n.getId(),"show")},onInit:function(){var t=this;var i=o.getOwnerComponentFor(this.getView()).getRouter();i.getTarget("home").attachDisplay(this.onComponentTargetDisplay,this);i.getTarget("appfinder").attachDisplay(this.onComponentTargetDisplay,this);i.getTarget("pages").attachDisplay(this.onComponentTargetDisplay,this);i.getTarget("workpages").attachDisplay(this.onComponentTargetDisplay,this);i.getTarget("runtimeSwitcher").attachDisplay(this.onComponentTargetDisplay,this);i.getTarget("wzsearch").attachDisplay(this.onComponentTargetDisplay,this);if(A.last("/core/homeApp/enabled")){i.getTarget("homeapp").attachDisplay(this.onComponentTargetDisplay,this)}i.oHashChanger=c.getInstance();i.initialize(true);this.bEnableHashChange=true;R=true;var n=this.getView();var a=window.matchMedia("(min-width: 600px)");var s=(n.getViewData()?n.getViewData().config:{})||{};w.parseStatefulContainerConfiguration(s.statefulApplicationContainer);var l=w.shellElements().model();b.init(s,l);this.initShellModel(s,l);var h=this.getView().updateShellAggregation;r.byId("shell-header").updateAggregation=h;r.byId("shell").updateAggregation=h;r.byId("right-floating-container").updateAggregation=h;r.byId("shell-split").updateAggregation=h;var p=function(e){A.emit("/core/shell/model/isPhoneWidth",!e.matches)};if(a.addListener){a.addListener(p);p(a)}n.setModel(F.i18nModel,"i18n");r.getEventBus().subscribe("externalSearch",this.externalSearchTriggered,this);r.getEventBus().subscribe("sap.ushell","appOpened",this.onAppOpened,this);r.getEventBus().subscribe("allSearchFinished",this._logSearchActivity,this);this._setConfigurationToModel();this._aDoables=this._registerAndCreateEventHubDoables();M.addHeaderEndItem(["userActionsMenuHeaderButton"],false,["home","app","minimal","standalone","embedded","embedded-home","lean"],true);var g=[];if(s&&!s.moveContactSupportActionToShellHeader){g.push("ContactSupportBtn")}this.history=new e;this.oViewPortContainer=r.byId("viewPortContainer");w.init(s.appState,this.oViewPortContainer,s.rootIntent,s.disableHomeAppCache,{ownerComponent:this.getOwnerComponent()},g,s.cacheConfiguration);var u=function(e,n){this.oShellNavigation=e;this.oShellNavigation.registerPrivateFilters(n);this.oShellNavigation.registerExtraRouter(i);this.oShellNavigation.registerNavigationFilter(this._handleEmptyHash.bind(this));this.oShellNavigation.init(this.doHashChange.bind(this));this.oShellNavigation.registerNavigationFilter(this._disableSourceAppRouter.bind(this));this.oShellNavigation.registerNavigationFilter(this.handleDataLoss.bind(this));this.oShellNavigation.hashChanger.attachEvent("hashChanged",function(e){if(window.hasher.disableBlueBoxHashChangeTrigger===true){return}if(e.mParameters&&t.oShellNavigation.hashChanger.isInnerAppNavigation(e.mParameters.newHash,e.mParameters.oldHash)){w.postMessageToIframeApp("sap.ushell.appRuntime","innerAppRouteChange",{oHash:e.mParameters})}w.postMessageToIframeApp("sap.ushell.appRuntime","hashChange",{sHash:e.mParameters.fullHash})});_.emit("ShellNavigationInitialized")}.bind(this);Promise.all([sap.ushell.Container.getServiceAsync("URLParsing"),sap.ushell.Container.getServiceAsync("ShellNavigation"),sap.ushell.Container.getServiceAsync("AppLifeCycle")]).then(function(e){this.oURLParsing=e[0];var t=e[1];this._oAppLifeCycleService=e[2];u(t,this._oAppLifeCycleService)}.bind(this));sap.ushell.Container.setLogonFrameProvider(this._getLogonFrameProvider());if(d.system.desktop){sap.ui.require(["sap/ushell/renderers/fiori2/AccessKeysHandler"],function(e){e.init(x)})}window.onbeforeunload=function(){if(sap.ushell.Container&&sap.ushell.Container.getDirtyFlag()&&!(d.browser.name===d.browser.BROWSER.INTERNET_EXPLORER&&w.getCurrentApplication().container.getApplicationType()===m.NWBC.type)){if(!F.browserI18n){F.browserI18n=F.getTranslationModel(window.navigator.language).getResourceBundle()}return F.browserI18n.getText("dataLossExternalMessage")}return undefined};if(A.last("/core/shell/model/contentDensity")){w.getAppMeta()._applyContentDensityClass()}this.initShellUIService();if(!s.disableSignOut&&(s.sessionTimeoutTileStopRefreshIntervalInMinutes>0||s.sessionTimeoutReminderInMinutes>0)){this._createSessionHandler(s)}if(d.system.desktop){sap.ui.require(["sap/ushell/renderers/fiori2/AccessKeysHandler"],function(e){this.oViewPortContainer.onfocusin=function(){e.bFocusOnShell=false;e.bFocusPassedToExternalHandlerFirstTime=false};this.oViewPortContainer.onfocusout=function(){e.bFocusOnShell=true;e.bFocusPassedToExternalHandlerFirstTime=true}}.bind(this))}},shellUpdateAggItem:function(e,t){return r.byId(t.getObject())},getViewPortContainer:function(){return r.byId("viewPortContainer")},_registerAndCreateEventHubDoables:function(){var e=[_.once("CenterViewPointContentRendered").do(this._loadCoreExt.bind(this)),_.once("PagesRuntimeRendered").do(this._loadCoreExt.bind(this)),_.once("AppRendered").do(this._loadCoreExtNonUI5.bind(this)),_.on("toggleContentDensity").do(this.toggleContentDensity.bind(this)),_.on("ShellFloatingContainerDockedIsResized").do(this._onResizeWithDocking.bind(this)),_.on("LaunchpadCustomRouterRouteMatched").do(this._centerViewPort.bind(this)),_.once("CoreResourcesComplementLoaded").do(this._onCoreResourcesComplementLoaded.bind(this)),_.once("loadRendererExtensions").do(this._loadRendererExtensionPlugins.bind(this)),_.once("loadUsageAnalytics").do(this._loadUsageAnalytics.bind(this)),_.once("loadWarmupPlugins").do(this._loadWarmupPlugins.bind(this)),_.once("loadTrackingActivitiesSetting").do(this._loadTrackingActivitiesSetting.bind(this)),_.on("centerViewPort").do(this._centerViewPort.bind(this))];return e},initShellModel:function(e,t){M=B;M.init(e,t);x=this.getView().getViewData().shellModel;A.emit("/core/shell/model/personalization",A.last("/core/shell/enablePersonalization"))},initShellUIService:function(){w.initShellUIService({fnOnBackNavigationChange:this.onBackNavigationChange.bind(this)});if(V.enableOnlineStatus){sap.ui.require(["sap/ushell/ui5service/UserStatus"],function(e){this.oUserStatus=new e({scopeObject:this.getOwnerComponent(),scopeType:"component"})}.bind(this))}},onBackNavigationChange:function(e){w.setBackNavigationChanged(true);var t=e.getParameters().data;var i=A.last("/core/shell/model/currentState");if(t){w.service().setNavigateBack(t);if(i.stateName==="minimal"||i.stateName==="standalone"||i.stateName==="embedded"){sap.ushell.Container.getRenderer("fiori2").showHeaderItem("backBtn",true)}}else{w.service().resetNavigateBack()}},toggleContentDensity:function(e){var t=e.contentDensity==="compact";w.getAppMeta()._applyContentDensityByPriority(t,true)},_handleEmptyHash:function(e){e=typeof e==="string"?e:"";e=e.split("?")[0];if(e.length===0){var t=this.getView()?this.getView().getViewData():{};V=t.config||{};if(V.migrationConfig){return this.oShellNavigation.NavigationFilterStatus.Continue}if(V.rootIntent){window.setTimeout(function(){window.hasher.setHash(V.rootIntent)},0);return this.oShellNavigation.NavigationFilterStatus.Abandon}}return this.oShellNavigation.NavigationFilterStatus.Continue},_setConfigurationToModel:function(){var e=this.getView().getViewData();if(e){V=e.config||{}}if(V){if(V.states){B.extendStates(V.states);b.extendStates(V.states)}if(V.enableSetTheme!==undefined){x.setProperty("/setTheme",V.enableSetTheme)}x.setProperty("/contentDensity",V.enableContentDensity===undefined?true:V.enableContentDensity);if(V.migrationConfig!==undefined){x.setProperty("/migrationConfig",V.migrationConfig)}if(V.enableUserDefaultParameters!==undefined){x.setProperty("/userDefaultParameters",V.enableUserDefaultParameters)}if(V.disableHomeAppCache!==undefined){x.setProperty("/disableHomeAppCache",V.disableHomeAppCache)}x.setProperty("/enableHelp",A.last("/core/extension/enableHelp"));x.setProperty("/searchAvailable",V.enableSearch!==false)}},_loadTrackingActivitiesSetting:function(e){this._getPersData({container:"flp.settings.FlpSettings",item:"userActivitesTracking"}).then(function(t){if(t===undefined){t=true}x.setProperty("/enableTrackingActivity",t);_.emit("StepDone",e.stepName)}).catch(function(i){_.emit("StepFailed",e.stepName);t.error("Failed to load tracking activities state from the personalization",i,"sap.ushell.components.flp.settings.FlpSettings")})},_getPreviousPageDirty:function(){return L},_setPreviousPageDirty:function(e){L=e},getModelConfiguration:function(){var e=this.getView().getViewData();var t;if(e){var n=e.config||{};t=i({},n)}delete t.applications;return t},_getLogonFrameProvider:function(){return H},onExit:function(){this._aDoables.forEach(function(e){e.off()});this._aDoables=[];r.getEventBus().unsubscribe("externalSearch",this.externalSearchTriggered,this);r.getEventBus().unsubscribe("allSearchFinished",this._logSearchActivity,this);r.getEventBus().unsubscribe("sap.ushell","appOpened",this.onAppOpened,this);if(this.oShellNavigation){this.oShellNavigation.hashChanger.destroy()}if(this.getView()&&this.getView().destroyDanglingControls){this.getView().destroyDanglingControls()}var e=r.byId("shell-header");if(e&&e.destroy){e.destroy()}b.destroy();y.destroy();I.deactivate();M.destroy();w.shellElements().clean();w.destroy();M=undefined},_getCurrentAppRouter:function(){var e=this._oAppLifeCycleService;var t=e&&e.getCurrentApplication&&e.getCurrentApplication();var i=t&&t.componentInstance;if(i){return i.getRouter()}return null},_disableSourceAppRouter:function(e,t){if(!this.bEnableHashChange||this.bRestorePreviousHash){return this.oShellNavigation.NavigationFilterStatus.Continue}var i=this.oShellNavigation.hashChanger.isInnerAppNavigation(e,t);if(!i){var n=this._getCurrentAppRouter();if(n){n.stop()}}return this.oShellNavigation.NavigationFilterStatus.Continue},_resumeAppRouterIgnoringCurrentHash:function(){var e=this._getCurrentAppRouter();if(e){e.initialize(true)}},handleDataLoss:function(e,t){var i=this.oShellNavigation.hashChanger;var n=i.getReloadApplication();if(this.bReloadApplication!==null&&this.bReloadApplication!==undefined){i.setReloadApplication(this.bReloadApplication);this.bReloadApplication=null}if(t===""||u.disableBlueBoxHashChangeTrigger===true){return this.oShellNavigation.NavigationFilterStatus.Continue}if(!this.bEnableHashChange&&!this.bRedoNavigation){this.bEnableHashChange=true;return this.oShellNavigation.NavigationFilterStatus.Custom}if(this.bRestorePreviousHash){return this.oShellNavigation.NavigationFilterStatus.Continue}if(this.bRedoNavigation){this.bRedoNavigation=false;this.bEnableHashChange=true;this.bExplaceNavigation=false;return this.oShellNavigation.NavigationFilterStatus.Continue}var a=this.oURLParsing.parseShellHash(e);var o=sap.ushell.Container.getRenderer()._isBuiltInIntent(a);var s=a.params["sap-ushell-navmode"];var r=s&&s[0];if(!o&&(this.bExplaceNavigation||r==="explace"||r==="frameless")){this.bExplaceNavigation=false;return this.oShellNavigation.NavigationFilterStatus.Continue}var l=sap.ushell.Container.getDirtyFlag();var h=sap.ushell.Container.isAsyncDirtyStateProviderSet();if(!h&&!l){L=l;return this.oShellNavigation.NavigationFilterStatus.Continue}var c=p.getInstance().getHistoryStateOffset()<0;Promise.all([this._waitForHash(t),sap.ushell.Container.getServiceAsync("NavTargetResolution"),sap.ushell.Container.getDirtyFlagsAsync()]).then(function(t){var i=t[1];var a=t[2];L=a;if(!a){this.bRedoNavigation=true;this._restoreHashUsingAction(e,"redo");return}if(o){if(this._handleDirtyStateUserConfirm()){this.bRedoNavigation=true;this._restoreHashUsingAction(e,"redo")}}else{var s="#"+e;i.resolveHashFragment(s).then(function(t){var i=t.targetNavigationMode==="explace"||t.targetNavigationMode==="frameless";var a=c&&t.navigationMode===O.newWindowThenEmbedded;if(i&&!a){this.bExplaceNavigation=true;this.bRedoNavigation=true;this._restoreHashUsingAction(e,"redo")}else if(this._handleDirtyStateUserConfirm()){this.bRedoNavigation=true;this.bReloadApplication=n;this._restoreHashUsingAction(e,"redo")}}.bind(this)).catch(function(){this.bRedoNavigation=true;this._restoreHashUsingAction(e,"redo")}.bind(this))}}.bind(this));return this._restoreHashUsingAction(t,"undo")},_waitForHash:function(e){var t="#"+e;return new Promise(function(e){var i=function(){var n=t===decodeURIComponent(window.location.hash);if(n){window.removeEventListener("hashchange",i);e()}};window.addEventListener("hashchange",i)})},_handleDirtyStateUserConfirm:function(){if(window.confirm(F.i18n.getText("dataLossInternalMessage"))){sap.ushell.Container.setDirtyFlag(false);w.postMessageToIframeApp("sap.ushell.appRuntime","setDirtyFlag",{bIsDirty:false});if(S.isBackNavigation()===true){S.resetBackNavigationFlag()}L=true;return true}return false},_restoreHashUsingAction:function(e,t){var i=this.oShellNavigation.wasHistoryEntryReplaced();var n=this._getRestoreHashStrategy(i,t);this._resumeAppRouterIgnoringCurrentHash();return this._restoreHash(n,e)},_getRestoreHashStrategy:function(e,t){if(e){return{strategy:"replaceHash",stepCount:0}}var i;var n=p.getInstance().getHistoryStateOffset();if(n===undefined||n>=0){n=1}else if(n<0){n=-1}if(t==="undo"){if(n<0){i="historyForward"}else{i="historyBack"}this.sLastUndoStrategy=i}else{switch(this.sLastUndoStrategy){case"historyBack":i="historyForward";break;case"historyForward":i="historyBack";break;default:i="replaceHash"}}return{strategy:i,stepCount:1}},_restoreHash:function(e,t){var i={status:this.oShellNavigation.NavigationFilterStatus.Custom,hash:""};switch(e.strategy){case"historyBack":this.bEnableHashChange=false;this._windowHistoryBack(e.stepCount);break;case"historyForward":this.bEnableHashChange=false;this._windowHistoryForward(e.stepCount);break;case"replaceHash":this.bEnableHashChange=false;u.replaceHash(t);break;default:throw new Error("Cannot execute unknown navigation strategy")}return i},_isColdStart:function(){var e=sap.ushell.Container.getRenderer("fiori2");var t=!e||!e.getCurrentCoreView();if(this.history.getHistoryLength()<=1&&t){return true}this._isColdStart=function(){return false};return false},_setEnableHashChange:function(e){this.bEnableHashChange=e},_logRecentActivity:function(e){if(!this.oInitialEnableTrackingPromise){if(A.last("/core/shell/model/enableTrackingActivity")!==undefined){this.oInitialEnableTrackingPromise=Promise.resolve()}else{this.oInitialEnableTrackingPromise=new Promise(function(e,t){A.once("/core/shell/model/enableTrackingActivity").do(e)})}}return this.oInitialEnableTrackingPromise.then(function(){if(A.last("/core/shell/model/enableTrackingActivity")){return new Promise(function(t,i){U.addActivity(e).done(t).fail(i)})}t.warning("Tracking is not enabled",null,"sap.ushell.renderers.fiori2.Shell.controller");return undefined})},_logApplicationUsage:function(e){if(sap.ushell.Container){sap.ushell.Container.getServiceAsync("UserRecents").then(function(t){t.addAppUsage(e)})}},doHashChange:function(e,t,i,n,a){g.start("FLP:ShellController.doHashChange","doHashChange","FLP");N.setPerformanceMark("FLP-ShellController-doHashChange-begin");_.emit("trackHashChange",e);var o=r.byId("sapUshellDashboardPage");if(o){o.setBlocked(true);o.setBusy(true)}return this._doHashChange(this,e,t,i,n,a).then(function(){g.end("FLP:ShellController.doHashChange")},function(e){g.end("FLP:ShellController.doHashChange");_.emit("doHashChangeError",Date.now());if(o){o.setBlocked(false);o.setBusy(false)}})},_doHashChange:function(e,t,i,n,o,s){this._wasHistoryEntryReplaced=this.oShellNavigation.wasHistoryEntryReplaced();this.oShellNavigation.resetHistoryEntryReplaced();var l;if(!this.bEnableHashChange){this.bEnableHashChange=true;return f.when()}if(this.bRestorePreviousHash){this.bRestorePreviousHash=false;return f.when()}if(s){e.hashChangeFailure(e.history.getHistoryLength(),s.message,null,"sap.ushell.renderers.fiori2.Shell.controller",false);return f.when()}var h=new f.Deferred;if(a&&R){a.closeAllDialogs();a.closeAllPopovers()}R=true;var c=e.history.getHistoryLength();var p=e.fixShellHash(t);var d=e.fixShellHash(n);e.history.hashChange(p,n);e.currentAppBeforeNav=U.getCurrentApplication();e._resolveHashFragment(p).then(function(t,a){var s=a?a.semanticObject+"-"+a.action:"";var u=e._getConfig();var v=!!(t&&t.componentHandle);var m=t&&t.ui5ComponentName;t=e._calculateNavigationMode(a,t);e._handleEarlyNavigation(p,i,t).then(function(C){if(C!==true){if(u&&u.applications&&u.applications[s]){t.applicationConfiguration=u.applications[s]}l=w.getInMemoryInstance(s,p,i,n);if(l.isInstanceSupported){e._initiateApplication(t,p,a,c,i,d,o);h.resolve();return}if(v||!m){var y=new f.Deferred;if((t.applicationType==="URL"||t.applicationType==="GUI"||t.applicationType==="TR"||t.applicationType==="NWBC"||t.applicationType==="WDA"||t.applicationType==="WCF")&&l.isInstanceSupported===false&&l.appId){w.destroy(l.appId,l.container,y)}else{y.resolve()}y.done(function(){e._initiateApplication(t,p,a,c,i,d,o);h.resolve()});return}w.destroy(l.appId,l.container);w.removeApplication(s);U.setApplicationInInitMode();r.getEventBus().publish("ApplicationContainer","_prior.newUI5ComponentInstantion",{name:m});g.start("FLP:ShellController.UI5createComponent","UI5 createComponent","FLP");sap.ushell.Container.getServiceAsync("Ui5ComponentLoader").then(function(){w.createComponent(t,a).done(function(){g.end("FLP:ShellController.UI5createComponent");e._initiateApplication(t,p,a,c,i)}).fail(function(t){var i=F.i18n.getText("cannot_load_ui5_component_details",[p]);var n="Failed to load UI5 component for navigation intent "+p;U.setCurrentApplication(e.currentAppBeforeNav);e.hashChangeFailure(c,{title:F.i18n.getText("error"),message:F.i18n.getText("failed_to_open_ui5_component"),technicalMessage:n},{info:i,technicalMessage:t.message+"\n"+t.stack},"sap.ushell.renderers.fiori2.Shell.controller",false)})})}h.resolve()})},function(t){var i=F.i18n.getText("cannot_resolve_navigation_target_details",[p]);var n="Failed to resolve navigation target: "+p+". This is most likely caused by an incorrect SAP Fiori launchpad content configuration or by missing role assignment.";e.hashChangeFailure(c,{title:F.i18n.getText("error"),message:F.i18n.getText("failed_to_open_app_missing_configuration_or_role_assignment"),technicalMessage:n},{info:i,fixedShellHash:p,technicalMessage:t},"sap.ushell.renderers.fiori2.Shell.controller",false);h.reject(n)});return h.promise()},_handleEarlyNavigation:function(e,t,i){var n=this;var a;return new Promise(function(o){n._openAppViaNWBC(i).then(function(s){if(s===true){i.sFixedShellHash=e;n.logOpenAppAction(i,t);a=r.byId("sapUshellDashboardPage");if(a){a.setBlocked(false);a.setBusy(false)}o(true);return}var l=i&&i.navigationMode===O.newWindow;if(l){i.sFixedShellHash=e;n.logOpenAppAction(i,t);n._openAppInNewWindowAndRestore(i);a=r.byId("sapUshellDashboardPage");if(a){a.setBlocked(false);a.setBusy(false)}o(true);return}if(A.last("/core/shell/model/migrationConfig")){V.migrationConfig=false;n.getModel().setProperty("/migrationConfig",false);if(i&&e==="#"){V.rootIntent=""}else if(e==="#"){window.setTimeout(function(){window.hasher.setHash(V.rootIntent)},0);o(true);return}}o(false);return})})},_initiateApplication:function(e,i,n,a,o,s,r){g.start("FLP:ShellController._initiateApplication","_initiateApplication","FLP");var l=U.getMetadata(e);var h=A.last("/core/extension/SupportTicket");var c;if(l.title){window.document.title=l.title}else{t.debug("Shell controller._initiateApplication: the title of the window is not changed because most probably the application was resolved with undefined")}if(h){window.setTimeout(function(){I.activate()},0)}try{c=this.oShellNavigation.isInitialNavigation();this.navigate(n,i,l,e,s)}catch(e){if(e.stack){t.error("Application initialization (Intent: \n"+i+"\n failed due to an Exception:\n"+e.stack)}this.oShellNavigation.setIsInitialNavigation(c);this.hashChangeFailure(a,e.name,e.message,l?l.title:"",false)}g.end("FLP:ShellController._initiateApplication")},_resolveHashFragment:function(e){g.start("FLP:ShellController._resolveHashFragment","_resolveHashFragment","FLP");var t=this.oURLParsing.parseShellHash(e);var i=new f.Deferred;var n=this._getConfig();if(window["sap-ushell-async-libs-promise-directstart"]){window["sap-ushell-async-libs-promise-directstart"].then(function(e){i.resolve(e.resolvedHashFragment,t);delete window["sap-ushell-async-libs-promise-directstart"]},function(e){i.reject(e);delete window["sap-ushell-async-libs-promise-directstart"]});return i.promise()}sap.ushell.Container.getServiceAsync("NavTargetResolution").then(function(a){a.resolveHashFragment(e).done(function(e){U.setCurrentApplication(e);if(t&&t.semanticObject+"-"+t.action===n.rootIntent){e.navigationMode="embedded"}g.end("FLP:ShellController._resolveHashFragment");N.setPerformanceMark("FLP-ShellController-resolveHashFragment-end");i.resolve(e,t)}).fail(function(e){i.reject(e)})});return i.promise()},_calculateNavigationMode:function(e,t){if(!t){return undefined}var i=t.navigationMode;if(i===O.newWindowThenEmbedded){if(this._isColdStart()||p.getInstance().getDirection()===E.Backwards){t.navigationMode=O.embedded}else{t.navigationMode=O.newWindow;if(!N.isNativeWebGuiNavigation(t)){t.url=this._getCurrentLocationHash()}}return t}if(i===O.newWindow&&this._isColdStart()){if(this._hasAppCapabilitiesNavigationMode(t)&&t.appCapabilities.navigationMode===O.embedded){t.navigationMode=O.embedded;return t}t.navigationMode=O.replace;return t}if(i===O.newWindow&&this._hasAppCapabilitiesNavigationMode(t)&&t.appCapabilities.navigationMode===O.embedded){t.url=this._getCurrentLocationHash()}return t},_hasAppCapabilitiesNavigationMode:function(e){return N.isPlainObject(e.appCapabilities)&&e.appCapabilities.hasOwnProperty("navigationMode")},_usesNavigationRedirect:function(e){if(!e){return(new f.Deferred).reject().promise()}var i=this;var n=e.getInstance({});if(n&&typeof n.navigationRedirect==="function"){var a=new f.Deferred;var o=n.navigationRedirect();if(o&&typeof o.then==="function"){o.then(function(e){t.warning("Performing navigation redirect to hash "+e);n.destroy();i.history.pop();sap.ushell.Container.getServiceAsync("ShellNavigation").then(function(t){t.toExternal({target:{shellHash:e}},undefined,false);a.resolve(true)})},function(){a.reject()});return a.promise()}}return(new f.Deferred).reject().promise()},navigate:function(e,t,i,a,o){g.start("FLP:ShellController.navigate","navigate","FLP");var s=n(a)?a.navigationMode:null;var r=this;if(s===null){if(this._isColdStart()){window.hasher.setHash("");return}this.bEnableHashChange=false;this.history.pop();this._windowHistoryBack(1);return Promise.resolve()}a=this._calculateNavigationMode(e,a);s=n(a)?a.navigationMode:null;if(s===O.embedded){if(!this._isColdStart()&&!this._wasHistoryEntryReplaced){this.oShellNavigation.setIsInitialNavigation(false)}var l=this._usesNavigationRedirect(a.componentHandle);var h=new Promise(function(n,s){l.then(null,function(){r._handleEmbeddedNavMode(t,e,i,a,o).then(function(){_.emit("CloseFesrRecord",{date:Date.now(),technicalName:i.technicalName});n()})});g.end("FLP:ShellController.navigate")});return h}if(s===O.replace){this.oShellNavigation.setIsInitialNavigation(false);this.bEnableHashChange=false;this._changeWindowLocation(a.url);return Promise.resolve()}if(s===O.newWindow){this._openAppInNewWindowAndRestore(a);return Promise.resolve()}this.hashChangeFailure(this.history.getHistoryLength(),"Navigation mode is not recognized",null,"sap.ushell.renderers.fiori2.Shell.controller",false);return Promise.resolve()},_openAppViaNWBC:function(e){var i=this;return new Promise(function(n){var a;if(e&&(N.isNativeWebGuiNavigation(e)||e.nativeNWBCNavigation)){a=true}else{a=false}if(a===false){n(false);return}var o=N.getPrivateEpcm();var s=W[e.navigationMode];var l;var h;if(N.hasNavigationModeCapability()){h=s||W[O.embedded]}var c=i._appendUserIdToUrl("sap-user",e.url).then(function(t){l=N.appendSapShellParam(t);return new Promise(function(t){try{var i=e.applicationType;var n=e.appCapabilities&&e.appCapabilities.appFrameworkId;var a={};var o=[];var s;var r=function(){a["sap-flp-url"]=sap.ushell.Container.getFLPUrl(true);a["system-alias"]=e.systemAlias;return[{name:"sap-flp-params",value:JSON.stringify(a)}]};var h=function e(t,i){var n=[];var a=function(e,a){if(t.indexOf(e+"=")>0){var o=new RegExp("(?:"+e+"=)([^&/]+)").exec(t);if(o&&o.length===2){n.push([o[1]]);i.push(a)}}};a("sap-iapp-state","sap-iapp-state-data");a("sap-xapp-state","sap-xapp-state-data");a("sap-intent-param","sap-intent-param-data");return n};if(i==="GUI"||i==="TR"||i==="NWBC"||i==="WDA"||i==="WCF"||n==="GUI"||n==="WDA"||n==="NWBC"||n==="WCF"){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){s=h(l,o);if(s.length>0){e.getAppStateData(s).then(function(e){o.forEach(function(t,i){if(e[i][0]){a[t]=e[i][0]}});t(r())},function(e){t()})}else{t(r())}})}else{t()}}catch(e){t()}})});c.then(function(a){try{r.getEventBus().publish("launchpad","appOpening",e);if(!o.doNavigate(l,h,undefined,undefined,undefined,undefined,undefined,a)){n(false);return}r.getEventBus().publish("sap.ushell","appOpened",e);i._restoreAfterNwbcNavigation(e).then(function(){if(i._oAppLifeCycleService.getCurrentApplication()&&i._oAppLifeCycleService.getCurrentApplication().homePage){i._setMenuVisible(true)}n(true)})}catch(a){if(a.stack){t.error("Application initialization failed due to an Exception:\n"+a.stack)}i.hashChangeFailure(i.history.getHistoryLength(),a.name,a.message,e.text,false);n(false)}})})},_restoreAfterNwbcNavigation:function(e){if(this.history.getHistoryLength()===1&&!this._oAppLifeCycleService.getCurrentApplication()){return sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){e.toExternal({target:{shellHash:"#"},writeHistory:false})})}this._restorePreviousHashAfterOpenNewWindow(e);return Promise.resolve()},_appendUserIdToUrl:function(e,t){return sap.ushell.Container.getServiceAsync("UserInfo").then(function(i){var n=i.getUser().getId();var a=t.indexOf("?")>=0?"&":"?";return t+a+e+"="+n})},_restorePreviousHashAfterOpenNewWindow:function(e){this.history.pop();var t=e.componentHandle&&e.componentHandle.getInstance&&e.componentHandle.getInstance({});if(t){t.destroy()}this._resumeAppRouterIgnoringCurrentHash();this.bRestorePreviousHash=true;this._windowHistoryBack(1);U.setCurrentApplication(this.currentAppBeforeNav);_.emit("openedAppInNewWindow",Date.now())},_openAppInNewWindowAndRestore:function(e){r.getEventBus().publish("launchpad","appOpening",e);this._openAppNewWindow(e.url);r.getEventBus().publish("sap.ushell","appOpened",e);this._restorePreviousHashAfterOpenNewWindow(e)},_handleEmbeddedNavMode:function(e,t,i,n,a){g.start("FLP:ShellController._handleEmbeddedNavMode","_handleEmbeddedNavMode","FLP");var o=this._getConfig();this.resetShellUIServiceHandlers();w.getAppMeta().setAppIcons(i);var s="-"+t.semanticObject+"-"+t.action;var r=e==="#"||o.rootIntent&&N.getBasicHash(o.rootIntent)===t.semanticObject+"-"+t.action;var l=t?t.semanticObject+"-"+t.action:"";w.switchViewState(w.shellElements().calculateElementsState(r?"home":"app",n.applicationType,o.appState,n.explicitNavMode),undefined,s);if(r){w.getShellUIService().setBackNavigation()}var h=w.handleControl(l,s,t,n,this.getWrappedApplicationWithMoreStrictnessInIntention.bind(this),e,a);if(this.currentAppBeforeNav){var c;c=w.getWebGuiV1StatefulContainer(this.currentAppBeforeNav.url);if(c){c.onApplicationOpened(n.applicationType)}}g.end("FLP:ShellController._handleEmbeddedNavMode");return h},_centerViewPort:function(){this.oViewPortContainer.switchState("Center")},_isShellHomeIntent:function(e){return e==="#"||e===V.rootIntent},getWrappedApplicationWithMoreStrictnessInIntention:function(e,i,n,a,o,s,l){var h=this;if(d.system.desktop){sap.ui.require(["sap/ushell/renderers/fiori2/AccessKeysHandler"],function(e){var t=r.byId("shellAppTitle");if(t&&A.last("/core/shell/model/currentState/stateName")==="app"){var i=t.getFocusDomRef();if(i){e.sendFocusBackToShell(i.getAttribute("id"))}}})}window.setTimeout(function(){window.setTimeout(function(){h.readNavigationEnd()},600);r.getEventBus().publish("launchpad","appOpening",a);t.info("app is being opened")},0);if(V.applications){a.applicationConfiguration=V.applications[e]}var c=w.getAppContainer(o,a,this._isColdStart(),n,l);a.sFixedShellHash=l;w.publishNavigationStateEvents(c,a,this.onAppAfterRendering.bind(this,a));var p=c.getApplicationType();var u=c.getFrameworkId();if(p==="GUI"||p==="TR"||p==="WDA"||p==="NWBC"||p==="WCF"||u==="GUI"||u==="WDA"||u==="NWBC"||u==="WCF"){c.addStyleClass("sapUShellApplicationContainerShiftedIframe")}if(!s){c.addStyleClass("sapUShellApplicationContainerLimitedWidth")}if(this._isDock()&&window.matchMedia("(min-width: 106.4rem)").matches){c.addStyleClass("sapUShellDockingContainer");c.removeStyleClass("sapUShellApplicationContainerLimitedWidth")}else if(this._isDock()){c.removeStyleClass("sapUShellApplicationContainerLimitedWidth")}c.toggleStyleClass("sapUshellDefaultBackground",!i.hideLightBackground);w.getAppMeta()._applyContentDensityByPriority();w.addControl(c);N.setPerformanceMark("FLP - addAppContainer");g.end("FLP:ShellController.getWrappedApplication");return c},resetShellUIServiceHandlers:function(){w.getAppMeta().resetShellUIServiceHandlers();w.setBackNavigationChanged(false)},onAppAfterRendering:function(e){var i=w.getShellUIService();window.setTimeout(function(){r.getEventBus().publish("sap.ushell","appOpened",e);t.info("app was opened")},0);var n=w._publicEventDataFromResolutionResult(e);_.emit("AppRendered",n,true);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appOpened",n);N.setPerformanceMark("FLP.appOpened");if(i){w.initAppMetaParams()}M.updateStateProperty("application/icon",w.getAppMeta().getAppIcon(),true)},_saveHomePageComponent:function(){if(this.oHomeApp){return}var e=this;var t="sap.ushell";var i=function(n,a,o){e.oHomeApp=o.component;r.getEventBus().unsubscribe(t,"appComponentLoaded",i)};r.getEventBus().subscribe(t,"appComponentLoaded",i)},hashChangeFailure:function(e,t,i,n,a){var o=r.byId("sapUshellDashboardPage");if(o){o.setBlocked(false);o.setBusy(false)}if(N.isPlainObject(t)){this.reportError(t.technicalMessage,i.technicalMessage,n);sap.ushell.Container.getServiceAsync("Message").then(function(e){e.show(e.Type.ERROR,t.message,{title:t.title,details:i})})}else{this.reportError(t,i,n);this.delayedMessageError(F.i18n.getText("fail_to_start_app_try_later"))}R=false;this._resumeAppRouterIgnoringCurrentHash();if(e===0){window.hasher.setHash("")}else if(new URLSearchParams(window.location.search).get("bFallbackToShellHome")){window.hasher.setHash("")}else{this.bEnableHashChange=a;sap.ushell.Container.setDirtyFlag(L);w.postMessageToIframeApp("sap.ushell.appRuntime","setDirtyFlag",{bIsDirty:L});this._windowHistoryBack(1)}},reportError:function(e,i,n){t.error(e,i,n)},delayedMessageError:function(e){window.setTimeout(function(){if(sap.ushell.Container!==undefined){sap.ushell.Container.getServiceAsync("Message").then(function(t){t.error(e)})}},0)},fixShellHash:function(e){if(!e){e="#"}else if(e.charAt(0)!=="#"){e="#"+e}return e},_openAppNewWindow:function(e){var t=k.openURL(e);if(!t&&!this._checkWindowLocationSearch("workzone-mobile-app=true")){var i=F.i18n.getText("fail_to_start_app_popup_blocker",[window.location.hostname]);this.delayedMessageError(i)}},_checkWindowLocationSearch:function(e){return window.location.search.indexOf(e)>-1},_windowHistoryBack:function(e){window.history.go(-1*e)},_windowHistoryForward:function(e){window.history.go(e)},_changeWindowLocation:function(e){window.location.href=e},_setMenuVisible:function(e){var t=r.byId("menuBarComponentContainer");var i=t&&t.getComponentInstance&&t.getComponentInstance();if(i&&i.setVisible){i.setVisible(e)}},onAppOpened:function(e,t,i){if(i.targetNavigationMode!=="explace"&&i.targetNavigationMode!=="frameless"){this._setMenuVisible(false)}var n=this.oShellNavigation.hashChanger.getAppHash();var a=n?"&/"+n:null;this.logOpenAppAction(i,a)},externalSearchTriggered:function(e,t,i){A.emit("/core/shell/model/searchTerm",i.searchTerm);i.query=i.searchTerm},onBeforeNavigate:function(e){var t=e.getParameter("to");var i=this.getOwnerComponent();var n=t===i.byId("Shell-home-component-container");var a=t===i.byId("pages-component-container");var o=t===i.byId("homeApp-component-container");var s=t===i.byId("workPageRuntime-component-container");var r=t===i.byId("runtimeSwitcher-component-container");var l=n||a||o||s||r;w.onBeforeNavigate(e.getParameter("fromId"),e.getParameter("from"),e.getParameter("toId"),e.getParameter("to"));this._setMenuVisible(l)},onAfterNavigate:function(e){var t=e.mParameters?e.mParameters.toId:undefined;var i=r.byId("sapUshellDashboardPage");if(i){i.setBlocked(false);i.setBusy(false)}w.onAfterNavigate(e.getParameter("fromId"),e.getParameter("from"),t,e.getParameter("to"));r.getEventBus().publish("sap.ushell","navigated",{})},logOpenAppAction:function(e,t){var i=A.last("/core/shell/enableRecentActivity")&&A.last("/core/shell/enableRecentActivityLogging");if(!i){return}var n={};var a=U.getMetadata(e);var o=e.sFixedShellHash;var s=o;if(t){s+=t}n.title=a.title;n.appType=T.APP;n.url=s;var r=this.oURLParsing.parseShellHash(o);if(r){n.appId="#"+this.oURLParsing.constructShellHash({semanticObject:r.semanticObject,action:r.action})}else{n.appId=o}if(o&&o.indexOf("#Action-search")===-1){window.setTimeout(function(){this._logRecentActivity(n)}.bind(this),1500)}},_logSearchActivity:function(){if(A.last("/core/shell/enableRecentActivity")&&A.last("/core/shell/enableRecentActivityLogging")){var e="";try{e=r.byId("searchFieldInShell-input").getModel().getLastSearchTerm()}catch(e){t.error("Shell: last search term is not available to log a recent activity")}this._logRecentActivity({appId:"#Action-search",appType:T.SEARCH,title:e,url:"#"+window.hasher.getHash()})}},readNavigationEnd:function(){var e=document.getElementById("sapUshellLoadingAccessibilityHelper-loadingComplete");if(e){e.setAttribute("aria-live","polite");e.innerHTML=F.i18n.getText("loadingComplete");window.setTimeout(function(){e.setAttribute("aria-live","off");e.innerHTML=""},0)}},_loadCoreExtNonUI5:function(e){if(e&&e.applicationType!=="SAPUI5"){this._loadCoreExt()}},_loadUsageAnalytics:function(e){sap.ushell.Container.getServiceAsync("UsageAnalytics").then(function(t){t.init(F.i18n.getText("usageAnalytics"),F.i18n.getText("i_agree"),F.i18n.getText("i_disagree"),F.i18n.getText("remind_me_later"));_.emit("StepDone",e.stepName)},function(){_.emit("StepFailed",e.stepName)})},_onCoreResourcesComplementLoaded:function(){N.setPerformanceMark("SchedulingAgent-StartOfFlow");var e=this.getView();if(e){e.createPostCoreExtControls()}C._initialize();_.emit("startScheduler")},_loadRendererExtensionPlugins:function(e){var t=new URLSearchParams(window.location.search);var i=t.get("sap-ushell-xx-pluginmode")==="delayed";function n(t){function n(){_.emit("StepDone",e.stepName)}function a(){t.loadPlugins("RendererExtensions").always(n)}if(i){window.setTimeout(a,5e3)}else{a()}}sap.ushell.Container.getServiceAsync("PluginManager").then(n.bind(this))},_loadWarmupPlugins:function(e){sap.ushell.Container.getServiceAsync("PluginManager").then(function(i){i.loadPlugins("AppWarmup").always(function(){t.debug("WARMUP plugins loaded",null,"sap.ushell.renderers.fiori2.Shell");_.emit("StepDone",e.stepName);N.setPerformanceMark("SchedulingAgent-EndOfFlow");N.setPerformanceMeasure("SchedulingAgentTotalTime","SchedulingAgent-StartOfFlow","SchedulingAgent-EndOfFlow")})})},_loadCoreExt:function(){g.end("FLP:Container.InitLoading");sap.ushell.Container.getServiceAsync("Ui5ComponentLoader").then(function(){_.emit("loadCoreResourcesComplement")})},getCurrentViewportState:function(){return A.last("/core/shell/model/currentViewPortState")},_activateFloatingUIActions:function(e){if(e<417){this.oFloatingUIActions.disable()}else{this.oFloatingUIActions.enable()}},setFloatingContainerDragSelector:function(e){var i=document.querySelector(e);if(i){i.classList.add("sapUshellShellFloatingContainerSelector")}sap.ui.require(["sap/ushell/UIActions"],function(i){if(!this.oFloatingUIActions){this.oFloatingUIActions=new i({containerSelector:".sapUiBody",wrapperSelector:".sapUshellShellFloatingContainerWrapper",draggableSelector:".sapUshellShellFloatingContainerWrapper",rootSelector:".sapUiBody",cloneClass:"sapUshellFloatingContainer-clone",dragCallback:this._handleFloatingContainerUIStart.bind(this),endCallback:this._handleFloatingContainerDrop.bind(this),moveTolerance:3,onDragStartUIHandler:this._onDragStartUI.bind(this),onDragEndUIHandler:this._setFloatingContainerHeight.bind(this),dragAndScrollCallback:this._doDock.bind(this),switchModeDelay:1e3,isLayoutEngine:false,isTouch:false,elementToCapture:e,defaultMouseMoveHandler:function(){},debug:t.getLevel()>=t.Level.DEBUG})}else{this.oFloatingUIActions.elementsToCapture=f(e)}this._activateFloatingUIActions(f(window).width());var n;f(window).bind("resize",function(){clearTimeout(n);n=window.setTimeout(this._activateFloatingUIActions(f(window).width()),300)}.bind(this))}.bind(this))},_doDock:function(e){g.start("FLP:Shell.controller._doDock","dragging co-pilot element","FLP");var t=d.media.getCurrentRange(d.media.RANGESETS.SAP_STANDARD);if(t.name==="Desktop"){var i=f(window).width();if(e){e.docked={};var n=e.docked;if(e.moveX>=i-64){n.dockPos="right";n.setIsDockingAreaOpen=true;this._openDockingArea(e)}else if(e.moveX<64){n.dockPos="left";n.setIsDockingAreaOpen=true;this._openDockingArea(e)}else{if(this._isDockingAreaOpen()){this._closeDockingArea(e)}if(f("#canvas").hasClass("sapUshellContainerDocked")){this._handleCloseCanvas(e)}}}}g.end("FLP:Shell.controller._doDock")},_finishDoDock:function(e){this._openDockingArea(false);var t=new v(v.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");t.put("lastState","docked:"+e.dockPos);this._handleOpenCanvas(e);var i=f("#sapUshellFloatingContainerWrapper");i.css("height","100%");f("#shell-floatingContainer").addClass("sapUshellShellFloatingContainerFullHeight");r.getEventBus().publish("launchpad","shellFloatingContainerIsDocked")},_onResizeWithDocking:function(){window.setTimeout(function(){r.getEventBus().publish("launchpad","appFinderWithDocking")},300)},_onDragStartUI:function(e){g.start("FLP:Shell.controller._onDragStartUI","start drag","FLP");if(this._isDock()){var t=new v(v.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");t.put("lastState","floating");f("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDocked");f(".sapUshellShellFloatingContainerFullHeight").removeClass("sapUshellShellFloatingContainerFullHeight");r.getEventBus().publish("launchpad","shellFloatingContainerIsUnDocked");f("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");f("#sapUshellFloatingContainerWrapper").addClass("sapUshellContainerDockedMinimizeCoPilot");f(f(".sapUshellContainerDockedMinimizeCoPilot")).on("webkitAnimationEnd oanimationend msAnimationEnd animationend",this._handleAnimations(false));this._handleCloseCanvas(e)}g.end("FLP:Shell.controller._onDragStartUI")},_handleAnimations:function(e){var t="sapUshellContainerDockedLaunchpad";var i=f("#sapUshellFloatingContainerWrapper");if(e){f("#canvas, #shell-header").addClass(t);i.addClass("sapUshellContainerDockedExtendCoPilot");this._onResizeWithDocking()}else{f("#sapUshellFloatingContainerWrapper").addClass("sapUshellContainerDockedExtendCoPilot")}},_openDockingArea:function(e){var t=e?e.docked:false;var i=t?t.setIsDockingAreaOpen:false;if(i&&f("#DockingAreaDiv").length===0){var n=s.getRTL();if(t.dockPos==="right"&&e.clone&&!n||t.dockPos==="left"&&e.clone&&n){f('<div id="DockingAreaDiv" class="sapUshellShellDisplayDockingAreaRight">').appendTo(e.clone.parentElement)}else if(t.dockPos==="left"&&e.clone&&!n||t.dockPos==="right"&&e.clone&&n){f('<div id="DockingAreaDiv" class="sapUshellShellDisplayDockingAreaLeft">').appendTo(e.clone.parentElement)}e.clone.oDockedProp={};e.clone.oDockedProp.dockPos=t.dockPos}else if(!i){this._closeDockingArea()}},_closeDockingArea:function(){window.setTimeout(function(){f(".sapUshellShellDisplayDockingAreaRight").remove();f(".sapUshellShellDisplayDockingAreaLeft").remove()},150)},_isDock:function(){return document.getElementsByClassName("sapUshellContainerDocked").length!==0},_isDockingAreaOpen:function(){return document.getElementsByClassName("sapUshellShellDisplayDockingAreaRight").length!==0||document.getElementsByClassName("sapUshellShellDisplayDockingAreaLeft").length!==0},_handleOpenCanvas:function(e){var t=f("#canvas");var i=f(".sapUshellShellHead");var n=s.getRTL();if(e.dockPos==="right"&&!n||e.dockPos==="left"&&n){t.addClass("sapUshellContainer-Narrow-Right sapUshellContainerDocked ");i.addClass("sapUshellHead-Narrow-Right sapUshellContainerDocked")}if(e.dockPos==="left"&&!n||e.dockPos==="right"&&n){t.addClass("sapUshellContainer-Narrow-Left sapUshellContainerDocked ");i.addClass("sapUshellHead-Narrow-Left sapUshellContainerDocked")}var a=r.byId("viewPortContainer");if(a){a._handleSizeChange()}},_handleCloseCanvas:function(e){var t=f("#canvas");var i=f(".sapUshellShellHead");if(e){e.docked.setIsDockingAreaOpen=false}if(t.hasClass("sapUshellContainer-Narrow-Right")){t.removeClass("sapUshellContainer-Narrow-Right sapUshellContainerDocked sapUshellMoveCanvasRight");i.removeClass("sapUshellHead-Narrow-Right sapUshellContainerDocked");this._openDockingArea(e);this._setFloatingContainerHeight()}if(t.hasClass("sapUshellContainer-Narrow-Left")){t.removeClass("sapUshellContainer-Narrow-Left sapUshellContainerDocked sapUshellMoveCanvasLeft");i.removeClass("sapUshellHead-Narrow-Left sapUshellContainerDocked");this._openDockingArea(e);this._setFloatingContainerHeight()}this._onResizeWithDocking();var n=r.byId("viewPortContainer");if(n){n._handleSizeChange()}},_setFloatingContainerHeight:function(e){var t=f(window).width();var i=f("#sapUshellFloatingContainerWrapper");if(this._isDock()){if(e&&(e.clientX>=t-64||e.clientX<64)){i.addClass(" sapUshellContainerDocked");i.addClass("sapUshellContainerDockedMinimizeCoPilot");f(i).on("webkitAnimationEnd oanimationend msAnimationEnd animationend",this._handleAnimations(true))}}else if(!this._isDock()){f("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot")}},_handleFloatingContainerDrop:function(e,t,i){g.start("FLP:Shell.controller._handleFloatingContainerDrop","drop floating container","FLP");var n=t.firstChild?r.byId(t.firstChild.id):undefined;var a=new v(v.Type.local,"com.sap.ushell.adapters.local.FloatingContainer");var o=f(window).width();var s=f(window).height();var l=i.deltaX/o;var h=i.deltaY/s;var c=t.style.visibility;var p=t.style.display;var d=parseFloat(t.style.left.replace("%",""));var u=parseFloat(t.style.top.replace("%",""));if(typeof d==="number"){l=d+100*i.deltaX/o}if(typeof u==="number"){h=u+100*i.deltaY/s}if(this._isDockingAreaOpen()){h=0}t.style.left=l+"%";t.style.top=h+"%";t.style.position="absolute";t.style.display="block";t.visibility=c;t.display=p;a.put("floatingContainerStyle",t.style.cssText);if(n){n.handleDrop();if(i.clone.oDockedProp&&this._isDockingAreaOpen()){this._finishDoDock(i.clone.oDockedProp)}}g.end("FLP:Shell.controller.handleFloatingContainerDrop")},_handleFloatingContainerUIStart:function(e,t){g.start("FLP:Shell.controller._handleFloatingContainerUIStart","starts dragging floating container","FLP");var i=t;i.style.display="none";if(window.getSelection){var n=window.getSelection();try{n.removeAllRanges()}catch(e){}}g.end("FLP:Shell.controller._handleFloatingContainerUIStart")},getFloatingContainerState:function(){var e=new v(v.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");var t="floating";if(e!==null){t=e.get("lastState");if(t===null){t="floating"}}return t},setFloatingContainerVisibility:function(e){var t=this.getFloatingContainerState();if(t){if(t==="floating"){this.getView().getOUnifiedShell().setFloatingContainerVisible(e)}else if(t.indexOf("docked")!==-1){var i=r.byId("viewPortContainer");if(e===true){var n=d.media.getCurrentRange(d.media.RANGESETS.SAP_STANDARD);if(n.name==="Desktop"){var a=f("#sapUshellFloatingContainerWrapper");a.addClass("sapUshellContainerDocked");f("#canvas, .sapUshellShellHead").addClass("sapUshellContainerDocked");a.css("height","100%");r.byId("shell-floatingContainer").addStyleClass("sapUshellShellFloatingContainerFullHeight");if(i){i._handleSizeChange()}if(s.getRTL()){if(t.indexOf("right")!==-1){f("#canvas").addClass("sapUshellContainer-Narrow-Left");f(".sapUshellShellHead").addClass("sapUshellHead-Narrow-Left");this._handleAnimations(true)}else{f("#canvas").addClass("sapUshellContainer-Narrow-Right");f(".sapUshellShellHead").addClass("sapUshellHead-Narrow-Right");this._handleAnimations(true)}}else if(t.indexOf("right")!==-1){f("#canvas").addClass("sapUshellContainer-Narrow-Right");f(".sapUshellShellHead").addClass("sapUshellHead-Narrow-Right");this._handleAnimations(true)}else{f("#canvas").addClass("sapUshellContainer-Narrow-Left");f(".sapUshellShellHead").addClass("sapUshellHead-Narrow-Left");this._handleAnimations(true)}window.setTimeout(function(){this.getView().getOUnifiedShell().setFloatingContainerVisible(e)}.bind(this),400)}else{new v(v.Type.local,"com.sap.ushell.adapters.local.CopilotLastState").put("lastState","floating");this.getView().getOUnifiedShell().setFloatingContainerVisible(e)}}else{this._handleAnimations(false);if(i){i._handleSizeChange()}window.setTimeout(function(){this.getView().getOUnifiedShell().setFloatingContainerVisible(e)}.bind(this),400);f("#canvas, .sapUshellShellHead").removeClass("sapUshellContainerDocked sapUshellContainer-Narrow-Right sapUshellContainer-Narrow-Left")}f("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");this._onResizeWithDocking();if(i){i._handleSizeChange()}}}},getFloatingContainerVisibility:function(){return this.getView().getOUnifiedShell().getFloatingContainerVisible()},setFloatingContainerContent:function(e,t,i,n){M.setFloatingContainerContent(e,t,i,n)},getRightFloatingContainerVisibility:function(){var e=this.getView().getOUnifiedShell().getRightFloatingContainer();var t=e&&e.getVisible();return t},setHeaderTitle:function(e){b.updateStates({propertyName:"title",value:e||"",aStates:["home","app"],bCurrentState:false,bDoNotPropagate:false})},setFooter:function(e){var i=this.getView().getOUnifiedShell();if(typeof e!=="object"||!e.getId){throw new Error("oFooter value is invalid")}if(i.getFooter()!==null){t.warning("You can only set one footer. Replacing existing footer: "+i.getFooter().getId()+", with the new footer: "+e.getId()+".")}i.setFooter(e)},removeFooter:function(){this.getView().getOUnifiedShell().setFooter(null)},addUserPreferencesEntry:function(e,t){this._validateUserPrefEntryConfiguration(e,t);this._updateUserPrefModel(e,t)},addUserProfilingEntry:function(e){this._validateUserPrefEntryConfiguration(e);this._updateProfilingModel(e)},_validateUserPrefEntryConfiguration:function(e,t){if(!e||typeof e!=="object"){throw new Error("object oConfig was not provided")}if(!e.title){throw new Error("title was not provided")}if(!e.value){throw new Error("value was not provided")}if(typeof e.entryHelpID!=="undefined"){if(typeof e.entryHelpID!=="string"){throw new Error("entryHelpID type is invalid")}else if(e.entryHelpID===""){throw new Error("entryHelpID should not be an empty string")}}if(e.title&&typeof e.title!=="string"){throw new Error("title type is invalid")}if(typeof e.value!=="function"&&typeof e.value!=="string"&&typeof e.value!=="number"){throw new Error("value type is invalid")}["onSave","content","onCancel"].forEach(function(t){if(e[t]&&typeof e[t]!=="function"){throw new Error(t+" type is  "+typeof e[t]+" but should be a function")}});if(t){[{name:"groupingId",type:"string"},{name:"groupingTabTitle",type:"string"},{name:"groupingTabHelpId",type:"string"}].forEach(function(t){if(!e[t.name]){throw new Error(t.name+" is missing")}else if(typeof e[t.name]!==t.type){throw new Error(t.name+" type is "+typeof e[t.name]+" but should be a "+t.type)}})}},_createSessionHandler:function(e){var t=this;var i=2e4;sap.ui.require(["sap/ushell/SessionHandler"],function(n){t.oSessionHandler=new n(w);t.oSessionHandler.initLogout();window.setTimeout(function(){t.oSessionHandler.init({sessionTimeoutReminderInMinutes:e.sessionTimeoutReminderInMinutes,sessionTimeoutIntervalInMinutes:e.sessionTimeoutIntervalInMinutes,sessionTimeoutTileStopRefreshIntervalInMinutes:e.sessionTimeoutTileStopRefreshIntervalInMinutes,enableAutomaticSignout:e.enableAutomaticSignout})},i)})},_getSessionHandler:function(){return this.oSessionHandler},_navBack:function(){this.setUserActionsMenuSelected(false);w.service().navigateBack()},_updateUserPrefModel:function(e,t){var i=this._getModelEntryFromEntryObject(e);var n=A.last("/core/userPreferences/entries")||[];if(t){i.groupingEnablement=true;i.groupingId=e.groupingId;i.groupingTabTitle=e.groupingTabTitle;i.groupingTabHelpId=e.groupingTabHelpId}n.push(i);n=this._reorderUserPrefEntries(n);A.emit("/core/userPreferences/entries",n)},_updateProfilingModel:function(e){var t=this._getModelEntryFromEntryObject(e);var i=A.last("/core/userPreferences/profiling")||[];i.push(t);A.emit("/core/userPreferences/profiling",i)},_getModelEntryFromEntryObject:function(e){return{id:N._getUid(),entryHelpID:e.entryHelpID,title:e.title,valueArgument:e.value,valueResult:null,onSave:e.onSave,onCancel:e.onCancel,contentFunc:e.content,contentResult:null,icon:e.icon,provideEmptyWrapper:e.provideEmptyWrapper}},_reorderUserPrefEntries:function(e){var t=[];var i=["userAccountEntry","themes","homepageEntry","spacesEntry","userActivitiesEntry","userProfiling","language","notificationsEntry","userDefaultEntry"];var n={};for(var a=e.length-1;a>=0;a--){if(i.indexOf(e[a].id)!==-1){var o=e.splice(a,1)[0];n[o.id]=o}}i.forEach(function(e){var i=n[e];if(i){t.push(i)}});return t.concat(e)},getModel:function(){return x},_getConfig:function(){return V||{}},_getPersData:function(e){var t=o.getOwnerComponentFor(this.getView());return new Promise(function(i,n){sap.ushell.Container.getServiceAsync("Personalization").then(function(a){var o={keyCategory:a.constants.keyCategory.FIXED_KEY,writeFrequency:a.constants.writeFrequency.LOW,clientStorageAllowed:true};var s=a.getPersonalizer(e,o,t);s.getPersData().then(i).fail(n)})})},_getCurrentLocationHash:function(){return window.location.hash},setUserActionsMenuSelected:function(e){_.emit("showUserActionsMenu",e)},getUserActionsMenuSelected:function(){return A.last("/core/shell/model/currentViewPortState")==="LeftCenter"},setNotificationsSelected:function(e){_.emit("showNotifications",e)},getNotificationsSelected:function(){return A.last("/core/shell/model/currentViewPortState")==="RightCenter"}})});