//Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/deepExtend","sap/base/util/ObjectPath","sap/m/library","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ushell/library"],function(e,t,i,a,s,r,n){"use strict";var o={widgetGallery:"widgetGallery",appSearchTiles:"appSearch_tiles",appSearchCards:"appSearch_cards"};var l={navigationTargets:o,activeNavigationTarget:o.widgetGallery,restrictedMode:false,widgetGallery:{widgetGroups:[]},appSearch:{selectedAppCount:0,hasSelectables:true,currentSelectedTreeNode:"",searchTerm:"",filteredAppCount:0,showSelectedPressed:false,originalVisualizations:{cards:[],tiles:[]},visualizations:{cards:[],tiles:[]},originalRestrictedVisualizations:[],restrictedVisualizations:[]}};return s.extend("sap.ushell.components.contentFinder.Component",{metadata:{manifest:"json",library:"sap.ushell"},logComponent:"sap.ushell.components.ContentFinder.Component",init:function(){s.prototype.init.apply(this,arguments);this.oResourceBundle=this.getModel("i18n").getResourceBundle();this.oRootView=this.getRootControl();this.aRegisteredEvents=[];var e=new r;e.setSizeLimit(Infinity);this.setModel(e);this._initializeModel();this._oRootControlLoadedPromise=this.rootControlLoaded().then(function(){this.oNavContainer=this.oRootView.byId("contentFinderNavContainer");this.oContentFinderWidgetGalleryPage=this.oRootView.byId("contentFinderWidgetGalleryPage");this.oContentFinderAppSearchPage=this.oRootView.byId("contentFinderAppSearchPage");this.oDialog=this.oRootView.byId("contentFinderDialog")}.bind(this))},show:function(e){if(e&&!Object.values(o).includes(e)){return Promise.reject(new Error("Invalid navigation target provided. Could not open ContentFinder dialog."))}e=e||o.widgetGallery;return this.navigate(e).then(function(){this.oDialog.open()}.bind(this))},setWidgetGroups:function(e){this.getModel().setProperty("/widgetGallery/widgetGroups",e)},setVisualizationData:function(e){var a=i.get("Visualizations.nodes",e)||[];var s=this.getModel();var r=this._prepareTiles(a);var n=this._prepareCards(a);s.setProperty("/appSearch/originalVisualizations/tiles",t([],r));s.setProperty("/appSearch/originalVisualizations/cards",t([],n));s.setProperty("/appSearch/visualizations/tiles",t([],r));s.setProperty("/appSearch/visualizations/cards",t([],n));this._updateVisualizationsRestricted()},setRestrictedMode:function(e){this.getModel().setProperty("/restrictedMode",!!e)},setContextData:function(e){var a=i.get("restrictedVisualizations",e)||[];var s=this.getModel();s.setProperty("/appSearch/originalRestrictedVisualizations",t([],a));s.setProperty("/appSearch/restrictedVisualizations",t([],a));this._updateVisualizationsRestricted()},getNavContainer:function(){return this._oRootControlLoadedPromise.then(function(){return this.oNavContainer}.bind(this))},getSelectedAppBoxes:function(e){var t=this.getModel().getProperty("/appSearch/visualizations");var i=[];Object.values(t).forEach(function(t){var a=t.filter(function(t){return t.selected&&(typeof e!=="boolean"||t.disabled===e)});i=i.concat(a)});return i},addVisualizations:function(){var e=this.getSelectedAppBoxes(false);if(e.length>0){this.fireEvent("visualizationsAdded",{visualizations:e})}},attachContentFinderClosed:function(e,t){this.aRegisteredEvents.push({id:"contentFinderClosed",callback:e,listener:t});this.attachEventOnce("contentFinderClosed",e,t);return this},attachWidgetSelected:function(e,t,i){this.aRegisteredEvents.push({id:"widgetSelected",callback:t,listener:i});this.attachEventOnce("widgetSelected",e,t,i);return this},attachVisualizationsAdded:function(e,t,i){this.aRegisteredEvents.push({id:"visualizationsAdded",callback:t,listener:i});this.attachEventOnce("visualizationsAdded",e,t,i);return this},resetAppSearch:function(){var e=this.getModel().getData();var i=t({},l.appSearch);i.originalVisualizations=t({},e.appSearch.originalVisualizations);i.originalRestrictedVisualizations=[].concat(e.appSearch.originalRestrictedVisualizations);i.visualizations=t({},e.appSearch.originalVisualizations);i.restrictedVisualizations=[].concat(e.appSearch.originalRestrictedVisualizations);e.appSearch=i;this.getModel().setData(e)},navigate:function(e){var t=this.getModel();t.setProperty("/activeNavigationTarget",e);if(e===o.appSearchTiles||e===o.appSearchCards){return this.getNavContainer().then(function(e){e.to(this.oContentFinderAppSearchPage)}.bind(this))}return this.getNavContainer().then(function(e){e.to(this.oContentFinderWidgetGalleryPage)}.bind(this))},_initializeModel:function(){this.getModel().setData(t({},l))},_prepareTiles:function(t){var s=t.filter(function(e){return["sap.ushell.StaticAppLauncher","sap.ushell.DynamicAppLauncher"].indexOf(e.Type)>-1});var r=[];s.forEach(function(t,o){if(!t.Descriptor){e.error("No Descriptor available. Cannot load this tile!",null,this.logComponent);return}var l=t.Descriptor["sap.app"];var d=t.Descriptor["sap.fiori"];var p="";if(d){p=d.registrationIds[0]}else if(l&&l.hasOwnProperty("id")){p=l.id}r.push({id:t.Id,appId:p,icon:i.get("icons.icon",t.Descriptor["sap.ui"])||"",info:l&&l.info||"",launchUrl:t.Descriptor["sap.flp"]&&t.Descriptor["sap.flp"].target||"",previewSize:n.AppBoxPreviewSize.Small,posinset:o+1,setsize:s.length,subtitle:l&&l.subTitle||"",title:l&&l.title||"",type:t.Type,frameType:a.FrameType.OneByOne,vizData:t,selected:false,disabled:false})}.bind(this));return r},_prepareCards:function(t){var a=t.filter(function(e){return e.Type==="sap.card"});var s=[];a.forEach(function(t,r){if(!t.Descriptor){e.error("No Descriptor available. Cannot load this card!",null,this.logComponent);return}var o=t.Descriptor["sap.app"];var l=o&&o.id||"";s.push({id:t.Id,appId:l,icon:i.get("icons.icon",t.Descriptor["sap.ui"])||"",info:o&&o.info||"",previewSize:n.AppBoxPreviewSize.Large,posinset:r+1,setsize:a.length,subtitle:o&&o.subTitle||"",title:o&&o.title||"",type:t.Type,manifest:t.Descriptor,vizData:t,selected:false,disabled:false})}.bind(this));return s},_updateVisualizationsRestricted:function(){var e=this.getModel();var t=e.getProperty("/appSearch/restrictedVisualizations");var i=e.getProperty("/appSearch/visualizations/tiles");var a=i.map(function(e){var i=t.includes(e.id);e.selected=i;e.disabled=i;return e});e.setProperty("/appSearch/visualizations/tiles",a)},_unregisterEvents:function(){this.aRegisteredEvents.forEach(function(e){var t=e.id;var i=e.callback;var a=e.listener;this.detachEvent(t,i,a)}.bind(this));this.aRegisteredEvents=[]}})});