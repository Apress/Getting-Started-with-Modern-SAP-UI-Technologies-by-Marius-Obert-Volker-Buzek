// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/base/EventProvider","sap/ui/core/Core","sap/ui/thirdparty/hasher","sap/ushell/AppInfoParameters","sap/ushell/EventHub","sap/ushell/TechnicalParameters","sap/ui/core/Component","sap/ushell/services/AppConfiguration","sap/ushell/services/_MessageBroker/MessageBrokerEngine","sap/ushell/utils/UrlParsing"],function(e,t,n,i,a,o,r,p,s,u,l){"use strict";var f="appLoaded";function c(l,c,h,d){var g,m,A;this.getCurrentApplication=function(){return g};this.attachAppLoaded=function(e,t,n){A.attachEvent(f,e,t,n)};this.detachAppLoaded=function(e,t){A.detachEvent(f,e,t)};this.prepareCurrentAppObject=function(e,t,n,i){y(e,t,n,i)};this.reloadCurrentApp=function(){o.emit("reloadCurrentApp",{sAppContainerId:m.getId(),sCurrentHash:i.getHash(),date:Date.now()})};this.setAppInfo=function(e,t){a.setCustomAttributes(e);g.getAllAppInfo(true).then(function(e){u.publish("flp-app-info","FLP",Date.now().toString(),t===true?"new app info":"app info update","*",e)})};if(window.QUnit===undefined&&sap.ushell.Container.inAppRuntime()===false){u.subscribe("FLP",[{channelId:"flp-app-info",version:"1.0"}],function(){},function(){})}A=new t;if(sap.ushell.Container.inAppRuntime()===false){if(sap.ushell.Container.getRenderer()){C()}else{var v=function(){C();sap.ushell.Container.detachRendererCreatedEvent(v)};sap.ushell.Container.attachRendererCreatedEvent(v)}}function C(){var t=n.byId("viewPortContainer");if(!t||typeof t.attachAfterNavigate!=="function"){e.error("Error during instantiation of AppLifeCycle service","Could not attach to afterNavigate event","sap.ushell.services.AppLifeCycle");return}t.attachAfterNavigate(function(e){var t;var n;var i;var a;var o;var r=false;if(e.mParameters.toId.indexOf("applicationShellPage")===0){n=e.mParameters.to.getApp()}else if(e.mParameters.toId.indexOf("application")===0){n=e.mParameters.to}if(n&&typeof n.getComponentHandle==="function"&&n.getComponentHandle()){a=n.getComponentHandle().getInstance()}else if(n){t=n.getAggregation("child");if(t){a=t.getComponentInstance()}}else{a=p.get(e.mParameters.to.getComponent())}if(a){o=a.getId();r=o.indexOf("Shell-home-component")!==-1||o.indexOf("pages-component")!==-1||o.indexOf("workPageRuntime-component")!==-1||o.indexOf("Shell-appfinder-component")!==-1||o.indexOf("homeApp-component")!==-1||o.indexOf("runtimeSwitcher-component")!==-1}i=n&&typeof n.getApplicationType==="function"&&n.getApplicationType();if((!i||i==="URL")&&a){i="UI5"}y(i,a,r,n)})}function P(){var e=i.getHash();if(!e){return Promise.reject("Could not identify current application hash")}var t=sap.ushell.Container.getServiceAsync("URLParsing");return t.then(function(t){return t.parseShellHash(e)})}function I(){if(a.setCustomAttributes){a.setCustomAttributes()}}function y(e,t,n,i){I();m=i;g={applicationType:e,componentInstance:t,homePage:n,getTechnicalParameter:function(n){return r.getParameterValue(n,t,i,e)},getIntent:P,getInfo:function(e){return a.getInfo(e,g)},getAllAppInfo:function(n){return a.getAllAppInfo(n,g,t,i,e).then(function(e){if(n===true){e.applicationType=g.applicationType;e.homePage=g.homePage}else{e.applicationType={value:g.applicationType};e.homePage={value:g.homePage}}return e})},getSystemContext:function(){var e=s.getCurrentApplication()||{};var t=e.contentProviderId||"";return sap.ushell.Container.getServiceAsync("ClientSideTargetResolution").then(function(e){return e.getSystemContext(t)})},disableKeepAliveAppRouterRetrigger:function(e){P().then(function(t){o.emit("disableKeepAliveRestoreRouterRetrigger",{disable:e,intent:t,componentId:g.componentInstance.oContainer.sId,date:Date.now()})})}};setTimeout(function(){A.fireEvent(f,g);if(window.QUnit===undefined&&sap.ushell.Container.inAppRuntime()===false){g.getAllAppInfo(true).then(function(e){u.publish("flp-app-info","FLP",Date.now().toString(),"new app info","*",e)})}},0)}}c.hasNoAdapter=true;return c},true);