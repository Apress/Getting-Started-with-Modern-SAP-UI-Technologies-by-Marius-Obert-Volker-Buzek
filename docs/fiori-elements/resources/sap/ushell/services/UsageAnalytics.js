// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/core/Core","sap/ui/core/Configuration","sap/ui/Device","sap/ui/thirdparty/jquery"],function(e,t,s,i,n){"use strict";function a(a,r,o){var u=o&&o.config||{},l=[],c=false,d=false,f,g;window.oCustomProperties={};this.setLegalText=function(e){f=e;if(g){this.init(g.usageAnalyticsTitle,g.iAgree,g.iDisagree,g.remindMeLater)}};this.getLegalText=function(){return f};this.setTrackUsageAnalytics=function(t){var s=n.Deferred();var i=sap.ushell.Container.getUser();var a=i.getTrackUsageAnalytics();sap.ushell.Container.getServiceAsync("UserInfo").then(function(n){if(a!==t){i.setTrackUsageAnalytics(t);var r=n.updateUserPreferences(i);r.done(function(){i.resetChangedProperty("trackUsageAnalytics");if(!d&&t){this.start()}else if(d&&t===false){window.swa.disable()}else if(d&&t){window.swa.enable()}s.resolve()}.bind(this));r.fail(function(t){i.setTrackUsageAnalytics(a);i.resetChangedProperty("trackUsageAnalytics");e.error(t);s.reject(t)})}else{s.resolve()}}.bind(this)).catch(function(){e.error("Getting UserInfo service failed.");s.reject("Getting UserInfo service failed.")});return s.promise()};this.showLegalPopup=function(){sap.ui.require(["sap/m/Text","sap/m/Dialog","sap/m/Button","sap/m/library"],function(e,t,s,n){var a=n.ButtonType;var r=new t("agreementMessageBox",{title:g.usageAnalyticsTitle,type:"Message",stretch:i.system.phone,buttons:[new s("remindMeLaterButton",{text:g.remindMeLater,press:function(){r.close()}}),new s("iAgreeButton",{text:g.iAgree,type:a.Emphasized,press:function(){this.setTrackUsageAnalytics(true);r.close()}.bind(this)}),new s("iDisagreeButton",{text:g.iDisagree,press:function(){this.setTrackUsageAnalytics(false);r.close()}.bind(this)})],afterClose:function(){r.destroy()},content:new e({text:f})}).addStyleClass("sapUshellUsageAnalyticsPopUp").addStyleClass("sapContrastPlus");r.open()}.bind(this))};this.systemEnabled=function(){if(!u.enabled||!u.pubToken||this.isSetUsageAnalyticsPermitted()&&!f){if(!u.pubToken){e.warning("No valid pubToken was found in the service configuration")}if(!f){e.warning("No Legal text message found.")}return false}return true};this.userEnabled=function(){var e=sap.ushell.Container.getUser();if(!this.systemEnabled()){return false}return e.getTrackUsageAnalytics()};this.start=function(){t.getEventBus().publish("sap.ushell.services.UsageAnalytics","usageAnalyticsStarted");this._initUsageAnalyticsLogging();d=true;window.swa.custom2={ref:s.getLanguage()}};this.init=function(e,t,s,i){g={usageAnalyticsTitle:e,iAgree:t,iDisagree:s,remindMeLater:i};if(this.systemEnabled()&&!d){if(!this.isSetUsageAnalyticsPermitted()){this.start()}else if(f){if(this.userEnabled()===true){this.start()}else if(this.userEnabled()===null||this.userEnabled()===undefined){this.showLegalPopup()}}}};this.setCustomAttributes=function(e){var t,s="attribute",i,a="custom",r,o,u="customFunction";if(!this.userEnabled()&&this.isSetUsageAnalyticsPermitted()){return}for(t=1;t<6;t++){r=a.concat(t+4);if(window.swa[r]!==undefined){continue}i=s+t;if(e[i]===undefined){continue}if(n.isFunction(e[i])){o=u+t;window[o]=e[i];window.swa[r]={ref:o}}else{window.swa[r]={ref:e[i]}}}};this.logCustomEvent=function(e,t,s){if(!this.userEnabled()&&this.isSetUsageAnalyticsPermitted()){return}if(!this._isAnalyticsScriptLoaded()){this._addDelayedEvent(e,t,s);return}if(s){s.unshift(t);s.unshift(e);window.swa.trackCustomEvent.apply(window.swa.trackCustomEvent,s)}else{window.swa.trackCustomEvent(e,t)}};window._trackingScriptsLoaded=function(){var e,t;c=true;for(e=0;e<l.length;e++){t=l[e];this.logCustomEvent(t.eventType,t.customEventValue,t.aAdditionalValues)}l=null};this._initUsageAnalyticsLogging=function(){if(window.swa===undefined){window.swa={}}window.swa.pubToken=u.pubToken;window.swa.baseUrl=u.baseUrl;window.swa.bannerEnabled=false;window.swa.loggingEnabled=true;window.swa.visitorCookieTimeout=63113852;window.swa.dntLevel=1;window.swa.trackerReadyCallback=window._trackingScriptsLoaded.bind(this);window.swa.clicksEnabled=u.logClickEvents!==false;window.swa.pageLoadEnabled=u.logPageLoadEvents!==false;this._handlingTrackingScripts()};this._handlingTrackingScripts=function(){var t=document,s=t.createElement("script"),i=t.getElementsByTagName("script")[0];s.onerror=function(){e.warning("SWA scripts not loaded!")};s.defer=true;s.async=true;s.src=window.swa.baseUrl+"js/privacy.js";i.parentNode.insertBefore(s,i)};this._isAnalyticsScriptLoaded=function(){return c};this.isSetUsageAnalyticsPermitted=function(){if(u.setUsageAnalyticsPermitted===undefined){return true}return u.setUsageAnalyticsPermitted};this._addDelayedEvent=function(e,t,s){var i={eventType:e,customEventValue:t,aAdditionalValues:s};l.push(i)}}a.hasNoAdapter=true;return a},true);