// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Configuration","sap/ui/core/Control","sap/ui/core/Core","sap/ui/Device","sap/ui/performance/Measurement","sap/ui/thirdparty/jquery","sap/ui/util/Storage","sap/ushell/EventHub","sap/ushell/library"],function(e,t,a,i,n,o,s,l,r){"use strict";var p=t.extend("sap.ushell.ui.shell.FloatingContainer",{metadata:{library:"sap.ushell",properties:{},aggregations:{content:{type:"sap.ui.core.Control",multiple:true}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapUshellFloatingContainer");e.openEnd();if(t.getContent()&&t.getContent().length){e.renderControl(t.getContent()[0])}e.close("div")}}});p.prototype.init=function(){i.resize.attachHandler(p.prototype._handleResize,this)};p.prototype._getWindowHeight=function(){return o(window).height()};p.prototype._setContainerHeight=function(e,t){e.css("max-height",t)};p.prototype._handleResize=function(t){n.start("FLP:FloatingContainer_handleResize","resizing floating container","FLP");if(o(".sapUshellFloatingContainer").parent()[0]&&o(".sapUshellContainerDocked").length===0){this.oWrapper=o(".sapUshellFloatingContainer").parent()[0];this.oWrapper.style.cssText=this.oStorage.get("floatingContainerStyle");var r=window.matchMedia?window.matchMedia("(max-width: 417px)").matches:false;this.adjustPosition(t,r)}else if(o(".sapUshellFloatingContainer").parent()[0]&&o(".sapUshellContainerDocked").length){if(o("#canvas").hasClass("sapUshellContainer-Narrow-Right")){var p;if(e.getRTL()){o("#sapUshellFloatingContainerWrapper").css("left",416/o(window).width()*100+"%");p=416/o(window).width()*100+"%;"}else{o("#sapUshellFloatingContainerWrapper").css("left",100-416/o(window).width()*100+"%");p=100-416/o(window).width()*100+"%;"}this.oWrapper.style.cssText="left:"+p+this.oWrapper.style.cssText.substring(this.oWrapper.style.cssText.indexOf("top"));this.oStorage.put("floatingContainerStyle",this.oWrapper.style.cssText)}}if(o(".sapUshellContainerDocked").length>0){a.getEventBus().publish("launchpad","shellFloatingContainerDockedIsResize");l.emit("ShellFloatingContainerDockedIsResized",Date.now())}var h=i.media.getCurrentRange(i.media.RANGESETS.SAP_STANDARD);if(h.name!=="Desktop"&&o(".sapUiMedia-Std-Desktop").width()-416<h.from&&o(".sapUshellContainerDocked").length){o("#canvas, .sapUshellShellHead").removeClass("sapUshellContainerDocked");if(o("#canvas").hasClass("sapUshellContainer-Narrow-Right")){o("#canvas").removeClass("sapUshellContainer-Narrow-Right sapUshellMoveCanvasRight")}else{o("#canvas").removeClass("sapUshellContainer-Narrow-Left sapUshellMoveCanvasLeft")}o(".sapUshellShellFloatingContainerFullHeight").removeClass("sapUshellShellFloatingContainerFullHeight");a.byId("mainShell").getController()._handleAnimations(false);var d=new s(s.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");if(d){d.put("lastState","floating")}a.getEventBus().publish("launchpad","shellFloatingContainerIsUnDockedOnResize");o("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDocked sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");var g=a.byId("viewPortContainer");if(g){g._handleSizeChange()}}n.end("FLP:FloatingContainer_handleResize")};p.prototype.adjustPosition=function(t,a){var i=t?t.width:o(window).width(),n=t?t.height:o(window).height(),s=this.oContainer.width(),l=this.oContainer.height(),r,p,h,d,g=e.getRTL();a=a!==undefined?a:false;if(this.oWrapper){h=this.oWrapper.style.left.replace("%","");h=i*h/100;d=this.oWrapper.style.top.replace("%","");d=n*d/100;if(!isNaN(h)&&!isNaN(d)&&!a){if(g){r=h<s||h>i;if(r){h=h<s?s:i}}else{r=h<0||i<h+s;if(r){h=h<0?0:i-s}}p=d<0||n<d+l;if(p){d=d<0?0:n-l}if(!r&&!p){this.oWrapper.style.left=h*100/i+"%";this.oWrapper.style.top=d*100/n+"%";this.oWrapper.style.position="absolute";return}this.oWrapper.style.left=h*100/i+"%";this.oWrapper.style.top=d*100/n+"%";this.oWrapper.style.position="absolute"}}};p.prototype.handleDrop=function(){if(this.oWrapper){this.adjustPosition();this.oStorage.put("floatingContainerStyle",this.oWrapper.style.cssText)}};p.prototype.setContent=function(e){if(this.getDomRef()){var t=a.createRenderManager();t.renderControl(e);t.flush(this.getDomRef());t.destroy()}this.setAggregation("content",e,true)};p.prototype.onAfterRendering=function(){this.oStorage=this.oStorage||new s(s.Type.local,"com.sap.ushell.adapters.local.FloatingContainer");this.oContainer=o(".sapUshellFloatingContainer");this.oWrapper=o(".sapUshellFloatingContainer").parent()[0]};p.prototype.exit=function(){i.resize.detachHandler(p.prototype._resizeHandler,this)};return p});