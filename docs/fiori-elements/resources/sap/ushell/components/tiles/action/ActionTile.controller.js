// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ushell/components/tiles/utils","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery","sap/base/Log"],function(t,e,i,n,o){"use strict";return t.extend("sap.ushell.components.tiles.action.ActionTile",{onInit:function(){var t=this.getView();var n=t.getViewData();var o=e.getResourceBundleModel();var r=n.chip;var a=e.getActionConfiguration(r);var g=this;function c(t,e){var i=o.getResourceBundle();var n=i.getText("configuration.semantic_object")+":\n"+t+"\n\n"+i.getText("configuration.semantic_action")+":\n"+e;return n}t.setModel(o,"i18n");var s=new i({config:a,displayText:c(a.semantic_object,a.semantic_action)});t.setModel(s);if(r.configurationUi.isEnabled()){r.configurationUi.setAsyncUiProvider(function(){return e.getConfigurationUi(g.getView(),"sap.ushell.components.tiles.action.Configuration").then(function(t){r.configurationUi.attachCancel(g.onCancelConfiguration.bind(null,t));r.configurationUi.attachSave(g.onSaveConfiguration.bind(null,t,c));return t})});t.byId("actionTile").setTooltip(o.getResourceBundle().getText("edit_configuration.tooltip"))}},onPress:function(t){var e=this.getView().getViewData().chip;if(e.configurationUi.isEnabled()){e.configurationUi.display()}},onSaveConfiguration:function(t,r){var a=n.Deferred();var g=t.getModel();var c=g.getProperty("/tileModel");var s=t.getViewData().chip;function l(t){o.warning(t,null,"sap.ushell.components.tiles.action.ActionTile.controller");a.reject(t)}var p=e.checkTMInputOnSaveConfig(t);if(p){a.reject("mandatory_fields_missing");return a.promise()}var u=e.getResourceBundleModel().getResourceBundle();if(e.tableHasDuplicateParameterNames(g.getProperty("/config/rows"))){a.reject(u.getText("configuration.signature.uniqueParamMessage.text"))}else if(!e.tableHasInvalidSapPrelaunchOperationValue(g.getProperty("/config/rows"))){var f=JSON.stringify([{type:"split",source:"p1",target:["p2","p3"]},{type:"merge",source:["p4","p5"],target:"p6"}]);a.reject(u.getText("configuration.signature.invalidSapPrelaunchOperationsMessage.text",[f]))}else{var d=g.getProperty("/config/formFactorConfigDefault")?undefined:e.buildFormFactorsObject(g);var _=e.getMappingSignatureString(g.getProperty("/config/rows"),g.getProperty("/config/isUnknownAllowed"));var v=e.getMappingSignature(g.getProperty("/config/rows"),g.getProperty("/config/isUnknownAllowed"));var y={semantic_object:(g.getProperty("/config/semantic_object")||"").trim(),semantic_action:(g.getProperty("/config/semantic_action")||"").trim(),display_title_text:(g.getProperty("/config/display_title_text")||"").trim(),url:(g.getProperty("/config/url")||"").trim(),ui5_component:(g.getProperty("/config/ui5_component")||"").trim(),navigation_provider:(g.getProperty("/config/navigation_provider")||"").trim(),navigation_provider_role:(g.getProperty("/config/navigation_provider_role")||"").trim(),navigation_provider_instance:(g.getProperty("/config/navigation_provider_instance")||"").trim(),target_application_id:(g.getProperty("/config/target_application_id")||"").trim(),target_application_alias:(g.getProperty("/config/target_application_alias")||"").trim(),transaction:{code:(g.getProperty("/config/transaction/code")||"").trim()},web_dynpro:{application:(g.getProperty("/config/web_dynpro/application")||"").trim(),configuration:(g.getProperty("/config/web_dynpro/configuration")||"").trim()},target_system_alias:(g.getProperty("/config/target_system_alias")||"").trim(),display_info_text:(g.getProperty("/config/display_info_text")||"").trim(),form_factors:d,mapping_signature:_,signature:v};var m=s.bag.getBag("tileProperties");m.setText("display_title_text",y.display_title_text);s.writeConfiguration.setParameterValues({tileConfiguration:JSON.stringify(y)},function(){var n=e.getActionConfiguration(s,false);var p=e.getActionConfiguration(s,true);g=new i({config:n,tileModel:c});t.setModel(g);c.setData({config:p,displayText:r(p.semantic_object,p.semantic_action)},false);m.save(function(){o.debug("property bag 'tileProperties' saved successfully");a.resolve()},l)},l)}return a.promise()},onCancelConfiguration:function(t){var i=t.getViewData();var n=t.getModel();var o=n.getProperty("/tileModel");var r=i.chip;var a=e.getActionConfiguration(r,false);t.getModel().setData({config:a,tileModel:o},false)}})});