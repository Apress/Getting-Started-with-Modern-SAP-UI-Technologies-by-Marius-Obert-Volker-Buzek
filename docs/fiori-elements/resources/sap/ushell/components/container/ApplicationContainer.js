// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/security/encodeXML","sap/base/util/deepEqual","sap/base/util/uid","sap/base/util/UriParameters","sap/m/MessagePopover","sap/m/Text","sap/ui/core/Component","sap/ui/core/ComponentContainer","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/core/mvc/View","sap/ui/core/routing/History","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI","sap/ushell/ApplicationType","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/library","sap/ushell/resources","sap/ushell/System","sap/ushell/User","sap/ushell/utils","sap/ushell/utils/UrlParsing","sap/ui/core/Core","sap/ui/thirdparty/hasher","sap/ui/core/Configuration"],function(e,t,a,n,r,o,i,s,p,l,u,f,d,c,g,m,h,y,v,C,I,b,_,A,P,S,E,w){"use strict";var U="sap.ushell.components.container.",x=U+"ApplicationContainer",R="sap.ushell.Container.dirtyState.",T="autoplay;battery;camera;display-capture;geolocation;gyroscope;magnetometer;microphone;midi;clipboard-write;clipboard-read;fullscreen;serial;",M,D,L,F=false,O=false,N=[],H=0,V=0,j;var W=["sap-ach","sap-fiori-id","sap-hide-intent-link","sap-priority","sap-tag","sap-ui-app-id-hint","sap-ui-debug","sap-ui-fl-control-variant-id","sap-ui-fl-max-layer","sap-ui-tech-hint","sap-ui2-tcode","sap-ui2-wd-app-id","sap-ui2-wd-conf-id","sap-ushell-cdm-site-url","sap-ushell-navmode","sap-ushell-next-navmode","sap-ushell-url","sap-app-origin-hint"];function k(e){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(t){t.isUrlSupported(e.url).done(function(){e.promise.resolve({allowed:true,id:e.id})}).fail(function(){e.promise.resolve({allowed:false,id:e.id})})})}function q(e){var t={asyncURLHandler:be.prototype._adaptIsUrlSupportedResultForMessagePopover};if(o&&o.setDefaultHandlers){o.setDefaultHandlers(t)}v.emit("StepDone",e.stepName)}v.once("initMessagePopover").do(q);M=new A.Map;function B(e){return M.get(e.getId())}function J(){return D}function K(e){var t=r.fromURL(e).mParams,a=t["sap-xapp-state"],n;delete t["sap-xapp-state"];n={startupParameters:t};if(a){n["sap-xapp-state"]=a}return n}function z(e,t){return I.i18n.getText(e,t)}function G(){return new u({size:"2rem",src:"sap-icon://error",tooltip:be.prototype._getTranslatedText("an_error_has_occured")})}function $(t){var a=t.getAggregation("child"),n;if(a instanceof p){n=a.getComponentInstance().getMetadata().getName().replace(/\.Component$/,"");e.debug("unloading component "+n,null,x)}t.destroyAggregation("child")}function Q(t,a,n){return new Promise(function(r){var o,i,l,u,d,c={},g,m;function h(e){e.setWidth(t.getWidth());e.setHeight(t.getHeight());e.addStyleClass("sapUShellApplicationContainer");t.setAggregation("child",e,true)}o=a.indexOf("?");if(o>=0){u=be.prototype._getParameterMap(a);c=u.startupParameters;a=a.slice(0,o)}if(a.slice(-1)!=="/"){a+="/"}if(/\.view\.(\w+)$/i.test(n)){l=/^SAPUI5=(?:([^/]+)\/)?([^/]+)\.view\.(\w+)$/i.exec(n);if(!l){e.error("Invalid SAPUI5 URL",n,x);r(be.prototype._createErrorControl());return}d=l[1];g=l[2];m=l[3].toUpperCase();if(d){g=d+"."+g}else{i=g.lastIndexOf(".");if(i<1){e.error("Missing namespace",n,x);return be.prototype._createErrorControl()}d=g.slice(0,i)}}else{d=n.replace(/^SAPUI5=/,"")}var y={};var v=d.replace(/\./g,"/");y[d]=a+v;sap.ui.loader.config({paths:y});be.prototype._destroyChild(t);if(g){if(t.getApplicationConfiguration()){c.config=t.getApplicationConfiguration()}f.create({id:t.getId()+"-content",type:m,viewData:c||{},viewName:g}).then(function(e){t.fireEvent("applicationConfiguration");h(e);r(e)})}else{e.debug("loading component "+d,null,x);var C=u?{startupParameters:u.startupParameters}:{startupParameters:{}};if(u&&u["sap-xapp-state"]){C["sap-xapp-state"]=u["sap-xapp-state"]}if(t.getApplicationConfiguration()){C.config=t.getApplicationConfiguration()}s.create({id:t.getId()+"-component",componentData:C,name:d}).then(function(e){t.fireEvent("applicationConfiguration",{configuration:e.getMetadata().getConfig()});var a=new p({id:t.getId()+"-content",component:e});h(a);r(a)})}})}function X(e,t){setTimeout(function(){S.getEventBus().publish("sap.ushell",e,t)},0)}function Y(t,a,n){var r=this,o,i={oControl:undefined,oPromise:undefined},l,u,f,d={startupParameters:{}},c,m=t.getComponentHandle(),h,y;function v(e){t.fireEvent("applicationConfiguration",{configuration:e.getMetadata().getConfig()});u=new p({id:t.getId()+"-content",component:e});u.setHeight(t.getHeight());u.setWidth(t.getWidth());u.addStyleClass("sapUShellApplicationContainer");t._disableRouterEventHandler=be.prototype._disableRouter.bind(r,e);S.getEventBus().subscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",t._disableRouterEventHandler);t.setAggregation("child",u,true);sap.ushell.Container.getServiceAsync("PluginManager").then(function(t){h=t.getPluginLoadingPromise("RendererExtensions");y=h&&h.state();if(y==="pending"){h.done(function(){be.prototype._publishExternalEvent("appComponentLoaded",{component:e})}).fail(function(){be.prototype._publishExternalEvent("appComponentLoaded",{component:e})})}if(y==="resolved"||y==="rejected"){be.prototype._publishExternalEvent("appComponentLoaded",{component:e})}});return u}l=a.indexOf("?");if(l>=0){f=be.prototype._getParameterMap(a);d={startupParameters:f.startupParameters};if(f["sap-xapp-state"]){d["sap-xapp-state"]=f["sap-xapp-state"]}a=a.slice(0,l)}if(t.getApplicationConfiguration()){d.config=t.getApplicationConfiguration()}if(a.slice(-1)!=="/"){a+="/"}be.prototype._destroyChild(t);c={id:t.getId()+"-component",name:n,componentData:d};e.debug("Creating component instance for "+n,JSON.stringify(c),x);S.getEventBus().publish("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",{name:n});if(m){var C=m.getInstance(c);i.oControl=v(C)}else{o=new g.Deferred;var I={};var b=n.replace(/\./g,"/");I[b]=a;sap.ui.loader.config({paths:I});e.error("No component handle available for '"+n+"'; fallback to component.load()",null,x);s.create({id:t.getId()+"-component",name:n,manifest:false,componentData:d}).then(function(e){o.resolve(v(e))});i.oPromise=o.promise()}return i}function Z(t){var a;if(t instanceof s&&typeof t.getRouter==="function"){a=t.getRouter();if(a&&typeof a.stop==="function"){e.info("router stopped for instance "+t.getId());a.stop()}}}function ee(e){var t=document.createElement("a"),a=r.fromURL(e).get("sap-client"),n;t.href=e;n=t.protocol+"//"+t.host;return new b({alias:a?n+"?sap-client="+a:n,baseUrl:n,client:a||undefined,platform:"abap"})}function te(e,t){var a=false,n=e.getDomRef(),r,o;if(e.getIframeWithPost()===true&&n&&n.getAttribute&&n.getAttribute("sap-iframe-app")=="true"){n=g("#"+n.getAttribute("id")+"-iframe")[0]}if(n){r=m(e._getIFrameUrl(n)||window.location&&window.location.href||"");o=r.protocol()+"://"+r.host();a=t.source===n.contentWindow||t.origin===o}return a}function ae(t,a,r){var o=JSON.stringify({type:"request",service:a,request_id:n(),body:{}});e.debug("Sending post message request to origin ' "+r+"': "+o,null,"sap.ushell.components.container.ApplicationContainer");t.postMessage(o,r)}function ne(){var e=this.getDomRef();if(!e||e.tagName!=="IFRAME"){if(this.getIframeWithPost()===true&&e&&e.getAttribute&&e.getAttribute("sap-iframe-app")=="true"){return g("#"+e.getAttribute("id")+"-iframe")[0]}return null}return e}function re(e){var t;if(e===undefined){e=this._getIFrame()}if(this.getIframeWithPost()===true){t=g("#"+e.getAttribute("id").replace("-iframe","-form"))[0].action;if(t===undefined&&(new m).query(true).hasOwnProperty("sap-isolation-enabled")){t=e.src}}else{t=e.src}return t}function oe(t,a){var n=t&&t.getUi5ComponentName&&t.getUi5ComponentName(),r=a.data,o=typeof r==="string"&&r.indexOf("sap.ushell.appRuntime.iframeIsValid")>0;if(t&&!t.getActive()&&o!==true){e.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(r)+"' on inactive container '"+t.getId()+"'","Only active containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return}if(typeof n==="string"){e.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(r)+"' on container of UI5 application '"+n+"'","Only non UI5 application containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return}var i={bPluginsStatusChecked:F,bKeepMessagesForPlugins:O,bApiRegistered:true};L(t,a,i);be.prototype._handlePostMessagesForPluginsPostLoading(t,a,i)}function ie(t,a,n){var r,o;if(n.bApiRegistered!==false){return}sap.ushell.Container.getServiceAsync("PluginManager").then(function(n){if(F===false){F=true;r=n.getPluginLoadingPromise("RendererExtensions");o=r&&r.state();if(o==="pending"){O=true;r.always(function(){var t;O=false;e.debug("Processing post messages queue after 'RendererExtensions' plugins loaded, queue size is: "+N.length,null,"sap.ushell.components.container.ApplicationContainer");for(var a=0;a<N.length;a++){t=N[a];try{be.prototype._handleMessageEvent.call(t.that,t.oContainer,t.oMessage)}catch(t){e.error(t.message||t,null,"sap.ushell.components.container.ApplicationContainer")}}N=[]})}}if(O===true){N.push({index:H++,that:this,oContainer:t,oMessage:a})}})}function se(){F=false;O=false;N=[];H=0}function pe(e,t){var a=e._getIFrame(),n=e.getApplicationType();if(A.isApplicationTypeEmbeddedInIframe(e.getApplicationType(n))&&a){var r=new m(e._getIFrameUrl(a));var o=r.protocol()+"://"+r.host();a.contentWindow.postMessage(JSON.stringify({action:"pro54_disableDirtyHandler"}),o);t.preventDefault()}}function le(e,t,a){e.openStart("div",t).accessibilityState(t).class("sapUShellApplicationContainer").style("height",t.getHeight()).style("width",t.getWidth()).openEnd();if(a){e.renderControl(a)}e.close("div")}function ue(e,t,a){if(A.isApplicationTypeEmbeddedInIframe(t)||A.isApplicationTypeEmbeddedInIframe(e.getFrameworkId())){var n=e.getTargetNavigationMode();a=be.prototype._adjustNwbcUrl(a,t,n,e.getIsStateful());A.localStorageSetItem(e.globalDirtyStorageKey,sap.ushell.Container.DirtyState.INITIAL)}return a}function fe(e,t,a,n){var o,i=function(){var e=A.getParameterValueBoolean("sap-accessibility");if(e!==undefined){return e}return sap.ushell.Container.getUser().getAccessibilityMode()},s=function(){var t=r.fromURL(e)||{mParams:{}};if(t.mParams["sap-theme"]===undefined){return sap.ushell.Container.getUser().getTheme(_.prototype.constants.themeFormat.NWBC)}return undefined},p=function(){var t=false,a=r.fromURL(e)||{mParams:{}};t=w.getStatistics()&&a.mParams["sap-statistics"]===undefined;return t},l=function(){var e=E&&E.getHash(),t="",a;if(e&&e.length>0&&e.indexOf("sap-iapp-state=")>0){a=/(?:sap-iapp-state=)([^&/]+)/.exec(e);if(a&&a.length===2){t=a[1]}}return t},u=function(){var e="";var t=!!g("body.sapUiSizeCompact").length;var a=!!g("body.sapUiSizeCozy").length;if(t===true){e="0"}else if(a){e="1"}return e};e+=e.indexOf("?")>=0?"&":"?";e+="sap-ie=edge";o=s();if(o){e+=e.indexOf("?")>=0?"&":"?";e+="sap-theme="+encodeURIComponent(o)}if(a){e+=e.indexOf("?")>=0?"&":"?";e+="sap-target-navmode="+encodeURIComponent(a)}if(i()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-accessibility=X"}if(p()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-statistics=true"}if(t==="TR"||t==="GUI"){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=2"}else if(n){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=1"}var f=l();if(f&&f.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-iapp-state="+f}var d=u();if(d&&d.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-touch="+d}var c=0;if(y.last("/core/shell/sessionTimeoutIntervalInMinutes")>0){c=y.last("/core/shell/sessionTimeoutIntervalInMinutes")}e+=e.indexOf("?")>=0?"&":"?";e+="sap-ushell-timeout="+c;return A.appendSapShellParam(e,t)}function de(e,t,a,n){var r=t.getAggregation("child"),o,i;if(!r||t._bRecreateChild){i=be.prototype._createUi5Component(t,a,n);if(i.oControl!==undefined){t._bRecreateChild=false;be.prototype._renderControlInDiv(e,t,i.oControl)}else{t.oDeferredControlCreation=new g.Deferred;be.prototype._renderControlInDiv(e,t);i.oPromise.then(function(e){t._bRecreateChild=false;o=S.createRenderManager();o.renderControl(e);o.flush(g("#"+t.getId())[0]);o.destroy();t.oDeferredControlCreation.resolve()})}}else{be.prototype._renderControlInDiv(e,t,r)}}function ce(e,t,n){var r=e.getProperty(t);if(a(r,n)){return}e.setProperty(t,n);e._bRecreateChild=true}function ge(t,a,n,o,i){var s,p=true,l=false;localStorage.removeItem(a.globalDirtyStorageKey);a.oDeferredControlCreation=undefined;if(i&&i.indexOf("SAPUI5.Component=")===0&&n===h.URL.type){de(t,a,o,i.replace(/^SAPUI5\.Component=/,""));return}if(i&&i.indexOf("SAPUI5=")===0&&n===h.URL.type){be.prototype._renderControlInDiv(t,a,undefined,"open");a.oDeferredControlCreation=new g.Deferred;be.prototype._createUi5View(a,o,i).then(function(e){var n,r=g("#"+a.getId());if(r&&r.length>0){n=S.createRenderManager();n.renderControl(e);n.flush(g("#"+a.getId())[0]);n.destroy()}else{t.renderControl(e)}a.oDeferredControlCreation.resolve()});be.prototype._renderControlInDiv(t,a,undefined,"close");return}e.debug('Not resolved as "SAPUI5.Component=" or "SAPUI5=" , '+"will attempt to load into iframe "+i);if(!a.getActive()){e.debug("Skipping rendering container iframe","Container '"+a.getId()+"' is inactive");return}try{o=a.getFrameSource(n,o)}catch(n){e.error(n.message||n,null,x);a.fireEvent("applicationConfiguration");t.renderControl(be.prototype._createErrorControl());return}if(sap.ushell.Container){s=be.prototype._getLogoutHandler(a);if(!s){if(A.isApplicationTypeEmbeddedInIframe(n)){s=be.prototype._logout.bind(null,a);M.put(a.getId(),s);sap.ushell.Container.attachLogoutEvent(s);sap.ushell.Container.addRemoteSystem(be.prototype._createSystemForUrl(o))}}else if(!A.isApplicationTypeEmbeddedInIframe(n)){sap.ushell.Container.detachLogoutEvent(s);M.remove(a.getId())}}o=be.prototype._checkNwbcUrlAdjustment(a,n,o);var u=r.fromURL(document.URL);if(u.has("sap-iframe-params")){var f=u.get("sap-iframe-params")||"",d=f.split(",");if(d.length>0){var c=new m(o);d.forEach(function(e){if(e&&e.length>0){if(u.has(e)){c.addQuery(e,u.get(e))}}});o=c.toString()}}if(j){j.then(function(e){e.addAcceptedOrigin(new m(o).origin())})}if(n==="TR"){a.setProperty("iframePostAllParams",true,true)}if(u.get("sap-post")==="false"){p=false}else if(window.QUnit!==undefined){p=a.getIframeWithPost()}if(p===true&&a.getOpenWithPostByAppParam()===false){p=false}if(u.get("sap-post")==="true"){l=true}if(p===true&&(n==="NWBC"||n==="TR"||n==="WDA"||n==="WCF")||l===true){a.setProperty("iframeWithPost",true,true);a.oDeferredRenderer=new g.Deferred;o=be.prototype._filterURLParams(o);var v=[];var C=be.prototype._getParamKeys(o,v);be.prototype._generateRootElementForIFrame(t,a,true);if(C.length>0){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){e.getAppStateData(C).then(function(e){var n;var r=g("#"+a.getId());if(r.length>0){n=S.createRenderManager();be.prototype._buildHTMLElements(n,a,e,v,o);n.flush(r[0]);n.destroy()}else{be.prototype._buildHTMLElements(t,a,e,v,o)}setTimeout(a.oDeferredRenderer.resolve,0)},function(e){be.prototype._buildHTMLElements(t,a,undefined,v,o);setTimeout(a.oDeferredRenderer.resolve,0)})})}else{be.prototype._buildHTMLElements(t,a,undefined,v,o);setTimeout(a.oDeferredRenderer.resolve,0)}be.prototype._generateRootElementForIFrame(t,a,false);return}if(a.getFrameworkId&&a.getFrameworkId()==="UI5"&&a.getIsStateful&&a.getIsStateful()===true){a.setProperty("isIframeBusy",true,true)}a.fireEvent("applicationConfiguration");t.openStart("iframe",a).accessibilityState(a).attr("src",o).attr("title",I.i18n.getText("AppilcationContainer.IframeTitle")).attr("sap-iframe-idx",++V).class("sapUShellApplicationContainer").style("height",a.getHeight()).style("width",a.getWidth());if(y.last("/core/shell/enableFeaturePolicyInIframes")===true){t.attr("allow",T)}t.openEnd().close("iframe")}function me(e){var t=new m(e);t=t.removeSearch(W);return t.toString()}function he(e,t){var a=[],n;if(e.indexOf("sap-intent-param=")>0){n=/(?:sap-intent-param=)([^&/]+)/.exec(e);if(n&&n.length===2){a.push([n[1]]);t.push("sap-intent-param-data")}}if(e.indexOf("sap-xapp-state=")>0){n=/(?:sap-xapp-state=)([^&/]+)/.exec(e);if(n&&n.length===2){a.push([n[1]]);t.push("sap-xapp-state-data")}}if(e.indexOf("sap-iapp-state=")>0){n=/(?:sap-iapp-state=)([^&/]+)/.exec(e);if(n&&n.length===2){a.push([n[1]]);t.push("sap-iapp-state-data")}}return a}function ye(e,t,a,n,o){var i=t.getId()+"-form",s="",p=false;if(a===undefined){a=[]}a.push([sap.ushell.Container.getFLPUrl(true)]);n.push("sap-flp-url");a.push([t.getSystemAlias()]);n.push("system-alias");var l="";var u={};n.forEach(function(e,t){if(a[t][0]){u[e]=a[t][0]}});var f=o;l=JSON.stringify(u);var d={};if(t.getIframePostAllParams()===true){d=r.fromURL(o);s=ve(t,d,false);if(s!==""){o=Ce(o,d)}}t.fireEvent("applicationConfiguration");e.openStart("form").attr("id",i).attr("method","post").attr("name",i).attr("target",t.getId()+"-iframe").attr("action",o).style("display","none").openEnd();e.voidStart("input").attr("name","sap-flp-params").attr("value",l).voidEnd();if(t.getIframePostAllParams()===true){ve(t,d,true,e)}e.close("form");var c=t.sId;if(t.hasStyleClass("sapUShellApplicationContainerIframeHidden")){p=true;t.toggleStyleClass("sapUShellApplicationContainerIframeHidden",false)}t.sId+="-iframe";e.openStart("iframe",t).attr("name",t.getId()).accessibilityState(t).attr("sap-orig-src",f).attr("title",I.i18n.getText("AppilcationContainer.IframeTitle")).attr("sap-iframe-idx",++V).class("sapUShellApplicationContainer").style("height",t.getHeight()).style("width",t.getWidth());if(y.last("/core/shell/enableFeaturePolicyInIframes")===true){e.attr("allow",T.replaceAll(";"," "+new m(o).origin()+";"))}e.openEnd().close("iframe");t.sId=c;if(p){t.toggleStyleClass("sapUShellApplicationContainerIframeHidden",true)}}function ve(e,t,a,n){var r="";var o="";if(t.has("sap-iframe-hint")){r=t.get("sap-iframe-hint")}var i=t.mParams;if(e.getApplicationType()==="TR"||r==="GUI"){var s,p;for(s in i){if(s==="sap-iframe-hint"||s==="sap-keep-alive"){continue}p=i[s][0];if(a===true){n.voidStart("input").attr("name",s).attr("value",p).voidEnd()}else{o+="*"}}}return o}function Ce(e,t){var a=t.get("sap-iframe-hint"),n=t.get("sap-keep-alive"),r=new m(e).query("");if(typeof a==="string"){r.addSearch("sap-iframe-hint",a)}if(typeof n==="string"){r.addSearch("sap-keep-alive",n)}return r.toString()}function Ie(e,t,a){if(a){e.openStart("div",t).attr("sap-iframe-app","true").class("sapUShellApplicationContainer").style("height",t.getHeight()).style("width",t.getWidth()).openEnd()}else{e.close("div")}}var be=l.extend(x,{metadata:{properties:{additionalInformation:{defaultValue:"",type:"string"},application:{type:"object"},applicationConfiguration:{type:"object"},applicationType:{defaultValue:"URL",type:U+"ApplicationType"},height:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},navigationMode:{defaultValue:"",type:"string"},targetNavigationMode:{defaultValue:"",type:"string"},text:{defaultValue:"",type:"string"},url:{defaultValue:"",type:"string"},visible:{defaultValue:true,type:"boolean"},active:{defaultValue:true,type:"boolean"},"sap-system":{type:"string"},applicationDependencies:{type:"object"},componentHandle:{type:"object"},ui5ComponentName:{type:"string"},width:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},shellUIService:{type:"object"},appIsolationService:{type:"object"},reservedParameters:{type:"object"},coreResourcesFullyLoaded:{type:"boolean"},isStateful:{defaultValue:false,type:"boolean"},iframeHandlers:{defaultValue:"",type:"string"},openWithPostByAppParam:{defaultValue:true,type:"boolean"},iframeWithPost:{defaultValue:false,type:"boolean"},beforeAppCloseEvent:{type:"object"},extendedInfo:{type:"object"},systemAlias:{defaultValue:"",type:"string"},iframePostAllParams:{defaultValue:false,type:"boolean"},isKeepAlive:{defaultValue:false,type:"boolean"},frameworkId:{defaultValue:"",type:"string"},iframeReusedForApp:{defaultValue:false,type:"boolean"},isIframeValidTime:{defaultValue:{time:0},type:"object"},isIframeBusy:{defaultValue:false,type:"boolean"},isInvalidIframe:{defaultValue:false,type:"boolean"}},events:{applicationConfiguration:{}},aggregations:{child:{multiple:false,type:"sap.ui.core.Control",visibility:"hidden"}},library:"sap.ushell",designtime:"sap/ushell/designtime/ApplicationContainer.designtime"},exit:function(){var e,t=this;if(sap.ushell.Container){e=be.prototype._getLogoutHandler(t);if(e){sap.ushell.Container.detachLogoutEvent(e);M.remove(t.getId())}}localStorage.removeItem(t.globalDirtyStorageKey);if(t._unloadEventListener){removeEventListener("unload",t._unloadEventListener)}if(t._disableRouterEventHandler){S.getEventBus().unsubscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",t._disableRouterEventHandler)}if(t._storageEventListener){removeEventListener("storage",t._storageEventListener)}if(t._messageEventListener){removeEventListener("message",t._messageEventListener)}be.prototype._destroyChild(t);if(l.exit){l.exit.apply(t)}},setHandleMessageEvent:function(e){L=e},init:function(){var t=this;t.globalDirtyStorageKey=R+n();t._unloadEventListener=t.exit.bind(t);addEventListener("unload",t._unloadEventListener);t._storageEventListener=function(a){var n=t.getApplicationType();if(a.key===t.globalDirtyStorageKey&&a.newValue===sap.ushell.Container.DirtyState.PENDING&&A.isApplicationTypeEmbeddedInIframe(n)){var r=t._getIFrame();if(r){e.debug("getGlobalDirty() send pro54_getGlobalDirty ",null,"sap.ushell.components.container.ApplicationContainer");var o=new m(t._getIFrameUrl(r));var i=o.protocol()+"://"+o.host();r.contentWindow.postMessage(JSON.stringify({action:"pro54_getGlobalDirty"}),i)}}};addEventListener("storage",t._storageEventListener);t._messageEventListener=be.prototype._handleMessageEvent.bind(null,t);addEventListener("message",t._messageEventListener);if(!j&&sap.ushell.Container&&sap.ushell.Container.getServiceAsync){j=sap.ushell.Container.getServiceAsync("MessageBroker")}},onAfterRendering:function(){var e=this;this.rerender=function(){};if(c.os.ios&&this.$().prop("tagName")==="IFRAME"){this.$().parent().css("overflow","auto")}if(this.oDeferredRenderer){this.oDeferredRenderer.done(function(){var t=document.getElementById(e.getId()+"-form");if(t){t.submit()}})}},renderer:{apiVersion:2,render:function(t,a){var n=a.getApplication(),r=a.launchpadData,o;if(!a.getVisible()){be.prototype._renderControlInDiv(t,a);return}if(a.bTestControl){be.prototype._renderControlInDiv(t,a,a.oTestControl)}else if(a.error){delete a.error;be.prototype._renderControlInDiv(t,a,be.prototype._createErrorControl())}else if(!n){be.prototype._render(t,a,a.getApplicationType(),a.getUrl(),a.getAdditionalInformation())}else if(!n.isResolvable()){be.prototype._render(t,a,n.getType(),n.getUrl(),"")}else if(r){be.prototype._render(t,a,r.applicationType,r.Absolute.url.replace(/\?$/,""),r.applicationData)}else{e.debug("Resolving "+n.getUrl(),null,x);n.resolve(function(t){e.debug("Resolved "+n.getUrl(),JSON.stringify(t),x);a.launchpadData=t;be.prototype._destroyChild(a)},function(e){var t=n.getMenu().getDefaultErrorHandler();if(t){t(e)}be.prototype._destroyChild(a);a.error=e});o=new i({text:be.prototype._getTranslatedText("loading",[n.getText()])});be.prototype._destroyChild(a);a.setAggregation("child",o);be.prototype._renderControlInDiv(t,a,o)}}}});be.prototype.getFrameSource=function(e,t){if(!Object.prototype.hasOwnProperty.call(h.enum,e)){throw new Error("Illegal application type: "+e)}return t};be.prototype.setUrl=function(e){ce(this,"url",e)};be.prototype.setAdditionalInformation=function(e){ce(this,"additionalInformation",e)};be.prototype.setApplicationType=function(e){ce(this,"applicationType",e)};be.prototype.createPostMessageRequest=function(e,t){var a=Date.now().toString();return{type:"request",request_id:a,service:e,body:t}};be.prototype.setNewTRApplicationContext=function(e){var t=new g.Deferred,a=this._getIFrame(),n,r,o=this;if(!a){return t.promise().reject({message:"Expected an existing TR application application frame but found none."})}function i(){if(r){r["sap-flp-url"]=sap.ushell.Container.getFLPUrl(true);r["system-alias"]=o.getSystemAlias();n["sap-flp-params"]=r}var e=o.createPostMessageRequest("sap.its.startService",n);o.postMessageToIframe(e,a,true).then(function(){t.resolve()}).catch(function(e){t.reject({eventData:e,message:"Failed to change application context."})})}e=A.appendSapShellParam(e);e=be.prototype._filterURLParams(e);n={url:e};if(this.getIframeWithPost&&this.getIframeWithPost()===true){var s=[];var p=be.prototype._getParamKeys(e,s);if(p.length>0){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){e.getAppStateData(p).then(function(e){r={};s.forEach(function(t,a){if(e[a][0]){r[t]=e[a][0]}});i()},function(e){i()})})}else{r={};i()}}else{i()}return t.promise()};be.prototype.postMessageToIframe=function(t,a,n){var r=this;var o=t.request_id;return new Promise(function(i,s){function p(a){var n={};try{if(typeof a.data==="string"&&a.data.indexOf("{")===0){try{n=JSON.parse(a.data)}catch(e){n={}}}else{return}if(!n.request_id||o!==n.request_id){return}if(n.status==="success"){i(n)}else{s(n)}window.removeEventListener("message",p)}catch(n){i();e.warning("Obtained bad response from framework in response to message "+t.request_id);e.debug("Underlying framework returned invalid response data: '"+a.data+"'")}}var l=JSON.stringify(t);e.debug("Sending postMessage "+l+" to application container '"+r.getId()+"'");var u=new m(r._getIFrameUrl(a));var f=u.protocol()+"://"+u.host();if(n){window.addEventListener("message",p,false);a.contentWindow.postMessage(l,f)}else{a.contentWindow.postMessage(l,f);i()}})};be.prototype.postMessageToCurrentIframe=function(e,t){if(t===undefined){t=false}var a=this._getIFrame();if(!a){if(t){return Promise.reject({message:"Expected opened iframe not found."})}return}return this.postMessageToIframe(e,a,t)};be.prototype.setNewApplicationContext=function(e,t){var a=this;var n=this["setNew"+e+"ApplicationContext"];if(!n){return Promise.reject({message:"Unsupported application type"})}var r=this._getIFrame();if(!r){return Promise.reject({message:"Expected an existing TR application application frame but found none."})}var o=this.createPostMessageRequest("sap.gui.triggerCloseSessionImmediately",{});return this.postMessageToIframe(o,r,true).then(function(){return n.call(a,t)},function(e){return Promise.reject({eventData:e,message:"Failed to change application context."})})};be.prototype.onApplicationOpened=function(e){var t=this.getIsStateful();if(!t){return Promise.resolve()}var a=this.getApplicationType();if(a==="TR"&&e!=="TR"){var n=this._getIFrame();if(!n){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."})}var r=this.createPostMessageRequest("sap.gui.triggerCloseSession",{});return this.postMessageToIframe(r,n,false).catch(function(e){return Promise.reject({eventData:e,message:"Failed to change application context."})})}return Promise.resolve()};be.prototype.postMessageRequest=function(e,t){var a=this._getIFrame();if(!a){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."})}var n=this.createPostMessageRequest(e,t||{});return this.postMessageToIframe(n,a,false).catch(function(e){return Promise.reject({eventData:e,message:"Failed to post message."})})};be.prototype.sendBeforeAppCloseEvent=function(){var e=this.getBeforeAppCloseEvent&&this.getBeforeAppCloseEvent(),t;if(e&&e.enabled&&e.enabled===true){t=this.createPostMessageRequest("sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent",e.params);return this.postMessageToIframe(t,this._getIFrame(),true)}return undefined};be.prototype.getDeffedControlCreation=function(e){return this.oDeferredControlCreation?this.oDeferredControlCreation.promise():g.Deferred().resolve().promise()};be.prototype._getCommunicationHandlers=J;be.prototype._adaptIsUrlSupportedResultForMessagePopover=k;be.prototype._getLogoutHandler=B;be.prototype._getParameterMap=K;be.prototype._getTranslatedText=z;be.prototype._createErrorControl=G;be.prototype._destroyChild=$;be.prototype._createUi5View=Q;be.prototype._publishExternalEvent=X;be.prototype._createUi5Component=Y;be.prototype._disableRouter=Z;be.prototype._createSystemForUrl=ee;be.prototype._isTrustedPostMessageSource=te;be.prototype._handleMessageEvent=oe;be.prototype._logout=pe;be.prototype._renderControlInDiv=le;be.prototype._checkNwbcUrlAdjustment=ue;be.prototype._adjustNwbcUrl=fe;be.prototype._render=ge;be.prototype._getParamKeys=he;be.prototype._buildHTMLElements=ye;be.prototype._buildHTMLForAllPostParams=ve;be.prototype._generateRootElementForIFrame=Ie;be.prototype._backButtonPressedCallback=ae;be.prototype._getIFrame=ne;be.prototype._getIFrameUrl=re;be.prototype._filterURLParams=me;be.prototype._resetPluginsLoadIndications=se;be.prototype._handlePostMessagesForPluginsPostLoading=ie;return be},true);