/*!
 * Copyright (c) 2009-2023 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/isEmptyObject","sap/m/Button","sap/m/library","sap/ui/core/Configuration","sap/ui/core/IconPool","sap/ui/core/UIComponent","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ushell/resources"],function(e,s,t,n,a,r,o,i,l,u){"use strict";var g;var p=n.ButtonType;return o.extend("sap.ushell.components.shell.UserImage.Component",{metadata:{version:"1.113.0",library:"sap.ushell.components.shell.UserImage",dependencies:{libs:{"sap.m":{},"sap.ui.layout":{lazy:true}}}},createContent:function(){var e;g=sap.ushell.Container.getRenderer("fiori2")._oShellView;e=(g.getViewData()?g.getViewData().config:{})||{};this.loadUserImage();var s=sap.ushell.Container.getUser();if(e.enableUserImgConsent===true&&s.getImageConsent()===undefined){this._showUserConsentPopup()}},_showUserConsentPopup:function(){var e=this;var s=a.getRTL()?"Right":"Left";var n,r,o,l;var g=new t("yesButton",{text:u.i18n.getText("DisplayImg"),type:p.Emphasized,press:function(){e.updateUserImage(true);n.close()}});var m=new t("noButton",{text:u.i18n.getText("DontDisplayImg"),press:function(){e.updateUserImage(false);n.close()}});sap.ui.require(["sap/ui/layout/form/VerticalLayout","sap/m/Dialog","sap/m/Text","sap/m/Link","sap/m/FlexBox"],function(e,t,a,p,d){n=new t("userConsentDialog",{title:u.i18n.getText("userImageConsentDialogTitle"),modal:true,stretch:i.system.phone,buttons:[g,m],afterClose:function(){n.destroy()}}).addStyleClass("sapUshellUserConsentDialog").addStyleClass("sapContrastPlus");var c=new a({text:u.i18n.getText("userImageConsentDialogTermsOfUse")}).addStyleClass("sapUshellUserConsentDialogTerms");var C=new a({text:u.i18n.getText("userImageConsentText"),textAlign:s}).addStyleClass("sapUshellUserConsentDialogText");var f=new p({text:u.i18n.getText("userImageConsentDialogShowTermsOfUse"),textAlign:s,press:function(){var e=l.getVisible();if(e){l.setVisible(false);f.setText(u.i18n.getText("userImageConsentDialogShowTermsOfUse"))}else{f.setText(u.i18n.getText("userImageConsentDialogHideTermsOfUse"));l.setVisible(true)}}}).addAriaLabelledBy(C);r=new d({alignItems:"Center",direction:"Row",items:[C]}).addStyleClass("sapUshellUserConsentDialogBox");o=new d({alignItems:"Center",direction:"Row",items:[f]}).addStyleClass("sapUshellUserConsentDialogBox").addStyleClass("sapUshellUserConsentDialogLink");l=new d({alignItems:"Center",direction:"Row",items:[c]}).addStyleClass("ushellUserImgConsentTermsOfUseFlexBox");l.setVisible(false);var h=new e("userConsentDialogLayout",{content:[r,o,l]});n.addContent(h);n.open()})},loadUserImage:function(){var e=sap.ushell.Container.getUser(),s=e.getImage();if(s){this._setUserImage(s)}e.attachOnSetImage(this._setUserImage.bind(this))},_setUserImage:function(t){var n=typeof t==="string"?t:t.mParameters;if(n&&typeof n==="string"||!s(n)){l.ajax({url:n,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},success:function(){g.getModel().setProperty("/userImage/personPlaceHolder",n);g.getModel().setProperty("/userImage/account",n)},error:function(){e.error("Could not load user image from: "+n,"","sap.ushell.renderers.fiori2.Shell.view");sap.ushell.Container.getUser().setImage("")}})}else{g.getModel().setProperty("/userImage/personPlaceHolder",null);g.getModel().setProperty("/userImage/account",r.getIconURI("account"))}},updateUserImage:function(e){var s=sap.ushell.Container.getUser(),t=new l.Deferred,n;sap.ushell.Container.getServiceAsync("UserInfo").then(function(a){if(e!==undefined){s.setImageConsent(e);n=a.updateUserPreferences(s);n.done(function(){s.resetChangedProperty("isImageConsent");t.resolve()})}else{t.reject(e+"is undefined")}})},exit:function(){}})});