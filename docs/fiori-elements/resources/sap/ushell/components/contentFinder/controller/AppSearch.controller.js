// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["./ContentFinderDialog.controller","../model/formatter","sap/base/Log","sap/f/GridContainerItemLayoutData","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ushell/ui/contentFinder/AppBox"],function(e,t,i,r,o,n,s){"use strict";return e.extend("sap.ushell.components.contentFinder.controller.AppSearch",{formatter:t,filters:{search:"searchFilter",select:"selectFilter"},onInit:function(){this._oActiveFilters={};this.oModel=this.getOwnerComponent().getModel();this.oResourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.getOwnerComponent().getNavContainer().then(function(e){e.attachNavigate(function(){var e=this.oModel.getProperty("/activeNavigationTarget");if(e===this.oModel.getProperty("/navigationTargets/appSearchTiles")||e===this.oModel.getProperty("/navigationTargets/appSearchCards")){this._resetFilters()}}.bind(this))}.bind(this))},onAppSearch:function(e){var t=e.getParameter("newValue");if(t){this._oActiveFilters[this.filters.search]=new o({filters:[new o("appId",n.Contains,t),new o("title",n.Contains,t),new o("subtitle",n.Contains,t),new o("systemInfo",n.Contains,t)],and:false});this._applyFilters()}else{this._resetFilters([this.filters.search])}},onAppBoxSelected:function(){this.oModel.setProperty("/appSearch/selectedAppCount",this.getOwnerComponent().getSelectedAppBoxes(false).length)},onAppBoxSelectedAndClose:function(e){e.getSource().setSelected(true);this.getOwnerComponent().addVisualizations();this.getOwnerComponent().getRootControl().byId("contentFinderDialog").close()},onShowSelectedPressed:function(e){if(e.getParameter("pressed")){this.byId("appSearchField").clear();this._oActiveFilters[this.filters.select]=new o("selected",n.EQ,true);this._applyFilters()}else{this._resetFilters([this.filters.search,this.filters.select]);this.byId("appSearchField").clear()}},tileFactory:function(e,t){var i=new r({columns:1,rows:1});return new s({appId:t.getProperty("appId"),dataHelpId:t.getProperty("dataHelpId"),disablePreview:true,disabled:"{disabled}",gridGapSize:1.5,icon:t.getProperty("icon"),id:"ContentFinderAppBoxTile-"+e,info:t.getProperty("info"),launchUrl:t.getProperty("launchUrl"),layoutData:i,posinset:t.getProperty("posinset"),select:this.onAppBoxSelected.bind(this),selectable:true,selected:"{selected}",setsize:t.getProperty("setsize"),showExtraInformation:true,showPreview:false,subtitle:t.getProperty("subtitle"),systemInfo:t.getProperty("systemInfo"),title:t.getProperty("title"),type:t.getProperty("type"),visible:"{visible}"})},cardFactory:function(e,t){var i=new r({columns:1,rows:1});return new s({appId:t.getProperty("appId"),dataHelpId:t.getProperty("dataHelpId"),disablePreview:true,disabled:"{disabled}",gridGapSize:.75,icon:t.getProperty("icon"),id:"ContentFinderAppBoxCard-"+e,info:t.getProperty("info"),launchUrl:t.getProperty("launchUrl"),layoutData:i,posinset:t.getProperty("posinset"),press:this.onAppBoxSelectedAndClose.bind(this),previewSize:"Large",selectable:false,selected:"{selected}",setsize:t.getProperty("setsize"),showExtraInformation:true,showPreview:false,subtitle:t.getProperty("subtitle"),systemInfo:t.getProperty("systemInfo"),title:t.getProperty("title"),type:t.getProperty("type"),visible:"{visible}"})},_applyFilters:function(){var e=this._getGridContainer();var t=e.getBinding("items");t.filter(new o({filters:Object.values(this._oActiveFilters),and:true}),"Control");this.oModel.setProperty("/appSearch/filteredAppCount",t.getLength())},_resetFilters:function(e){if(!e){e=Object.keys(this._oActiveFilters)}e.forEach(function(e){if(!Object.values(this.filters).includes(e)){i.error("Invalid filter provided. Skipping.",null,this.getOwnerComponent().logComponent);return}delete this._oActiveFilters[e]}.bind(this));this._applyFilters()},_getGridContainer:function(){var e=this.oModel.getProperty("/navigationTargets/appSearchTiles");var t=this.oModel.getProperty("/navigationTargets/appSearchCards");var r=this.oModel.getProperty("/activeNavigationTarget");if(r===e){return this.byId("tileGridContainer")}else if(r===t){return this.byId("cardGridContainer")}i.error("Invalid navigation target provided. Could not determine GridContainer.",null,this.getOwnerComponent().logComponent);return null}})});