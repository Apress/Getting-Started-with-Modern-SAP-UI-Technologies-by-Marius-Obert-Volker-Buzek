// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/deepExtend","sap/ui/thirdparty/jquery"],function(e,s){"use strict";var t="user.postapi.";function n(){var e,s;this.init=function(t,n){e=t;s=n};this.getInterface=function(){var t={};t.registerPostMessageAPIs=r.bind(null,s);t[e===true?"postMessageToApp":"postMessageToFlp"]=i.bind(null,e);t.createPostMessageResult=u;return t}}function r(s,n,r){var i={status:"success",desc:""};var u={isActiveOnly:true,distributionType:["all"],fnResponseHandler:function(){}};if(n===undefined||Object.keys(n).length<=0){i.status="error";i.desc="no handler was found to register";return i}if(r===undefined){r=false}Object.keys(n).forEach(function(s){if(typeof s!=="string"){i.status="error";i.desc="oPostMessageAPIs should contain only string keys"}else if(r===false&&s.indexOf(t)!==0){i.status="error";i.desc="all user custom Message APIs must start with '"+t+"'"}else{Object.keys(n[s]).forEach(function(t){if(t=="inCalls"){n[s].oServiceCalls=n[s][t];delete n[s][t]}else if(t=="outCalls"){Object.keys(n[s][t]).forEach(function(r){n[s][t][r]=e({},u,n[s][t][r])});n[s].oRequestCalls=n[s][t];delete n[s][t]}else{i.status="error";i.desc="api should contain either 'inCalls' or 'outCalls'"}})}});if(i.status==="success"){s(n)}return i}function i(e,t,n,r){var i=new s.Deferred;if(r===undefined){r={}}if(e){sap.ui.require(["sap/ushell/components/applicationIntegration/AppLifeCycle"],function(e){e.postMessageToIframeApp(t,n,r,true).then(function(e){i.resolve(e&&e[0]&&e[0].body.result)})})}else{sap.ui.require(["sap/ushell/appRuntime/ui5/AppRuntimeService"],function(e){e.sendMessageToOuterShell(t+"."+n,r).done(function(e){i.resolve(e)})})}return i.promise()}function u(e){if(e===undefined){e={}}return(new s.Deferred).resolve(e).promise()}return new n});