// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/util/Storage","sap/ushell/utils"],function(t,e,n){"use strict";var s;function i(){return new e(e.Type.local,"com.sap.ushell.adapters.sandbox.Personalization")}function o(t){try{return JSON.parse(t)}catch(t){return undefined}}function r(t){return JSON.stringify(t)}function a(t){if(t===undefined){return undefined}try{return JSON.parse(JSON.stringify(t))}catch(t){return undefined}}var u=function(t,e,i){s=i;this._sContainerKey=t;this._sStorageType=e;this._oItemMap=new n.Map};u.prototype.constants={storage:{MEMORY:"MEMORY",LOCAL_STORAGE:"LOCAL_STORAGE"}};u.prototype.load=function(){var e=new t.Deferred;switch(this._sStorageType){case this.constants.storage.LOCAL_STORAGE:var n=i();setTimeout(function(){var t=n.get(this._sContainerKey);this._oItemMap.entries=o(t)||{};e.resolve(this)}.bind(this),0);break;case this.constants.storage.MEMORY:setTimeout(function(){this._oItemMap.entries=a(s[this._sContainerKey])||{};e.resolve(this)}.bind(this),0);break;default:setTimeout(function(){e.reject("unknown storage type")},0)}return e.promise()};u.prototype.save=function(){var e=new t.Deferred;switch(this._sStorageType){case this.constants.storage.LOCAL_STORAGE:var n=i();setTimeout(function(){var t=r(this._oItemMap.entries);n.put(this._sContainerKey,t);e.resolve()}.bind(this),0);break;case this.constants.storage.MEMORY:setTimeout(function(){s[this._sContainerKey]=a(this._oItemMap.entries);e.resolve()}.bind(this),0);break;default:setTimeout(function(){e.reject("unknown storage type")},0)}return e.promise()};u.prototype.del=function(){var e=new t.Deferred;switch(this._sStorageType){case this.constants.storage.LOCAL_STORAGE:var n=i();setTimeout(function(){n.remove(this._sContainerKey);this._oItemMap.entries={};e.resolve()}.bind(this),0);break;case this.constants.storage.MEMORY:setTimeout(function(){if(s&&s[this._sContainerKey]){delete s[this._sContainerKey]}this._oItemMap.entries={};e.resolve()}.bind(this),0);break;default:setTimeout(function(){e.reject("unknown storage type")},0)}return e.promise()};u.prototype.getItemKeys=function(){return this._oItemMap.keys()};u.prototype.containsItem=function(t){return this._oItemMap.containsKey(t)};u.prototype.getItemValue=function(t){return this._oItemMap.get(t)};u.prototype.setItemValue=function(t,e){this._oItemMap.put(t,e)};u.prototype.delItem=function(t){this._oItemMap.remove(t)};return u},false);