/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/core/date/UI5Date","sap/base/Log","sap/ui/comp/library","sap/m/Dialog","sap/m/MessageBox","sap/m/Token","./ItemsCollection","sap/ui/core/library","sap/m/VBox","sap/m/HBox","sap/m/FlexBox","sap/ui/comp/util/FormatUtil","sap/m/FlexItemData","sap/m/Title","sap/m/Text","sap/m/Label","sap/m/Button","sap/m/Bar","sap/m/OverflowToolbarLayoutData","sap/m/Tokenizer","sap/m/Panel","sap/m/StandardListItem","sap/m/IconTabBar","sap/m/IconTabFilter","sap/m/library","sap/ui/core/InvisibleText","sap/ui/core/InvisibleMessage","sap/ui/core/IconPool","sap/ui/table/library","sap/ui/table/Table","sap/ui/table/Column","sap/m/Table","sap/m/Column","sap/m/table/columnmenu/Menu","sap/ui/layout/HorizontalLayout","sap/ui/layout/Grid","sap/ui/Device","sap/m/List","sap/m/Link","sap/ui/comp/p13n/P13nFilterPanel","sap/m/P13nConditionPanel","sap/m/P13nItem","sap/m/P13nAnyFilterItem","sap/m/CheckBox","sap/ui/comp/p13n/P13nOperationsHelper","sap/ui/core/format/NumberFormat","sap/ui/core/ResizeHandler","sap/base/strings/whitespaceReplacer","sap/ui/table/plugins/MultiSelectionPlugin"],function(e,t,i,s,a,o,n,l,r,h,_,u,d,c,g,p,T,f,b,S,I,y,m,v,C,B,k,R,E,V,L,F,P,x,O,D,A,M,w,N,H,K,z,G,W,U,j,$,q,Z){"use strict";var Q;var J=B.ButtonType;var X=B.OverflowToolbarPriority;var Y=B.ListMode;var ee=B.ListType;var te=r.HorizontalAlign;var ie=r.InvisibleMessageMode;var se=r.TitleLevel;var ae=s.smartfilterbar.DisplayBehaviour;var oe={DESKTOP_LIST_VIEW:"DESKTOP_LIST_VIEW",DESKTOP_CONDITIONS_VIEW:"DESKTOP_CONDITIONS_VIEW",PHONE_MAIN_VIEW:"PHONE_MAIN_VIEW",PHONE_SEARCH_VIEW:"PHONE_SEARCH_VIEW",PHONE_LIST_VIEW:"PHONE_LIST_VIEW",PHONE_CONDITIONS_VIEW:"PHONE_CONDITIONS_VIEW"};var ne=a.extend("sap.ui.comp.valuehelpdialog.ValueHelpDialog",{metadata:{library:"sap.ui.comp",properties:{basicSearchText:{type:"string",group:"Misc",defaultValue:""},supportMultiselect:{type:"boolean",group:"Misc",defaultValue:true},supportRanges:{type:"boolean",group:"Misc",defaultValue:false},supportRangesOnly:{type:"boolean",group:"Misc",defaultValue:false},key:{type:"string",group:"Misc",defaultValue:""},keys:{type:"string[]",group:"Misc",defaultValue:null},descriptionKey:{type:"string",group:"Misc",defaultValue:""},maxIncludeRanges:{type:"string",group:"Misc",defaultValue:"-1"},maxExcludeRanges:{type:"string",group:"Misc",defaultValue:"-1"},maxConditions:{type:"string",group:"Misc",defaultValue:"-1"},displayFormat:{type:"string",group:"Misc",defaultValue:""},tokenDisplayBehaviour:{type:"string",group:"Misc",defaultValue:""},filterMode:{type:"boolean",group:"Misc",defaultValue:false},_enhancedExcludeOperations:{type:"boolean",group:"Misc",defaultValue:false,visibility:"hidden"},conditionPanelDefaultOperation:{type:"string",group:"Misc",defaultValue:null},enabledMultiSelectionPlugin:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{filterBar:{type:"sap.ui.comp.filterbar.FilterBar",multiple:false}},events:{ok:{parameters:{tokens:{type:"sap.m.Token[]"}}},cancel:{},selectionChange:{parameters:{tableSelectionParams:{type:"object"},updateTokens:{type:"object[]"},useDefault:{type:"boolean"},table:{type:"object"}}},tokenRemove:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean"}}},updateSelection:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean"}}}}},renderer:{apiVersion:2}});ne.prototype.setSupportMultiselect=function(e){this.setProperty("supportMultiselect",e);this._updatePropertySupportMultiselect(e);this._oTokenizerGrid.setVisible(e);this._oButtonOk.setVisible(e);return this};ne.prototype._updatePropertySupportMultiselect=function(e){if(!this._oTable){return undefined}if(!this._isPhone()){if(this._oTable.setSelectionMode){this._oTable.setSelectionMode(e?V.SelectionMode.MultiToggle:V.SelectionMode.Single)}}else if(this._oTable.setMode){this._oTable.setMode(e?Y.MultiSelect:Y.SingleSelectLeft)}return this};ne.prototype.setSupportRanges=function(e){this.setProperty("supportRanges",e);this._updateNavigationControl();return this};ne.prototype.setSupportRangesOnly=function(e){this.setProperty("supportRangesOnly",e);this._updateNavigationControl();return this};ne.prototype.setTitle=function(e){this.setProperty("title",e);this._updateDlgTitle();return this};ne.prototype.setFilterBar=function(e){this.setAggregation("filterBar",e);if(this._oMainLayout&&e){if(this._isPhone()){if(this._oFilterBar){this._oContentContainer.removeItem(this._oFilterBar);this._oFilterBar.detachInitialise(this._handleFilterBarInitialize)}}else if(this._oFilterBar){this._oMainLayout.removeItem(this._oFilterBar);this._oFilterBar.detachInitialise(this._handleFilterBarInitialize)}this._oFilterBar=e;this._oFilterBar.attachInitialise(this._handleFilterBarInitialize,this);if(this._oFilterBar){this._oFilterBar.addStyleClass("compVHSearch");if(this._isPhone()){var t=sap.ui.getCore().byId(this._oFilterBar.getBasicSearch());if(t&&t.isA("sap.m.SearchField")){t.setShowSearchButton(true);t.attachSearch(function(e){if(e.mParameters.refreshButtonPressed!==undefined){this.getFilterBar().search()}}.bind(this))}this._oFilterBar.setShowGoOnFB(false);this._oColSearchBox.setLayoutData(new c({shrinkFactor:0}));this._oContentContainer.insertItem(this._oColSearchBox,0);this._oFilterBar.setLayoutData(new c({shrinkFactor:0}));this._oContentContainer.insertItem(this._oFilterBar,1);this._oFilterBar.attachSearch(function(e){this._updateView(oe.PHONE_LIST_VIEW)}.bind(this));if(this._currentViewMode===oe.PHONE_LIST_VIEW){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false);this._handleFilterBarInitialize()}}else{this._oFilterBar._setCollectiveSearch(this._oColSearchBox);this._oMainLayout.insertItem(this._oFilterBar,0)}}if(he(this._oTabBar)){this.setInitialFocus(this._oTabBar.getItems()[0])}else if(this._oFilterBar._oSearchButton){this.setInitialFocus(this._oFilterBar._oSearchButton)}if(this._oFilterBar._oBasicSearchField){var i=this._oFilterBar._oBasicSearchField;i.setValue(this.getBasicSearchText());if(!he(this._oTabBar)){this.setInitialFocus(i)}}}return this};ne.prototype._handleFilterBarInitialize=function(){if(this._currentViewMode===oe.PHONE_LIST_VIEW){this._oFilterBar._handleVisibilityOfToolbar();var e=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(e);this._oFilterBar.setShowGoOnFB(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()))}this._setToolbarSpacerWidth();if(he(this._oTabBar)){this.setInitialFocus(this._oTabBar.getItems()[0])}else if(this._oFilterBar&&this._oFilterBar._oBasicSearchField){this.setInitialFocus(this._oFilterBar._oBasicSearchField)}};ne.prototype.getFilterBar=function(){return this._oFilterBar};ne.prototype.setBasicSearchText=function(e){this.setProperty("basicSearchText",e);if(this._oFilterBar&&this._oFilterBar._oBasicSearchField){this._oFilterBar._oBasicSearchField.setValue(e)}return this};ne.prototype.setTokens=function(e){var t=true;if(e.length){var i=0,s;for(var a=0;a<e.length;a++){var o=e[a];if(o.data("range")){var l=Object.assign({},o.data("range"));s=o.getKey();if(!s){do{s="range_"+i;i++}while(this._oSelectedRanges[s])}var r=this._getFormatedRangeTokenText(l.operation,l.value1,l.value2,l.exclude,l.keyField);this._addToken2Tokenizer(s,r,this._getTokenizer(),l.keyField);this._oSelectedRanges[s]=l;t=false}else{s=o.getKey();var h=o.getText();var _=o.data("longKey");var u=o.data("row");if(!_){_=s}this._oSelectedItems.add(_,u?u:o.getText());var d=new n(re.call(this,_));d.setKey(_);d.setText(h);d.setTooltip(h);this._getTokenizer().addToken(d)}}}else{this._oSelectedItems.removeAll();this._oSelectedRanges={};this._getTokenizer().destroyTokens()}if(t){this._updateTokenizer()}};ne.prototype.open=function(){var e,t,i,s,o;if(!this._oTable&&!(this._isPhone()&&(this.getSupportRangesOnly()||this.getFilterMode()))){return le.call(this).then(function(){return this.open()}.bind(this))}this._bIgnoreSelectionChange=false;if(this._oColSearchBox){this._bIsMdcCollectiveSearch=this._oColSearchBox.isA("sap.ui.mdc.filterbar.vh.CollectiveSearchSelect");if(this._bIsMdcCollectiveSearch){this.bCollectiveSearchActive=this._oColSearchBox.getVisible()}else{this.bCollectiveSearchActive=this.oSelectionTitle.getVisible()&&this.oSelectionButton.getVisible();this._oColSearchBox.setVisible(this.bCollectiveSearchActive)}}if(!this._isPhone()){if(this.getSupportRangesOnly()||this.getFilterMode()){this._updateView(oe.DESKTOP_CONDITIONS_VIEW)}if(this.isPropertyInitial("contentWidth")){this.setContentWidth(this._getDefaultContentWidth())}}else{this._updateView(oe.PHONE_MAIN_VIEW)}a.prototype.open.apply(this);if(he(this._oTabBar)){this.setInitialFocus(this._oTabBar.getItems()[0])}else if(this._oFilterBar&&this._oFilterBar._oBasicSearchField){this.setInitialFocus(this._oFilterBar._oBasicSearchField)}else if(!this._oFilterBar&&this._currentViewMode==="DESKTOP_CONDITIONS_VIEW"){if(this._oFilterPanel){e=this._oFilterPanel&&this._oFilterPanel._oConditionPanel;t=e&&e._oConditionsGrid;i=t&&t.getAggregation("content")[0];s=t&&i.operation;if(s&&s.getEnabled()){this.setInitialFocus(s)}else{o=i.value1;this.setInitialFocus(o)}}}return this};ne.prototype.getTable=function(){i.warning("Please use getTableAsync to prevent synchronous calls.",this);if(!this._oTable){this._createDefaultTable()}return this._oTable};ne.prototype.getTableAsync=function(){if(this._oTablePromise){return this._oTablePromise}else if(!this._oTable){return le.call(this)}else{return new Promise(function(e){e(this._oTable)}.bind(this))}};ne.prototype._handleSmartTable=function(e){e.attachBeforeRebindTable(function(){var t=e.getTable();if(t&&t.isA("sap.ui.table.Table")){t.attachEventOnce("rowsUpdated",this._updateTableTitle.bind(this))}}.bind(this))};ne.prototype.setTable=function(e){if(this._oTable){this._oMainLayout.removeItem(this._oTable);if(this._bTableCreatedInternal){this._oTable.destroy();this._oTable=null}}this._bTableCreatedInternal=arguments.length>1&&arguments[1]==true;if(e&&e.isA("sap.ui.comp.smarttable.SmartTable")){this._oTable=e.getTable();this._handleSmartTable(e)}else{this._oTable=e}if(this._oTable&&this._oTable.isA("sap.ui.table.Table")){this._oTable.setEnableBusyIndicator(true);if(this._oTable.isA("sap.ui.table.AnalyticalTable")){Q=sap.ui.require("sap/ui/table/AnalyticalColumn")}}this._oTable.setLayoutData(new c({shrinkFactor:0,growFactor:1}));this.theTable=this._oTable;this._initializeTable();this._oMainLayout.addItem(e)};ne.prototype._getDefaultContentWidth=function(){var e;if(M.system.desktop){e=1080}else if(M.system.tablet){if(M.orientation.landscape){e=920}else if(M.orientation.portrait){e=600}}return e+"px"};ne.prototype.resetTableState=function(){if(this._oTable){if(this._oTable.unbindRows){this._oTable.unbindRows()}this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"))}};ne.prototype.TableStateSearchData=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"))};ne.prototype._updateNoDataText=function(e){if(this._oTable){if(this._oTable.setNoData){this._oTable.setNoData(e)}else if(this._oTable.setNoDataText){this._oTable.setNoDataText(e)}}};ne.prototype.TableStateDataFilled=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_NODATA"))};ne.prototype.TableStateDataSearching=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_SEARCHING"))};ne.prototype.init=function(){a.prototype.init.apply(this);this._oTokenIdCount={};this._bTableCreatedInternal=false;this._aIncludeRangeOperations={};this._aExcludeRangeOperations={};this._bInitTokensHaveChanged;this.setStretch(this._isPhone());this.setResizable(!this._isPhone());this.setDraggable(!this._isPhone());this.bCollectiveSearchActive=false;this.addStyleClass("compValueHelpDialog");this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this._sTableTitle1=this._oRb.getText("VALUEHELPDLG_TABLETITLE1");this._sTableTitle2=this._oRb.getText("VALUEHELPDLG_TABLETITLE2");this._sTableTitleNoCount=this._oRb.getText("VALUEHELPDLG_TABLETITLENOCOUNT");this._currentViewMode=null;this._oSelectedItems=new l;this._oSelectedRanges={};this._oOperationsHelper=new U;this._fnRejectTablePromise;this._createHeaderBar();this._createCollectiveSearch();this._createTokenizer();this._updateTokenizer();this._oNavigationContainer=new h(this.getId()+"-navigationContainer",{width:"100%",layoutData:new c({growFactor:0,shrinkFactor:0})});this._oContentContainer=new h(this.getId()+"-vbox",{width:"100%",height:"100%"}).addStyleClass("compVHContentContainerVbox");this._oContainersWrapper=new u(this.getId()+"-containersWrapper",{alignItems:"Start",height:"100%",width:"100%",direction:"Column",justifyContent:"SpaceBetween",items:[this._oNavigationContainer,this._oContentContainer]});this.addContent(this._oContainersWrapper);this._oMainLayout=new h(this.getId()+"-mainLayout",{fitContainer:true,items:[this._oFilterBar],layoutData:new c({growFactor:1,shrinkFactor:0,styleClass:"mainLayout"})});this._createNavigationControl();this._updateNavigationControl();this._oContentContainer.addItem(this._oMainLayout);if(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode()){this._oContentContainer.addItem(this._oTokenizerGrid)}this._createFooterControls();this.setVerticalScrolling(false);this.setHorizontalScrolling(false);if(!M.system.desktop){this._oContentContainer.attachBrowserEvent("touchmove",function(e){e.setMarked()})}if(!this._isPhone()){this._updateView(oe.DESKTOP_LIST_VIEW)}if(!this._oInvisibleMessage){this._oInvisibleMessage=R.getInstance()}};ne.prototype._updateView=function(e){if(this._currentViewMode===e){return}switch(e){case oe.DESKTOP_LIST_VIEW:this._validateRanges(function(){this._oTokenizerGrid.setVisible(this.getSupportMultiselect());this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==oe.DESKTOP_LIST_VIEW){this._oTabBar.setSelectedKey(oe.DESKTOP_LIST_VIEW)}this._oMainLayout.addItem(this._oFilterBar);this._oMainLayout.addItem(this._oTable);this._updateDlgTitle()}.bind(this),function(){this._oTabBar.setSelectedKey(oe.DESKTOP_CONDITIONS_VIEW);this._updateView(oe.DESKTOP_CONDITIONS_VIEW)}.bind(this));break;case oe.DESKTOP_CONDITIONS_VIEW:if(this.getSupportRanges()){this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==oe.DESKTOP_CONDITIONS_VIEW){this._oTabBar.setSelectedKey(oe.DESKTOP_CONDITIONS_VIEW)}this._createAddRanges();this._oButtonOk.setVisible(this.getSupportRangesOnly()||this.getSupportMultiselect());this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false)}}break;case oe.PHONE_MAIN_VIEW:this.setVerticalScrolling(false);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(true);this._updateNavigationControl();this._oAdvancedSearchLink.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(false);this._oFilterBar.setFilterBarExpanded(false)}if(this._oTable){this._oTable.setVisible(false)}this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false)}if(this._oRanges){this._oRanges.setVisible(false)}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(false);this._bNoneMainView=false;if(!(this._oSelectItemLI.getVisible()&&this._oDefineConditionsLI.getVisible())){this._bNoneMainView=true;if(this._oSelectItemLI.getVisible()){this._updateView(oe.PHONE_LIST_VIEW)}if(this._oDefineConditionsLI.getVisible()){this._updateView(oe.PHONE_CONDITIONS_VIEW)}return}break;case oe.PHONE_LIST_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(this.bCollectiveSearchActive);if(this._bIsMdcCollectiveSearch){this._oColSearchBox.addStyleClass("sapUiTinyMarginBegin");this._oColSearchBox.oVariantText.removeStyleClass("sapUiMdcCollectiveSearchSelectTextPhoneMaxWidth")}this._oMainListMenu.setVisible(false);if(this._oFilterBar){var t=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(t);this._oFilterBar.setShowGoOnFB(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()));this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false)}if(this._oTable){this._oTable.setVisible(true)}this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false)}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(this.getSupportMultiselect());this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;case oe.PHONE_SEARCH_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(true)}this._oAdvancedSearchLink.setVisible(false);if(this._oTable){this._oTable.setVisible(false)}this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false)}this._oButtonGo.setVisible(true);this._oButtonClear.setVisible(this._oFilterBar&&this._oFilterBar.getShowClearOnFB());this._oButtonOk.setVisible(false);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(true);break;case oe.PHONE_CONDITIONS_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(false)}this._oAdvancedSearchLink.setVisible(false);if(this._oTable){this._oTable.setVisible(false)}this._oTokenizerGrid.setVisible(false);if(!this._oRanges){this._createAddRanges()}if(this._oRanges){this._oRanges.setVisible(true)}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;default:break}if(this._oMainListMenu&&this._oContentContainer){if(this._oFilterBar){this._oFilterBar._handleVisibilityOfToolbar()}(function(){this._oContentContainer.rerender()}).bind(this)()}this._currentViewMode=e;this._updateDlgTitle()};ne.prototype._changeTableRowSelectionForKey=function(e,t){var i;var s=this._oTable;var a=s;if(this._isMultiSelectionPluginAvailable()){a=s._getSelectionPlugin()}this._bIgnoreSelectionChange=true;if(s&&s.isA("sap.ui.table.Table")){var o=s.getBinding("rows");if(o){if(o.aKeys){for(i=0;i<o.aKeys.length;i++){if(decodeURIComponent(o.aKeys[i])===e){if(t){a.addSelectionInterval(i,i)}else{a.removeSelectionInterval(i,i)}break}}}else{this.oRows=s.getBinding("rows");if(this.oRows.aIndices){for(i=0;i<this.oRows.aIndices.length;i++){var n=s.getContextByIndex(this.oRows.aIndices[i]);if(n){var l=n.getObject();if(l[this.getKey()]===e){if(t){a.addSelectionInterval(i,i)}else{a.removeSelectionInterval(i,i)}break}}}}}}}else{for(i=0;i<s.getItems().length;i++){var r=s.getItems()[i];var h=r.getBindingContext().getObject();if(h[this.getKey()]===e){s.setSelectedItem(r,t);break}}}this._bIgnoreSelectionChange=false};ne.prototype.update=function(){if(!this.getEnabledMultiSelectionPlugin()){return this._updateSync()}else{return this._updateAsync()}};ne.prototype._updateSync=function(){var e,t,i,s;var a;var o=this._oSelectedItems.getItems();var n={tokenKeys:o,useDefault:false};var l;if(this._oTable){l=this._oTable;if(this._isMultiSelectionPluginAvailable()){l=this._oTable._getSelectionPlugin()}}this._bIgnoreSelectionChange=true;if(this._hasListeners("updateSelection")){this.fireUpdateSelection(n)}else{n.useDefault=true}if(n.useDefault){if(this._oTable&&this._oTable.isA("sap.ui.table.Table")){this.oRows=this._oTable.getBinding("rows");l.clearSelection();if(this.oRows&&this.oRows.aKeys){var r=this.getKeys();var h=r&&r.length>1?this.getKey()+"=":"";for(t=0;t<o.length;t++){a=o[t];var _=h+"'"+a+"'";for(e=0;e<this.oRows.aKeys.length;e++){var u=this.oRows.aKeys[e];if(u===undefined){continue}u=decodeURIComponent(u);var d=u===a;if(d||u.indexOf(_)>=0){if(!d){this._oSelectedItems.remove(a);var c=this._getTokenByKey(a,this._getTokenizer());if(c){c.setKey(u)}}s=this._oTable.getContextByIndex(e);if(s){i=s.getObject();this._oSelectedItems.add(u,i)}l.addSelectionInterval(e,e);break}}}}else if(this.oRows&&this.oRows.aIndices){l.clearSelection();var g=this._oTable.getBinding("rows").getContexts();for(t=0;t<o.length;t++){var p=o[t];for(e=0;e<this.oRows.aIndices.length;e++){s=g[e];if(s){i=s.getObject();if(i[this.getKey()]===p){this._oSelectedItems.add(i[this.getKey()],i);l.addSelectionInterval(e,e);break}}}}}}else{var T=this._oTable;for(t=0;t<o.length;t++){a=o[t];for(e=0;e<T.getItems().length;e++){var f=T.getItems()[e];var b=f.getBindingContext().getObject();if(b[this.getKey()]===a){T.setSelectedItem(f,true);break}}}}}this._bIgnoreSelectionChange=false;if(this._bTriggerInvisibleTableCountMessageNotInitialLoad){this._bTriggerInvisibleTableCountMessage=true}this._updateTitles();this._bTriggerInvisibleTableCountMessageNotInitialLoad=true};ne.prototype._updateAsync=function(){var e,t,i,s;var a;var o=this._oSelectedItems.getItems();var n={tokenKeys:o,useDefault:false};var l=[],r;if(this._oTable){r=this._oTable;if(this._isMultiSelectionPluginAvailable()){r=this._oTable._getSelectionPlugin()}}this._bIgnoreSelectionChange=true;if(this._hasListeners("updateSelection")){this.fireUpdateSelection(n)}else{n.useDefault=true}if(n.useDefault){if(this._oTable&&this._oTable.isA("sap.ui.table.Table")){this.oRows=this._oTable.getBinding("rows");r.clearSelection();if(this.oRows&&this.oRows.aKeys){var h=this.getKeys();var _=h&&h.length>1?this.getKey()+"=":"";for(t=0;t<o.length;t++){a=o[t];var u=_+"'"+a+"'";for(e=0;e<this.oRows.aKeys.length;e++){var d=this.oRows.aKeys[e];if(d===undefined){continue}d=decodeURIComponent(d);var c=d===a;if(c||d.indexOf(u)>=0){if(!c){this._oSelectedItems.remove(a);var g=this._getTokenByKey(a,this._getTokenizer());if(g){g.setKey(d)}}s=this._oTable.getContextByIndex(e);if(s){i=s.getObject();this._oSelectedItems.add(d,i)}l.push(r.addSelectionInterval(e,e));break}}}}else if(this.oRows&&this.oRows.aIndices){r.clearSelection();var p=this._oTable.getBinding("rows").getContexts();for(t=0;t<o.length;t++){var T=o[t];for(e=0;e<this.oRows.aIndices.length;e++){s=p[e];if(s){i=s.getObject();if(i[this.getKey()]===T){this._oSelectedItems.add(i[this.getKey()],i);r.addSelectionInterval(e,e);break}}}}}}else{var f=this._oTable;for(t=0;t<o.length;t++){a=o[t];for(e=0;e<f.getItems().length;e++){var b=f.getItems()[e];var S=b.getBindingContext().getObject();if(S[this.getKey()]===a){f.setSelectedItem(b,true);break}}}}}return Promise.all(l).then(function(){this._bIgnoreSelectionChange=false;if(this._bTriggerInvisibleTableCountMessageNotInitialLoad){this._bTriggerInvisibleTableCountMessage=true}this._updateTitles();this._bTriggerInvisibleTableCountMessageNotInitialLoad=true}.bind(this))};ne.prototype._createHeaderBar=function(){this._oTitle=new g(this.getId()+"-title",{level:se.H1});var e=null;if(this._isPhone()){e=new f(this.getId()+"-back",{visible:false,type:J.Back,press:function(e){if(this._currentViewMode===oe.PHONE_SEARCH_VIEW){this._updateView(oe.PHONE_LIST_VIEW)}else{this._updateView(oe.PHONE_MAIN_VIEW)}}.bind(this)});this._oBackButton=e}this._oTitle.addStyleClass("sapUiSmallMarginBeginEnd");var t=new b(this.getId()+"-header",{contentLeft:[e,this._oTitle],design:"Header"});this.setCustomHeader(t);this.getCustomHeader().addStyleClass("sapContrastPlus")};ne.prototype._createCollectiveSearch=function(){this.oSelectionTitle=new p(this.getId()+"-selTitle",{visible:false,wrapping:false}).addStyleClass("compVHColSearchText");if(M.system.tablet&&!M.system.desktop){this.oSelectionTitle.addStyleClass("compVHColSearchTextTabletMaxWidth")}else{this.oSelectionTitle.addStyleClass("compVHColSearchTextMaxWidth")}this.oSelectionButton=new f(this.getId()+"-selButton",{icon:"sap-icon://slim-arrow-down",tooltip:this._oRb.getText("VALUEHELPVALDLG_SEARCHTEMPLATES_TOOLTIP"),type:J.Transparent,visible:false,ariaLabelledBy:this.oSelectionTitle}).addStyleClass("compVHColSearchBtn");this._oColSearchBox=new _(this.getId()+"-selBox",{fitContainer:true,visible:this.oSelectionButton.getVisible(),items:[this.oSelectionTitle,this.oSelectionButton]}).addStyleClass("compVHColSearchVBox")};ne.prototype._createFooterControls=function(){this._oButtonOk=new f(this.getId()+"-ok",{text:this._oRb.getText("VALUEHELPDLG_OK"),press:this._onCloseAndTakeOverValues.bind(this),visible:this.getSupportMultiselect(),type:J.Emphasized,layoutData:new S({priority:X.NeverOverflow})});this._oButtonCancel=new f(this.getId()+"-cancel",{text:this._oRb.getText("VALUEHELPDLG_CANCEL"),press:this._onCancel.bind(this),layoutData:new S({priority:X.NeverOverflow})});this._oButtonOk.setWidth(this._oButtonCancel.getWidth());if(this._isPhone()){this._oButtonGo=new f(this.getId()+"-go",{text:this._oRb.getText("VALUEHELPDLG_GO"),type:J.Emphasized,press:this._onGo.bind(this),visible:false,layoutData:new S({priority:X.NeverOverflow})});this._oButtonClear=new f(this.getId()+"-clear",{text:this._oRb.getText("VALUEHELPDLG_CLEAR"),press:this._onClear.bind(this),visible:false,layoutData:new S({priority:X.NeverOverflow})});this.addButton(this._oButtonGo);this.addButton(this._oButtonClear)}this.addButton(this._oButtonOk);this.addButton(this._oButtonCancel)};ne.prototype._handleTokenUpdateOrDelete=function(e){var t,i=[],s=[],a,o,n,l,r;if(this._ignoreRemoveToken){return}if(e.getParameter("type")===I.TokenChangeType.Removed){t=e.getParameter("removedTokens")}else if(e.getParameter("tokens")){t=e.getParameter("tokens")}for(l=0;l<t.length;l++){a=t[l];o=a.getKey();if(this._oSelectedRanges&&this._oSelectedRanges[o]){s.push(o);this._removeToken(o)}else{i.push(o);this._oSelectedItems.remove(o);this._removeTokenFromTokenizer(o,this._getTokenizer())}}this._removeRangeByKey(s);r={tokenKeys:i,useDefault:false};if(this._hasListeners("tokenRemove")){this._bIgnoreSelectionChange=true;this.fireTokenRemove(r);this._bIgnoreSelectionChange=false}else{r.useDefault=true}if(r.useDefault){i.forEach(function(e){this._changeTableRowSelectionForKey(e,false)}.bind(this))}if(t.length===1){setTimeout(function(){var e=this._getTokenizer().getTokens();if(e){n=e.length-1;if(n>=0){e[n].focus()}else{this._manageFocusAfterRemoveTokens()}}}.bind(this))}this._updateTitles()};ne.prototype._createTokenizer=function(){if(this._oTokenizerGrid){return this._oTokenizerGrid}this._oSelectedTokenTitle=new k(this.getId()+"-selectedTokenTitle");this._oSelectedTokens=new I(this.getId()+"-selectedTokens",{ariaLabelledBy:this._oSelectedTokenTitle}).addStyleClass("compVHTokensDiv");(function(){this._oSelectedTokens.attachTokenUpdate(this._handleTokenUpdateOrDelete,this)}).bind(this)();this._oSelectedTokens.attachTokenDelete(this._handleTokenUpdateOrDelete,this);if(e.getConfiguration().getAccessibility()){this._oSelectedTokens.addAriaDescribedBy(this._oSelectedTokens.getTokensInfoId())}this._oRemoveAllSelectedItemsBtn=new f(this.getId()+"-removeSelItems",{type:J.Transparent,icon:E.getIconURI("decline"),tooltip:this._oRb.getText("VALUEHELPVALDLG_REMOVETOKENS_TOOLTIP"),press:function(){var e=[],t=[],i;this._getTokenizer().destroyTokens();e=Object.keys(this._oSelectedItems["items"]);t=Object.keys(this._oSelectedRanges);this._removeRangeByKey(Object.keys(this._oSelectedRanges));this._oSelectedItems.removeAll();this._bIgnoreSelectionChange=true;if(this._oTable&&this._oTable.clearSelection){if(this._oTable._getSelectionPlugin&&this._oTable.data("isInternal")){this._oTable._getSelectionPlugin().clearSelection()}else{this._oTable.clearSelection()}}if(this._oTable&&this._oTable.removeSelections){this._oTable.removeSelections()}this._bIgnoreSelectionChange=false;this._updateTitles();this._manageFocusAfterRemoveTokens();if(e.length>0||t.length>0){i={tokenKeys:e.concat(t),useDefault:false};this.fireTokenRemove(i)}}.bind(this),ariaDescribedBy:this._oSelectedTokenTitle}).addStyleClass("compVHRemoveAllBtn");var t=new D(this.getId()+"-selItemsBox",{content:[this._getTokenizer(),this._oRemoveAllSelectedItemsBtn]}).addStyleClass("compVHTokenizerHLayout");this._oIncludeTokenGrid=new A(this.getId()+"-selItemsGrid",{width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oSelectedTokenTitle,t]}).addStyleClass("sapUiRespGridOverflowHidden");this._oTokenizerPanel=new y(this.getId()+"-tokenPanel",{expanded:M.system.desktop,expandable:false,expandAnimation:true,headerText:"",width:"auto",content:[this._oIncludeTokenGrid],expand:function(e){this._updateTokenizer();if(e.mParameters.expand&&this._oTable&&!this._oTable.isA("sap.m.Table")){var t=window.document.getElementById(this.getId()+"-scrollCont");if(t&&t.scrollTop){t.stop().animate({scrollTop:"1000"},1e3)}}}.bind(this)}).addStyleClass("compVHBackgroundTransparent").addStyleClass("compVHTokensPanel").addStyleClass("compValueHelpDialogTokens");if(this._isPhone()){this._getTokenizer().addStyleClass("sapMTokenizerMultiLine")}this._oTokenizerGrid=new A(this.getId()+"-tokenizerGrid",{width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:this._oTokenizerPanel}).addStyleClass("compVHDBackground").addStyleClass("sapUiRespGridOverflowHidden");return this._oTokenizerGrid};ne.prototype._addToken2Tokenizer=function(e,t,i,s){var a=typeof t==="string"?t:"";var o=this._getTokenByKey(e,i);t=q(t);if(!o){o=new n(re.call(this,e,s));o.setKey(e);i.addToken(o);this._updateTokenizer()}if(o){o.setText(t);o.setTooltip(a)}};ne.prototype._getTokenByKey=function(e,t){var i=t.getTokens();for(var s=0;s<i.length;s++){var a=i[s];if(a.getKey()===e){return a}}return null};ne.prototype._removeToken=function(e){this._removeTokenFromTokenizer(e,this._getTokenizer())};ne.prototype._removeTokenFromTokenizer=function(e,t){var i=this._getTokenByKey(e,t);if(i){this._ignoreRemoveToken=true;t.removeToken(i);i.destroy();this._ignoreRemoveToken=false;this._updateTokenizer();return true}return false};ne.prototype._updateTokenizer=function(){this._bInitTokensHaveChanged=true;var e=false;if(this._oTokenizerPanel){e=this._oTokenizerPanel.getExpanded()}var t=this._getTokenizer().getTokens().length;var i=this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS_CONDITIONS");var s=this._oRb.getText("VALUEHELPDLG_NONESELECTEDITEMS_CONDITIONS");var a=i.replace("{0}",t.toString());var o=t===0?s:a;if(this._oTokenizerPanel){if(!e){o="";if(t!==0){o=a}if(o===""){o=s}}this._oTokenizerPanel.setHeaderText(o);this._oSelectedTokenTitle.setText(o)}else{this._oSelectedTokenTitle.setText(o)}this._oRemoveAllSelectedItemsBtn.setEnabled(t!==0);this._oIncludeTokenGrid.removeStyleClass("displayNone")};ne.prototype._createNavigationControl=function(){if(!this._isPhone()){this._oTabBar=new v(this.getId()+"-navigation",{expandable:false,items:[new C(this.getId()+"-itemstable",{visible:true,text:this._getTabSearchAndSelectText(),key:oe.DESKTOP_LIST_VIEW}),new C(this.getId()+"-ranges",{visible:true,text:this._getTabRangesText(),key:oe.DESKTOP_CONDITIONS_VIEW})],select:function(e){this._updateView(e.getParameters().key)}.bind(this)});this._oTabBar.setLayoutData(new c({shrinkFactor:0}));this._oNavigationContainer.addItem(this._oTabBar)}else{this._oSelectItemLI=new m(this.getId()+"-itemstable",{type:ee.Navigation,title:this._getTabSearchAndSelectText()}).data("key",oe.PHONE_LIST_VIEW);this._oDefineConditionsLI=new m(this.getId()+"-ranges",{type:ee.Navigation,title:this._getTabRangesText()}).data("key",oe.PHONE_CONDITIONS_VIEW);this._oMainListMenu=new w(this.getId()+"-navigation",{mode:Y.None,items:[this._oSelectItemLI,this._oDefineConditionsLI],itemPress:function(e){if(e){this._updateView(e.mParameters.listItem.data("key"))}}.bind(this)});this._oMainListMenu.setLayoutData(new c({shrinkFactor:0}));this._oContentContainer.addItem(this._oMainListMenu);this._oAdvancedSearchLink=new N(this.getId()+"-advancedSearchLink",{text:this._oRb.getText("FILTER_BAR_ADV_FILTERS_DIALOG"),press:function(){this._updateView(oe.PHONE_SEARCH_VIEW)}.bind(this)}).addStyleClass("compVHAdvancedSearchLink");this._oAdvancedSearchLink.setLayoutData(new c({shrinkFactor:0,alignSelf:"End"}));this._oContentContainer.addItem(this._oAdvancedSearchLink)}};ne.prototype._updateNavigationControl=function(){var e=!this.getSupportRangesOnly();var t=this.getSupportRangesOnly()||this.getSupportRanges();if(this._oTabBar){var i=this._oTabBar.getItems();i[0].setVisible(e);i[1].setVisible(t);this._oTabBar.setVisible(e&&t);this._updateDlgTitle()}if(this._oMainListMenu){this._oSelectItemLI.setVisible(e);this._oDefineConditionsLI.setVisible(t)}};ne.prototype._removeRangeByKey=function(e){var t=e;if(typeof t==="string"){t=[t]}t.forEach(function(e,t,i){var s=this._oSelectedRanges[e];if(!s._oGrid){delete this._oSelectedRanges[e];if(this._oFilterPanel){var a=this._oFilterPanel.getConditionPanel();if(i.length==1){a.removeCondition(e)}else{a._removeConditionFromMap(e)}}}},this);if(t.length>1&&this._oFilterPanel){var i=this._oFilterPanel.getConditionPanel();i._clearConditions();i._fillConditions()}};ne.prototype._createAddRanges=function(){if(!this._oRanges){if(!sap.ui.require("sap/m/P13nFilterPanel")){sap.ui.require(["sap/m/P13nFilterPanel"],function(){this._oRanges=this._createRanges();this._oMainLayout.addItem(this._oRanges)}.bind(this))}else{this._oRanges=this._createRanges();this._oMainLayout.addItem(this._oRanges)}}else{this._oMainLayout.addItem(this._oRanges)}};ne.prototype._createRanges=function(){var e,t;this._oFilterPanel=new H(this.getId()+"-filterPanel",{maxConditions:this.getMaxConditions(),maxIncludes:this.getMaxIncludeRanges(),maxExcludes:this.getMaxExcludeRanges(),containerQuery:true,enableEmptyOperations:true,defaultOperation:this.getConditionPanelDefaultOperation(),filterItemChanged:function(e){var t=e.getParameter("reason");var i=e.getParameter("key");var s=e.getParameter("itemData");if(s&&t==="added"){var a={exclude:s.exclude,keyField:s.columnKey,operation:s.operation,value1:s.value1,value2:s.value2};this._oSelectedRanges[i]=a;var o=new G({key:i,exclude:s.exclude,columnKey:s.columnKey,operation:s.operation});o.setValue1(s.value1);o.setValue2(s.value2);this._oFilterPanel.addFilterItem(o);var n=this._getFormatedRangeTokenText(a.operation,a.value1,a.value2,a.exclude,a.keyField);this._addToken2Tokenizer(i,n,this._getTokenizer(),a.keyField);this._updateTokenizer()}if(s&&t==="updated"){var a=this._oSelectedRanges[i];a.exclude=s.exclude;a.keyField=s.columnKey;a.operation=s.operation;a.value1=s.value1;a.value2=s.value2;var n=this._getFormatedRangeTokenText(a.operation,a.value1,a.value2,a.exclude,a.keyField);this._addToken2Tokenizer(i,n,this._getTokenizer(),a.keyField);this._updateTokenizer()}if(t==="removed"){delete this._oSelectedRanges[i];this._removeToken(i);this._updateTokenizer()}this._updateTabRangesTitle()}.bind(this)});this._oFilterPanel.bIsSingleIntervalRange=this.bIsSingleIntervalRange;if(this.getProperty("_enhancedExcludeOperations")){this._oFilterPanel._enableEnhancedExcludeOperations()}t=this._oFilterPanel.getConditionPanel();t.setDisplayFormat(this.getDisplayFormat());this._oFilterPanel.setSuggestCallback(this._fSuggestCallback);t._sAddRemoveIconTooltipKey="CONDITION";if(this._aIncludeRangeOperations){for(e in this._aIncludeRangeOperations){this._oFilterPanel.setEnableEmptyOperations(false);this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[e],e)}}if(this._aExcludeRangeOperations){for(e in this._aExcludeRangeOperations){this._oFilterPanel.setEnableEmptyOperations(false);this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[e],e)}}if(this._aRangeKeyFields){this._aRangeKeyFields.forEach(function(e){this._oFilterPanel.addItem(new z({columnKey:e.key,text:e.label,typeInstance:e.typeInstance,type:e.type,maxLength:e.maxLength,formatSettings:e.formatSettings,scale:e.scale,precision:e.precision,isDefault:e.isDefault,values:null,nullable:e.nullable!=="false"}))},this)}if(this._oSelectedRanges){for(var i in this._oSelectedRanges){var s=this._oSelectedRanges[i];var a=new G({key:i,exclude:s.exclude,columnKey:s.keyField,operation:s.operation});a.setValue1(s.value1);a.setValue2(s.value2);this._oFilterPanel.addFilterItem(a)}}var o=new A(this.getId()+"-rangeFieldsGrid",{width:"100%",defaultSpan:"L12 M12 S12",vSpacing:0,hSpacing:0,content:[this._oFilterPanel]}).addStyleClass("sapUiRespGridOverflowHidden");this._sValidationDialogTitle=this._oRb.getText("VALUEHELPVALDLG_TITLE");this._sValidationDialogMessage=this._oRb.getText("VALUEHELPVALDLG_MESSAGE");this._sValidationDialogFieldMessage=this._oRb.getText("VALUEHELPVALDLG_FIELDMESSAGE");return o};ne.prototype.suggest=function(e){this._fSuggestCallback=e;if(this._oFilterPanel){this._oFilterPanel.setSuggestCallback(this._fSuggestCallback)}};ne.prototype._getKeyFieldByKey=function(e){var t;if(this._aRangeKeyFields){this._aRangeKeyFields.some(function(i){if(typeof i!=="string"){if(i.key===e){t=i;return true}}return false})}return t};ne.prototype._validateRanges=function(e,t){if(this._oRanges){if(!this._oRanges.getParent()){e();return}var i=this._oFilterPanel.validateConditions();if(!i){o.show(this._sValidationDialogMessage,{icon:o.Icon.WARNING,title:this._sValidationDialogTitle,actions:[o.Action.OK,o.Action.CANCEL],emphasizedAction:o.Action.OK,styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":"",onClose:function(i){if(i===o.Action.OK&&e){e()}if(i===o.Action.CANCEL&&t){t()}}});return}}e()};ne.prototype.setUpdateSingleRowCallback=function(e){this.fSingleRowCallback=e;this._updateNavigationControl()};ne.prototype._createDefaultTable=function(){if(!this._isPhone()){this.setTable(new L(this.getId()+"-table"),true)}else{this.setTable(new P(this.getId()+"-table"),true);this.TableStateSearchData()}};function le(){if(!(this._oTablePromise instanceof Promise)){this._oTablePromise=new Promise(function(e,t){this._fnRejectTablePromise=t;if(!this._isPhone()){var i;if(this.getEnabledMultiSelectionPlugin()){i=new L({id:this.getId()+"-table",plugins:new Z({limit:1e3,enableNotification:true})});i.data("isInternal",true)}else{i=new L({id:this.getId()+"-table"})}this.setTable(i,true);e(i)}else{var i=new P({id:this.getId()+"-table"});i.setMultiSelectMode(B.MultiSelectMode.ClearAll);i.data("isInternal",true);this.setTable(i,true);this.TableStateSearchData();e(i)}}.bind(this))}return this._oTablePromise}ne.prototype._initializeTable=function(){var e,t=false;if(this._oTable){e=this._oTable;if(this._isMultiSelectionPluginAvailable()){e=this._oTable._getSelectionPlugin();t=true}}if(this._oTable&&this._oTable.isA("sap.ui.table.Table")){this._oTable.setTitle(M.system.desktop?this._sTableTitleNoCount:null);if(this._bTableCreatedInternal){this.getSupportMultiselect()?this._oTable.setSelectionBehavior(V.SelectionBehavior.Row):this._oTable.setSelectionBehavior(V.SelectionBehavior.RowOnly)}e.setSelectionMode(this.getSupportMultiselect()?V.SelectionMode.MultiToggle:V.SelectionMode.Single);this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));this._oTable.setVisibleRowCountMode(V.VisibleRowCountMode.Fixed);this._oTable.setMinAutoRowCount(M.system.desktop?5:4);var i=function(i){var s=i.getParameter("_internalTrigger")&&i.getParameter("_internalTrigger")===true,a=i.getParameter("userInteraction"),n=e.getSelectedIndex()!==-1;if(this._bIgnoreSelectionChange||!a&&!t||t&&!n&&s){return}var l={tableSelectionParams:i.mParameters,updateTokens:[],useDefault:false,table:this._oTable};if(this._hasListeners("selectionChange")){this._bIgnoreSelectionChange=true;this.fireSelectionChange(l);this._bIgnoreSelectionChange=false;l.updateTokens.forEach(function(e){this._addRemoveTokenByKey(e.sKey,e.oRow,e.bSelected)}.bind(this))}else{l.useDefault=true}if(l.useDefault){var r=t?i.getSource().getParent():i.getSource();var h=r.getBinding("rows");var _=t?i.getSource().getSelectedIndices():r.getSelectedIndices();var u=i.getParameter("rowIndices");var d=i.getParameter("selectAll");var c=h&&h.isLengthFinal?h.isLengthFinal():true;var g,p=_.length;var T;var f=0;if(c){if(h.aKeys){for(g=0;g<p;g++){T=_[g];if(!h.aKeys[T]){f++}}}}else if(d){f=99999999}if(f!==0){var b=function(){h.attachEventOnce("dataReceived",function(){if(d){r.selectAll();u=e.getSelectedIndices()}this._handleSelectionUpdateTokens(r,u)}.bind(this));if(d){if(c){h.getContexts(0,p)}else{h.getContexts(0,f)}}else{h.getContexts(u[0],u[u.length-1])}}.bind(this);if(f<=400){b();return}else{o.show(this._oRb.getText("VALUEHELPDLG_SELECTIONFAILEDLOAD"),{icon:o.Icon.WARNING,title:this._oRb.getText("VALUEHELPDLG_SELECTIONFAILEDLOADTITLE"),actions:[o.Action.OK,o.Action.CANCEL],emphasizedAction:o.Action.OK,initialFocus:o.Action.CANCEL,styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":"",onClose:function(e){if(e===o.Action.OK){b()}else{this.update()}}.bind(this)});return}}this._handleSelectionUpdateTokens(r,u)}this._updateTitles();if(!this.getSupportMultiselect()){this._bIgnoreSelectionChange=true;this._onCloseAndTakeOverValues()}};if(t){e.attachSelectionChange(i.bind(this))}else{this._oTable.attachRowSelectionChange(i.bind(this))}this._oTable.addStyleClass("compVHMainTable");if(!this._oTable.getParent()||!this._oTable.getParent().isA("sap.ui.comp.smarttable.SmartTable")){this._oTable.bindAggregation("columns","columns>/cols",function(e,t){var i,s,a=new O,o=t.getProperty("template"),n;if(t.getProperty("type")==="boolean"){i=new W(e+"-control",{enabled:false,selected:{path:o}})}else{var l={path:o,type:t.getProperty("oType")};if(Array.isArray(o)){l={parts:[{path:o[0]},{path:o[1]}],formatter:function(e,i){var s=d.getFormattedExpressionFromDisplayBehaviour(t.getProperty("displayBehaviour"),e,i);return q(s)}}}i=new p(e+"-control",{wrapping:false,renderWhitespace:true,text:l})}if(this._oTable.isA("sap.ui.table.AnalyticalTable")){s=new Q(e,{label:"{columns>label}",template:i,width:"{columns>width}",hAlign:i instanceof W?te.Center:te.Begin,filterProperty:t.getProperty("filter")})}else{s=new F(e,{label:"{columns>label}",template:i,width:"{columns>width}",hAlign:i instanceof W?te.Center:te.Begin,sortProperty:t.getProperty("sort"),sorted:t.getProperty("sorted"),sortOrder:t.getProperty("sortOrder"),filterProperty:t.getProperty("filter")});n=s.getProperty("sortProperty");if(n){s.setHeaderMenu(a)}}return s}.bind(this))}}else{this._oTable.setMode(this.getSupportMultiselect()?Y.MultiSelect:Y.SingleSelectLeft);this._oTable.setGrowing(true);e.attachSelectionChange(function(e){if(this._bIgnoreSelectionChange){return}var t=e.mParameters;var i={tableSelectionParams:e.mParameters,updateTokens:[],useDefault:false,table:this._oTable};if(this._hasListeners("selectionChange")){this._bIgnoreSelectionChange=true;this.fireSelectionChange(i);this._bIgnoreSelectionChange=false;i.updateTokens.forEach(function(e){this._addRemoveTokenByKey(e.sKey,e.oRow,e.bSelected)}.bind(this))}else{i.useDefault=true}if(i.useDefault){var s=t.selected;var a,o=t.listItems.length;for(a=0;a<o;a++){var n=t.listItems[a];var l=n.getBindingContext();var r=l?l.getObject():null;if(r){var h=r[this.getKey()];if(!this.getSupportMultiselect()){this._oSelectedItems.removeAll()}this._addRemoveTokenByKey(h,r,s)}}}if(!this.getSupportMultiselect()){this._onCloseAndTakeOverValues()}}.bind(this));if(!this._oTable.getParent()||!this._oTable.getParent().isA("sap.ui.comp.smarttable.SmartTable")){var s=0;this._oTable.bindAggregation("columns","columns>/cols",function(e,t){var i=t.getProperty("label");var a=this._oTable.getColumns().length>=2;s++;return new x(this._oTable.getId()+"-column"+s,{header:new T(this._oTable.getId()+"-column"+s+"-label",{text:i}),demandPopin:a,minScreenWidth:a?(this._oTable.getColumns().length+1)*10+"rem":"1px"})}.bind(this))}}};ne.prototype._handleSelectionUpdateTokens=function(e,t){var i,s=t.length;var a;var o;var n;var l=false;var r=this.getEnabledMultiSelectionPlugin()&&e._getSelectionPlugin&&e._getSelectionPlugin().isA("sap.ui.table.plugins.MultiSelectionPlugin")&&e.data("isInternal")?e._getSelectionPlugin():e;if(e.getBinding("rows").aKeys){l=true}if(!this.getSupportMultiselect()){this._oSelectedItems.removeAll()}for(i=0;i<s;i++){a=t[i];o=e.getContextByIndex(a);n=o?o.getObject():null;if(n){var h;if(l){h=o.sPath.substring(1)}else{h=n[this.getKey()]}this._addRemoveTokenByKey(h,n,r.isIndexSelected(a))}}};ne.prototype._addRemoveTokenByKey=function(e,t,i){try{e=decodeURIComponent(e)}catch(e){}if(i){this._oSelectedItems.add(e,t);this._addToken2Tokenizer(e,this._getFormatedTokenText(e),this._getTokenizer())}else{this._oSelectedItems.remove(e);this._removeTokenFromTokenizer(e,this._getTokenizer())}};ne.prototype._onCloseAndTakeOverValues=function(){var e=this;var t=function(){var t;var i=e._oSelectedItems.getSelectedItemsTokenArray(e.getKey(),e.getDescriptionKey(),e.getTokenDisplayBehaviour());if(e._oSelectedRanges){var s=0;for(var a in e._oSelectedRanges){t=e._oSelectedRanges[a];var o=t.tokenValue;if(!o){o=e._getFormatedRangeTokenText(t.operation,t.value1,t.value2,t.exclude,t.keyField)}if(!t._oGrid||t._oGrid.select.getSelected()){var l=new n({key:"range_"+s}).data("range",{exclude:t.exclude,operation:t.operation,keyField:t.keyField,value1:t.value1,value2:t.value2});l.setText(o);l.setTooltip(typeof o==="string"?o:null);i.push(l);s++}}}e.fireOk({tokens:i,_tokensHaveChanged:e._bInitTokensHaveChanged})};this._validateRanges(t)};ne.prototype._isMultiSelectionPluginAvailable=function(){var e=false;if(this._oTable._getSelectionPlugin&&this._oTable._getSelectionPlugin().isA("sap.ui.table.plugins.MultiSelectionPlugin")&&this._oTable.data("isInternal")){e=true}return e};ne.prototype._onCancel=function(){this.fireCancel()};ne.prototype._onGo=function(){this._oFilterBar.search()};ne.prototype._onClear=function(){this._oFilterBar.clear()};ne.prototype._updateTitles=function(){this._updateTableTitle();this._updateTokenizer();this._updateTabSearchAndSelectTitle();this._updateTabRangesTitle();if(this._bTriggerInvisibleTableCountMessageNotInitialLoad&&this._bTriggerInvisibleTableCountMessage){this._addInvisibleMessageSearchAndTableCount()}};ne.prototype._addInvisibleMessageSearchAndTableCount=function(){var e=this._oRb.getText("VALUEHELPDLG_SEARCH_RESULT_COUNT",this.nRowCount);this._oInvisibleMessage.announce(e,ie.Polite);this._bTriggerInvisibleTableCountMessage=false};ne.prototype._updateDlgTitle=function(){var e="";var t;if(this._oTitle){if(this._oTabBar&&!this._oTabBar.getVisible()&&!this.getFilterMode()){if(this._oTabBar.getSelectedKey()===oe.DESKTOP_LIST_VIEW){e="VALUEHELPDLG_TITLE"}else if(this._oTabBar.getSelectedKey()===oe.DESKTOP_CONDITIONS_VIEW){if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){e="VALUEHELPDLG_SINGLECONDITION_TITLE"}else{e="VALUEHELPDLG_RANGESTITLE"}}}else if(this._isPhone()&&!this.getFilterMode()){switch(this._currentViewMode){case oe.PHONE_MAIN_VIEW:e="";break;case oe.PHONE_LIST_VIEW:t=this._getTabSearchAndSelectText();break;case oe.PHONE_SEARCH_VIEW:e="FILTER_BAR_ADV_FILTERS_DIALOG";break;case oe.PHONE_CONDITIONS_VIEW:if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){e="VALUEHELPDLG_SINGLECONDITION_TITLE"}else{t=this._getTabRangesText()}break;default:break}}if(!t){t=this.getTitle()}if(e){t=this._oRb.getText(e,t)}if(t){this._oTitle.setText(t);this._oFilterPanel&&this._oFilterPanel.setInnerTitle(this.getTitle())}}};ne.prototype._updateTableTitle=function(){if(!this._oTable){return}var e=0;this.oRows=this._oTable.getBinding("rows");if(this.oRows){e=this.oRows.getLength()}if(!this._oNumberFormatInstance){this._oNumberFormatInstance=j.getFloatInstance()}if(e>0&&this.oRows.isLengthFinal&&this.oRows.isLengthFinal()){this.nRowCount=this._oNumberFormatInstance.format(e);this._setTableTitle(this._sTableTitle1.replace("{0}",this.nRowCount))}else{this._setTableTitle(this._sTableTitleNoCount)}};ne.prototype._getTabSearchAndSelectText=function(){var e=this._oTable;if(e){if(e.isA("sap.ui.comp.smarttable.SmartTable")){e=e.getTable()}var t=0;if(this._oSelectedItems&&this._oSelectedItems.getItems){t=this._oSelectedItems.getItems().length}if(t>0){return this._oRb.getText("VALUEHELPDLG_ITEMSTABLE_SELECT",[t])}}return this._oRb.getText("VALUEHELPDLG_ITEMSTABLE_SELECT").replace("({0})","")};ne.prototype._getTabRangesText=function(){if(this._oSelectedRanges&&Object.keys(this._oSelectedRanges).length>0){var e=Object.keys(this._oSelectedRanges).length;return this._oRb.getText("VALUEHELPDLG_RANGES",[e])}return this._oRb.getText("VALUEHELPDLG_RANGES").replace("({0})","")};ne.prototype._updateTabSearchAndSelectTitle=function(){var e=!this.getSupportRangesOnly();if(e){if(this._oTabBar){this._oTabBar.getItems()[0].setText(this._getTabSearchAndSelectText())}if(this._oMainListMenu&&this._oSelectItemLI){this._oSelectItemLI.setTitle(this._getTabSearchAndSelectText())}}};ne.prototype._updateTabRangesTitle=function(){var e=this.getSupportRangesOnly()||this.getSupportRanges();if(e){if(this._oTabBar){this._oTabBar.getItems()[1].setText(this._getTabRangesText())}if(this._oMainListMenu&&this._oDefineConditionsLI){this._oDefineConditionsLI.setTitle(this._getTabRangesText())}}};ne.prototype._setTableTitle=function(e){if(M.system.desktop&&this._oTable&&!this._oTable.isA("sap.m.Table")){if(this._oTable.getTitle()){this._oTable.getTitle().setText(e)}else{this._oTable.setTitle(e)}}else{this._oTable.addStyleClass("compValueHelpSmallMarginTop")}};ne.prototype.onAfterRendering=function(){a.prototype.onAfterRendering.apply(this);this._oButtonOk.setWidth(this._oButtonCancel.$().width()+"px");if(this._oTable){this._updateTitles()}if(!this._isPhone()&&this.getContentHeight()===""){if(this.getSupportRangesOnly()&&(this.getMaxExcludeRanges()==="-1"||this.getMaxIncludeRanges()==="-1")){this.setContentHeight("70%")}else{var e=this.getDomRef("scroll");var t=e.clientHeight;this.setContentHeight(t+"px")}if(this._oTable&&this._oTable.isA("sap.ui.table.Table")){this._oTable.setVisibleRowCountMode(V.VisibleRowCountMode.Auto)}}if(this._oTabBar&&this._oTabBar.getVisible()&&this.getCustomHeader()){this.getCustomHeader().addStyleClass("compValueHelpDialogHeaderNoBoxShadow")}this._bInitTokensHaveChanged=false;this._setToolbarSpacerWidth();this._registerVHResizeHandler()};ne.prototype.onsapbackspace=function(e){if(this._ignoreRemoveToken||!e.srcControl||!e.srcControl.isA("sap.m.Token")){return}var t=e.srcControl.getKey?e.srcControl.getKey():"",i=[];if((e.type==="sapbackspace"||e.type==="sapdelete")&&t){if(this._oSelectedRanges&&this._oSelectedRanges[t]){i.push(t);this._removeToken(t)}else{this._oSelectedItems.remove(t);this._removeTokenFromTokenizer(t,this._getTokenizer())}}this._removeRangeByKey(i);var s={tokenKeys:[t],useDefault:false};if(this._hasListeners("tokenRemove")){this._bIgnoreSelectionChange=true;this.fireTokenRemove(s);this._bIgnoreSelectionChange=false}else{s.useDefault=true}if(s.useDefault){this._changeTableRowSelectionForKey(t,false)}setTimeout(function(){var e=this._getTokenizer().getTokens();if(e){var t=e.length-1;if(t>=0){e[t].focus()}else{this._manageFocusAfterRemoveTokens()}}}.bind(this));this._updateTitles()};ne.prototype.onsapdelete=ne.prototype.onsapbackspace;ne.prototype._getDialogOffset=function(e){var t=e||this._$Window.width();var i={small:600,large:1024};var s=function(e){var t=parseInt(window.getComputedStyle(document.body).fontSize);return e*t*2};var a=1;if(t>i.small&&t<i.large){a=2}else if(t>=i.large){a=2}return{top:s(a),left:s(a)}};ne.prototype.exit=function(){a.prototype.exit.apply(this);if(typeof this._fnRejectTablePromise==="function"){this._fnRejectTablePromise()}this.removeDelegate(this._onBeforeRenderingInputEventDelegate);var e=function(e){if(e&&e.destroy){e.destroy()}return null};this._oTokenizerGrid=e(this._oTokenizerGrid);this._oRanges=e(this._oRanges);this._oFilterPanel=e(this._oFilterPanel);if(this._bTableCreatedInternal){this._oTable=e(this._oTable)}this._oTable=null;this.theTable=null;this._oNumberFormatInstance=null;this._oTabBar=e(this._oTabBar);this._oMainListMenu=e(this._oMainListMenu);this._oContentContainer=e(this._oContentContainer);this._oVarManagment=e(this._oVarManagment);this._aRangeKeyFields=e(this._aRangeKeyFields);this._aIncludeRangeOperations=e(this._aIncludeRangeOperations);this._aExcludeRangeOperations=e(this._aExcludeRangeOperations);if(this._oFilterBar){this._oFilterBar.detachInitialise(this._handleFilterBarInitialize);this._oFilterBar=e(this._oFilterBar)}this._oRb=e(this._oRb);this._sTableTitle1=e(this._sTableTitle1);this._sTableTitle2=e(this._sTableTitle2);this._sTableTitleNoCount=e(this._sTableTitleNoCount);this._sValidationDialogTitle=e(this._sValidationDialogTitle);this._sValidationDialogMessage=e(this._sValidationDialogMessage);this._sValidationDialogFieldMessage=e(this._sValidationDialogFieldMessage);this._oSelectedItems=e(this._oSelectedItems);this._oSelectedRanges=e(this._oSelectedRanges);this._oButtonOk=e(this._oButtonOk);this._oButtonCancel=e(this._oButtonCancel);if(this._oButtonGo){this._oButtonGo=e(this._oButtonGo)}if(this._oButtonClear){this._oButtonClear=e(this._oButtonClear)}if(this._oColSearchBox){this._oColSearchBox=e(this._oColSearchBox)}};ne.prototype.setRangeKeyFields=function(e){this._aRangeKeyFields=e;if(this._aRangeKeyFields){this._aRangeKeyFields.some(function(e){if(e.typeInstance&&e.typeInstance.isA("sap.ui.model.odata.type.DateTime")){var i=e.typeInstance;if(!i.oFormat){i.formatValue(t.getInstance(),"string")}if(i.oFormat){i.oFormat.oFormatOptions.UTC=false}}})}};ne.prototype.getRangeKeyFields=function(){return this._aRangeKeyFields};ne.prototype.setIncludeRangeOperations=function(e,t){t=t||"default";this._aIncludeRangeOperations[t]=e;if(this._oFilterPanel){this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[t],t)}};ne.prototype.setExcludeRangeOperations=function(e,t){t=t||"default";this._aExcludeRangeOperations[t]=e.map(function(e){return this._oOperationsHelper.getCorrespondingExcludeOperation(e)}.bind(this));if(this._oFilterPanel){this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[t],t)}};ne.prototype._getFormatedTokenText=function(e){var t=this._oSelectedItems.getItem(e);var i=t[this.getDescriptionKey()];var s=t[this.getKey()];if(i===undefined){if(typeof t==="string"){i=t}else{i=s}}else{i=d.getFormattedExpressionFromDisplayBehaviour(this.getTokenDisplayBehaviour()?this.getTokenDisplayBehaviour():ae.descriptionAndId,s,i)}return i};ne.prototype._getFormatedRangeTokenText=function(e,t,i,s,a){var o=this._getKeyFieldByKey(a);var n=t;var l=i;var r=true;if(o){if(!o.typeInstance&&K._createKeyFieldTypeInstance){K._createKeyFieldTypeInstance(o)}if(o.typeInstance){n=o.typeInstance.formatValue(t,"string",r);l=o.typeInstance.formatValue(i,"string",r)}}var h=d.getFormattedRangeText(e,n,l,s);if(this._aRangeKeyFields&&this._aRangeKeyFields.length>1&&o&&o.label&&h!==""){h=o.label+": "+h}return h};ne.prototype._isPhone=function(){return M.system.phone};ne.prototype._hasListeners=function(e){if(this._bTableCreatedInternal){return false}return this.hasListeners(e)};ne.prototype._rotateSelectionButtonIcon=function(e){if(!M.system.phone){var t=sap.ui.getCore().byId(this.oSelectionButton.$("img")[0].id);if(e){t.addStyleClass("sapUiVHImageExpand")}else{t.removeStyleClass("sapUiVHImageExpand")}}};ne.prototype._getTokenizer=function(){return this._oSelectedTokens};ne.prototype._getTabSearchAndSelect=function(){var e=!this.getSupportRangesOnly();if(e){if(this._oTabBar){return this._oTabBar.getItems()[0]}if(this._oMainListMenu&&this._oSelectItemLI){return this._oSelectItemLI}}return null};ne.prototype._getTabDefneConditions=function(){var e=this.getSupportRangesOnly()||this.getSupportRanges();if(e){if(this._oTabBar){return this._oTabBar.getItems()[1]}if(this._oMainListMenu&&this._oDefineConditionsLI){return this._oDefineConditionsLI}}return null};ne.prototype._registerVHResizeHandler=function(){$.register(this,this._onVHResize.bind(this))};ne.prototype._onVHResize=function(){this._setToolbarSpacerWidth()};ne.prototype._setToolbarSpacerWidth=function(){var e,t,i;if(!this._oFilterBar){return}if(this._oFilterBar._oToolbar){t=this._oFilterBar._oToolbar.getContent();for(var s=0;s<t.length;s++){if(t[s].isA("sap.m.ToolbarSpacer")){e=t[s];break}}}if(e&&this._oFilterBar.getBasicSearch()){i=this.getDomRef()&&parseInt(this.getDomRef().style.width);if(i>=1e3){e.setWidth("6rem")}else if(i<1e3&&i>700){e.setWidth("4rem")}else{e.setWidth("0.5rem")}}};ne.prototype._manageFocusAfterRemoveTokens=function(){var e,t=this._oFilterPanel?this._oFilterPanel.getConditionPanel():undefined;if(this._currentViewMode.toLowerCase().indexOf("list")>-1){this._oButtonOk.focus()}else{this._onAfterRenderingInputDelegate={onAfterRendering:function(){e.focus()}};this._onBeforeRenderingInputEventDelegate={onBeforeRendering:function(){if(e.getDomRef()){e.removeDelegate(this._onAfterRenderingInputDelegate,this)}}};e=t._oConditionsGrid.getAggregation("content")[0].value1;e.addDelegate(this._onAfterRenderingInputDelegate,this);e.addDelegate(this._onBeforeRenderingInputEventDelegate,this);e.focus()}};function re(e,t){if(!t){t=this.getKey()}e=e.replace(/[^a-zA-Z0-9]/g,"");t=t.replace(/[^a-zA-Z0-9]/g,"");var i=t?t+"-"+e:e;if(!this._oTokenIdCount[i]){this._oTokenIdCount[i]=0}this._oTokenIdCount[i]++;return this.getId()+"-token-"+i+"_"+this._oTokenIdCount[i]}function he(e){if(e){var t=e.getItems();return t[0].getVisible()&&t[1].getVisible()}else{return false}}return ne});