/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/thirdparty/jquery"],function(e,n,a){"use strict";function i(e){var a;var i=document.querySelector(".sapUiComponentContainer");i=Array.isArray(i)?i:[i];i.some(function(i){var t=sap.ui.getCore().byId(i.id);var s=t&&t.getComponentInstance();if(s&&n.getFlexReferenceForControl(s)===e){a=s;return true}});return a}function t(n,a){var t=i(a.sComponentName);for(var r in n._mChangesEntries){var o=n._mChangesEntries[r];a.mChangesEntries[r]={mDefinition:o.getDefinition(),aControlsDependencies:[],aDependencies:[]};if(o._aDependentSelectorList){o._aDependentSelectorList.forEach(function(n){var i={bPresent:!!e.bySelector(n,t),aAppliedChanges:[],aFailedChangesJs:[],aFailedChangesXml:[],aNotApplicableChanges:[]};a.mControlData[n.id]=i})}}s(n,a)}function s(e,n){for(var a in e._mChangesInitial.mDependencies){var i=e._mChangesInitial.mDependencies[a];n.mChangesEntries[a].aControlsDependencies=i.controlsDependencies;n.mChangesEntries[a].aDependencies=i.dependencies}}function r(e,n){a.each(e._mVariantsChanges,function(e,a){n.mVariantsChanges[e]={mDefinition:a._oDefinition}})}function o(e,n,a,i,t){if(t){a[i]=t;a[i].map(function(a){if(!(a in e[n])){e[n].push(a)}})}}function l(e,n){var a=e.getCustomData();var i=[];a.forEach(function(e){var a=e.getKey();if(a.startsWith(n)){i.push(a.replace(n,""))}});return i}function p(e,n){for(var a in e._mChanges.mChanges){var i={bPresent:false,aAppliedChanges:[],aFailedChangesJs:[],aFailedChangesXml:[],aNotApplicableChanges:[]};var t=sap.ui.getCore().byId(a);if(t){i.bPresent=true;o(n,"aAppliedChanges",i,"aAppliedChanges",l(t,"sap.ui.fl.appliedChanges."));o(n,"aFailedChanges",i,"aFailedChangesJs",l(t,"sap.ui.fl.failedChanges.js."));o(n,"aFailedChanges",i,"aFailedChangesXml",l(t,"sap.ui.fl.failedChanges.xml."));o(n,"aNotApplicableChanges",i,"aNotApplicableChanges",l(t,"sap.ui.fl.notApplicableChanges."))}n.mControlData[a]=i}}return function(e){if(!e){return}var n={sVersion:"1",bIsInvestigationExport:true,mControlData:{},aAppliedChanges:[],aFailedChanges:[],aNotApplicableChanges:[],mChangesEntries:{},mVariantsChanges:{},sComponentName:e._mComponent.name};t(e,n);r(e,n);p(e,n);return n}});