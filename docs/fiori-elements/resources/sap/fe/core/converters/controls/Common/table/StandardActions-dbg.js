/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/formatters/TableFormatter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","../../../helpers/BindingHelper","../../../ManifestSettings"],function(e,t,n,i,a,o,r){"use strict";var s={};var l=r.TemplateType;var d=r.CreationMode;var c=o.UI;var u=o.singletonPathVisitor;var p=a.isPathUpdatable;var f=a.isPathInsertable;var v=a.isPathDeletable;var g=a.getTargetObjectPath;var b=i.isNavigationProperty;var h=i.isEntitySet;var y=t.pathInModel;var T=t.or;var C=t.notEqual;var M=t.not;var m=t.length;var P=t.isPathInModelExpression;var E=t.isConstant;var D=t.ifElse;var A=t.greaterThan;var S=t.greaterOrEqual;var O=t.getExpressionFromAnnotation;var x=t.formatResult;var I=t.equal;var R=t.constant;var w=t.compileExpression;var H=t.and;var U;(function(e){e["CreateHidden"]="CreateHidden";e["DeleteHidden"]="DeleteHidden";e["UpdateHidden"]="UpdateHidden"})(U||(U={}));function j(e,t,n,i){return{collectionPath:g(e.getDataModelObjectPath()),hiddenAnnotation:{create:L(e,U.CreateHidden),delete:L(e,U.DeleteHidden),update:L(e,U.UpdateHidden)},creationMode:t,isDraftOrStickySupported:V(e),isViewWithMultipleVisualizations:i?e.getManifestWrapper().hasMultipleVisualizations(i):false,newAction:k(e),tableManifestConfiguration:n,restrictions:z(e)}}s.generateStandardActionsContext=j;function V(e){var t,i,a;const o=e.getDataModelObjectPath();const r=n.isObjectPathDraftSupported(o);const s=(t=o.startingEntitySet)!==null&&t!==void 0&&(i=t.annotations)!==null&&i!==void 0&&(a=i.Session)!==null&&a!==void 0&&a.StickySessionSupported?true:false;return r||s}s.isDraftOrStickySupported=V;function k(e){var t,n,i,a;const o=e.getEntitySet();const r=h(o)?((t=o.annotations.Common)===null||t===void 0?void 0:(n=t.DraftRoot)===null||n===void 0?void 0:n.NewAction)??((i=o.annotations.Session)===null||i===void 0?void 0:(a=i.StickySessionSupported)===null||a===void 0?void 0:a.NewAction):undefined;const s=r===null||r===void 0?void 0:r.toString();if(s){var l,d,c,u;let t=e===null||e===void 0?void 0:(l=e.getEntityType().actions[s])===null||l===void 0?void 0:(d=l.annotations)===null||d===void 0?void 0:(c=d.Core)===null||c===void 0?void 0:(u=c.OperationAvailable)===null||u===void 0?void 0:u.valueOf();t=t!==undefined?t:true;return{name:s,available:O(t)}}return undefined}s.getNewAction=k;function L(e,t){var n;let i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;const a=e.getEntitySet();const o=e.getDataModelObjectPath();const r=o.navigationProperties.length>0&&i?[o.navigationProperties[o.navigationProperties.length-1].name]:[];const s=(a===null||a===void 0?void 0:(n=a.annotations.UI)===null||n===void 0?void 0:n[t])||false;return a?O(s,r,undefined,t=>u(t,e.getConvertedTypes(),r)):R(false)}s.isActionAnnotatedHidden=L;function z(e){const t=e.getDataModelObjectPath();const n=[{key:"isInsertable",function:f},{key:"isUpdatable",function:p},{key:"isDeletable",function:v}];const i={};n.forEach(function(n){const a=n["function"];i[n.key]={expression:a.apply(null,[t,{pathVisitor:(t,n)=>u(t,e.getConvertedTypes(),n)}]),navigationExpression:a.apply(null,[t,{ignoreTargetCollection:true,authorizeUnresolvable:true,pathVisitor:(t,n)=>u(t,e.getConvertedTypes(),n)}])}});return i}s.getRestrictions=z;function F(e,t){return t||e.creationMode===d.External}s.getInsertUpdateActionsTemplating=F;function N(e,t){const n=J(e,t);return{isTemplated:w(_(t,n)),visible:w(n),enabled:w(Z(e,t,n))}}s.getStandardActionCreate=N;function W(e,t){const n=K(e,t);return{isTemplated:w(G(n)),visible:w(n),enabled:w(ee(e,t,n))}}s.getStandardActionDelete=W;function q(e,t){const n=J(e,t,true);return{isTemplated:w(_(t,n,true)),visible:w(n),enabled:w(Y(e,t,n))}}s.getCreationRow=q;function B(e,t,n){const i=J(e,t);const a=Z(e,t,i);const o=Q(e,t,i,n);return{visible:w(o),enabled:w(te(o,a))}}s.getStandardActionPaste=B;function $(e,t){const n=X(e,t);return{isTemplated:w(G(n)),visible:w(n),enabled:w(ne(e,t,n))}}s.getStandardActionMassEdit=$;function _(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return H(T(H(n,e.creationMode===d.CreationRow),H(!n,e.creationMode!==d.CreationRow)),T(M(E(t)),t))}s.getCreateTemplating=_;function G(e){return T(M(E(e)),e)}s.getDefaultTemplating=G;function J(e,t){var n,i;let a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;const o=t.restrictions.isInsertable.expression;const r=a?L(e,U.CreateHidden,false):t.hiddenAnnotation.create;const s=t.newAction;return D(t.creationMode===d.External,H(M(r),T(e.getTemplateType()===l.ListReport,c.IsEditable)),D(T(H(E(s===null||s===void 0?void 0:s.available),I(s===null||s===void 0?void 0:s.available,false)),H(E(o),I(o,false),!s),H(E(r),I(r,true)),H(t.creationMode===d.InlineCreationRows,((n=t.tableManifestConfiguration)===null||n===void 0?void 0:n.type)==="ResponsiveTable",D((t===null||t===void 0?void 0:(i=t.tableManifestConfiguration)===null||i===void 0?void 0:i.inlineCreationRowsHiddenInEditMode)===false,true,c.IsCreateMode))),false,D(e.getTemplateType()===l.ListReport,T(M(P(r)),M(r)),H(M(r),c.IsEditable))))}s.getCreateVisibility=J;function K(e,t){const n=t.hiddenAnnotation.delete;const i=t.restrictions.isDeletable.expression;return D(e.getTemplateType()===l.AnalyticalListPage,false,D(H(E(i),I(i,false)),false,D(H(E(n),I(n,R(true))),false,D(e.getTemplateType()!==l.ListReport,H(M(n),c.IsEditable),M(H(P(n),n))))))}s.getDeleteVisibility=K;function Q(e,t,n,i){return H(C(t.tableManifestConfiguration.enablePaste,false),n,i,[l.ListReport,l.AnalyticalListPage].indexOf(e.getTemplateType())===-1,t.restrictions.isInsertable.expression)}s.getPasteVisibility=Q;function X(e,t){var n;const i=t.hiddenAnnotation.update,a=t.restrictions.isUpdatable.expression,o=((n=t.tableManifestConfiguration)===null||n===void 0?void 0:n.enableMassEdit)||false;const r=e.getTemplateType()===l.ObjectPage?c.IsEditable:e.getTemplateType()===l.ListReport;return H(M(H(E(a),I(a,false))),o,r,M(i))}s.getMassEditVisibility=X;function Y(t,n,i){const a=f(t.getDataModelObjectPath(),{ignoreTargetCollection:true,authorizeUnresolvable:true,pathVisitor:(e,n)=>{if(e.indexOf("/")===0){e=u(e,t.getConvertedTypes(),n);return e}const i=t.getDataModelObjectPath().navigationProperties;if(i){const t=i[i.length-1];const n=b(t)&&t.partner;if(n){e=`${n}/${e}`}}return e}});const o=a._type==="Unresolvable"?f(t.getDataModelObjectPath(),{pathVisitor:e=>u(e,t.getConvertedTypes(),[])}):a;return H(i,o,T(!n.tableManifestConfiguration.disableAddRowButtonForEmptyData,x([y("creationRowFieldValidity","internal")],e.validateCreationRowFields)))}s.getCreationRowEnablement=Y;function Z(e,t,n){let i;if(t.creationMode===d.InlineCreationRows){i=M(t.hiddenAnnotation.create)}else{i=n}const a=t.restrictions.isInsertable.expression;const o=e.resolveAbsolutePath(t.collectionPath).target;return H(i,T(h(o),H(a,T(e.getTemplateType()!==l.ObjectPage,c.IsEditable))))}s.getCreateEnablement=Z;function ee(e,t,n){const i=y("deletableContexts","internal");const a=y("unSavedContexts","internal");const o=y("draftsWithDeletableActive","internal");const r=y("draftsWithNonDeletableActive","internal");return H(n,D(e.getTemplateType()===l.ObjectPage,T(H(C(i,undefined),A(m(i),0)),H(C(o,undefined),A(m(o),0))),T(H(C(i,undefined),A(m(i),0)),H(C(o,undefined),A(m(o),0)),H(C(r,undefined),A(m(r),0)),H(C(a,undefined),A(m(a),0)))))}s.getDeleteEnablement=ee;function te(e,t){return H(e,t)}s.getPasteEnablement=te;function ne(e,t,i){const a=t.restrictions.isUpdatable.expression;const o=!E(a)&&t.restrictions.isUpdatable.navigationExpression._type==="Unresolvable";const r=S(y("numberOfSelectedContexts","internal"),1);const s=S(m(y("updatableContexts","internal")),1);const l=n.isObjectPathDraftSupported(e.getDataModelObjectPath());const d=ie(e);const c=D(T(H(d,l),o),H(r,s),H(r));return H(i,D(o,c,H(c,a)))}s.getMassEditEnablement=ne;function ie(e,t){const n=e.getTemplateType();if(n===l.ListReport||n===l.AnalyticalListPage||t&&e.getManifestWrapper().hasMultipleVisualizations(t)){return true}return false}s.isInDisplayMode=ie;return s},false);