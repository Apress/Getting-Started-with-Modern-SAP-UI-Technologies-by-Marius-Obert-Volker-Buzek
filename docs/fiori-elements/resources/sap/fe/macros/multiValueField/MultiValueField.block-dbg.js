/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/buildingBlocks/BuildingBlockBase","sap/fe/core/buildingBlocks/BuildingBlockSupport","sap/fe/core/buildingBlocks/BuildingBlockTemplateProcessor","sap/fe/core/converters/helpers/BindingHelper","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyFormatters","sap/fe/core/templating/UIFormatters","sap/fe/macros/field/FieldHelper","sap/fe/macros/field/FieldTemplating","sap/fe/macros/internal/valuehelp/ValueHelpTemplating"],function(e,t,i,a,r,n,o,l,s,c,u,p,d,f){"use strict";var h,m,g,b,v,y,P,x,M,B,O,w,E,D,k,V,I;var $={};var j=d.getVisibleExpression;var z=d.getValueBinding;var F=u.getDisplayMode;var S=s.isPathInsertable;var T=s.isPathDeletable;var L=s.getRelativePaths;var C=s.getContextRelativeTargetObjectPath;var _=s.enhanceDataModelPath;var H=l.isPropertyPathExpression;var R=l.isPathAnnotationExpression;var U=l.isMultipleNavigationProperty;var A=n.or;var N=n.not;var q=n.isConstant;var Q=n.ifElse;var G=n.getExpressionFromAnnotation;var J=n.constant;var K=n.compileExpression;var W=n.and;var X=a.UI;var Y=i.xml;var Z=t.defineBuildingBlock;var ee=t.blockAttribute;function te(e,t,i,a){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(a):void 0})}function ie(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function ae(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;re(e,t)}function re(e,t){re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return re(e,t)}function ne(e,t,i,a,r){var n={};Object.keys(a).forEach(function(e){n[e]=a[e]});n.enumerable=!!n.enumerable;n.configurable=!!n.configurable;if("value"in n||n.initializer){n.writable=true}n=i.slice().reverse().reduce(function(i,a){return a(e,t,i)||i},n);if(r&&n.initializer!==void 0){n.value=n.initializer?n.initializer.call(r):void 0;n.initializer=undefined}if(n.initializer===void 0){Object.defineProperty(e,t,n);n=null}return n}function oe(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let le=(h=Z({name:"MultiValueField",namespace:"sap.fe.macros.internal"}),m=ee({type:"string"}),g=ee({type:"string"}),b=ee({type:"sap.ui.model.Context",required:true,expectedTypes:["com.sap.vocabularies.UI.v1.DataField"]}),v=ee({type:"sap.ui.model.Context",required:true,expectedTypes:["EntitySet","NavigationProperty","EntityType","Singleton"]}),y=ee({type:"string"}),P=ee({type:"string"}),x=ee({type:"object",validate:function(e){if(e.displayMode&&!["Value","Description","ValueDescription","DescriptionValue"].includes(e.displayMode)){throw new Error(`Allowed value ${e.displayMode} for displayMode does not match`)}return e}}),h(M=(B=function(e){ae(t,e);t._getMultiInputSettings=function e(i,a){var r;const{collectionPath:n,itemDataModelObjectPath:o}=t._getPathStructure(i);const l=`{path:'${n}', templateShareable: false}`;const s=`{path:'${n}', parameters: {$$ownRequest : true}, templateShareable: false}`;const c=i.targetObject;const u=H(c)?c.$target:c;const p=(r=u.annotations.Common)===null||r===void 0?void 0:r.Text;const d=L(i);const f=p?K(G(p,d)):z(o,a,true);return{text:f,collectionBindingDisplay:l,collectionBindingEdit:s,key:z(o,a,true)}};t._getPathStructure=function e(t){var i,a;let r="";const n=(i=t.contextLocation)!==null&&i!==void 0&&i.targetEntitySet?t.contextLocation.targetEntitySet:t.startingEntitySet;const o=[];const l=((a=t.contextLocation)===null||a===void 0?void 0:a.navigationProperties)||[];for(const e of t.navigationProperties){if(t.contextLocation===undefined||!t.contextLocation.navigationProperties.some(t=>t.fullyQualifiedName===e.fullyQualifiedName)){o.push(e.name);l.push(e)}if(n.navigationPropertyBinding.hasOwnProperty(e.name)){if(U(e)){break}}}r=`${o.join("/")}`;const s=Object.assign({},t);if(s.contextLocation){s.contextLocation.navigationProperties=l}return{collectionPath:r,itemDataModelObjectPath:s}};function t(i){var a;a=e.call(this,i)||this;te(a,"idPrefix",O,ie(a));te(a,"vhIdPrefix",w,ie(a));te(a,"metaPath",E,ie(a));te(a,"contextPath",D,ie(a));te(a,"ariaLabelledBy",k,ie(a));te(a,"key",V,ie(a));te(a,"formatOptions",I,ie(a));let n=r.getInvolvedDataModelObjects(a.metaPath,a.contextPath);const o=r.convertMetaModelContext(a.metaPath);let l;if(R(o.Value)){l=o.Value.path}a.visible=j(n,a.formatOptions);if(l&&l.length>0){n=_(n,l)}const s=S(n);const c=T(n,{ignoreTargetCollection:true,authorizeUnresolvable:true});const u=T(n);const p=Q(c._type==="Unresolvable",A(N(q(u)),u),u);a.editMode=a.formatOptions.displayOnly==="true"?"Display":K(Q(W(s,p,X.IsEditable),J("Editable"),J("Display")));a.displayMode=F(n);const d=t._getMultiInputSettings(n,a.formatOptions);a.text=d.text;a.collection=a.editMode==="Display"?d.collectionBindingDisplay:d.collectionBindingEdit;a.key=d.key;return a}$=t;var i=t.prototype;i.getTemplate=function e(){const t=r.getInvolvedDataModelObjects(this.metaPath,this.contextPath);const i=t.targetObject;const a=_(t,i.Value.path);const n=this.idPrefix?o.generate([this.idPrefix,"MultiValueField"]):undefined;const l=p.valueHelpProperty(this.metaPath);const s=this.metaPath.getModel().createBindingContext(l,this.metaPath);const u=f.generateID(undefined,this.vhIdPrefix,c.getRelativePropertyPath(s,{context:this.contextPath}),C(a)??"");const d=p.computeLabelText(i.Value,{context:this.metaPath});return Y`
		<mdc:MultiValueField
				xmlns:mdc="sap.ui.mdc"
				delegate="{name: 'sap/fe/macros/multiValueField/MultiValueFieldDelegate'}"
				id="${n}"
				items="${this.collection}"
				display="${this.displayMode}"
				width="100%"
				editMode="${this.editMode}"
				fieldHelp="${u}"
				ariaLabelledBy = "${this.ariaLabelledBy}"
				showEmptyIndicator = "${this.formatOptions.showEmptyIndicator}"
				label = "${d}"
		>
		<mdcField:MultiValueFieldItem xmlns:mdcField="sap.ui.mdc.field" key="${this.key}" description="${this.text}" />
		</mdc:MultiValueField>`};return t}(e),O=ne(B.prototype,"idPrefix",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),w=ne(B.prototype,"vhIdPrefix",[g],{configurable:true,enumerable:true,writable:true,initializer:function(){return"FieldValueHelp"}}),E=ne(B.prototype,"metaPath",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),D=ne(B.prototype,"contextPath",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),k=ne(B.prototype,"ariaLabelledBy",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),V=ne(B.prototype,"key",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),I=ne(B.prototype,"formatOptions",[x],{configurable:true,enumerable:true,writable:true,initializer:function(){return{}}}),B))||M);$=le;return $},false);